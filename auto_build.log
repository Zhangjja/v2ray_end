++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                                                              
                                                                              
2019-05-15 04:30:01 检测的网关名为gw
2019-05-15 04:30:02 获取的v2ray服务器IP地址为45.32.42.33
2019-05-15 04:30:02 收集vultr的服务器列表
2019-05-15 04:30:07 gw 调用API成功，开始执行监控程序
2019-05-15 04:30:07 获取的v2ray服务器subid为 24749929
2019-05-15 04:30:07 获取的v2ray服务器DCID为 25
2019-05-15 04:30:07 获取的v2ray服务器label为gmasterw
2019-05-15 04:30:25 获取v2ray服务器宽带使用率为 60351207438 字节
2019-05-15 04:30:25 获取的宽带使用率为56 G
2019-05-15 04:30:25 触发重新搭建服务器条件,同时将keepalived服务停用
2019-05-15 04:30:25 正在停用keepalived服务
10.24.1.254 | CHANGED | rc=0 >>

2019-05-15 04:30:27 gw 的keepalived服务停用成功
2019-05-15 04:30:27 正在销毁v2ray服务器
2019-05-15 04:30:31 等待删除gmasterw
2019-05-15 04:31:01 删除gmasterw 成功
2019-05-15 04:31:01 获取gw 使用的v2ray服务器的label	gmasterw
2019-05-15 04:31:01 重新安装v2ray服务器
2019-05-15 04:31:08 installing server......
2019-05-15 04:31:08 正在安装的v2ray服务器的subid为24759974
2019-05-15 04:31:31 新建的v2ray服务器IP地址为45.32.42.33
2019-05-15 04:31:34 获取的v2ray服务器的密码为S3.oZcY*p=2DKY(5
2019-05-15 04:31:34 sleep 60
2019-05-15 04:32:35 检查v2ray服务器ip地址存在！
2019-05-15 04:32:35 ------------------------
2019-05-15 04:32:35 清理本地已经存在45.32.42.33 的密钥
# Host 45.32.42.33 found: line 12
/root/.ssh/known_hosts updated.
Original contents retained as /root/.ssh/known_hosts.old
2019-05-15 04:32:35 重新添加45.32.42.33 的密钥，正在添加密钥！
2019-05-15 04:32:36 v2ray_server安装ssh密钥
2019-05-15 04:32:39 ------------
2019-05-15 04:32:39 正在配置ansible主控端
2019-05-15 04:32:39 gmasterw 已存在
2019-05-15 04:32:39 主控端配置完毕！
2019-05-15 04:32:39 ------------
2019-05-15 04:32:39 测试ansible被控端
45.32.42.33 | SUCCESS => {
    "changed": false, 
    "ping": "pong"
}
2019-05-15 04:32:53 主控端配置成功！
2019-05-15 04:32:53 -------------------
2019-05-15 04:32:53 开始安装v2ray服务端,并且进行配置，使用ansible的script模块拷贝配置文件
45.32.42.33 | CHANGED => {
    "changed": true, 
    "rc": 0, 
    "stderr": "Shared connection to 45.32.42.33 closed.\r\n", 
    "stderr_lines": [
        "Shared connection to 45.32.42.33 closed."
    ], 
    "stdout": "安装v2ray服务端\r\nbash <(curl -L -s https://install.direct/go.sh)\r\n\u001b[36mInstalling V2Ray v4.18.0 on x86_64\u001b[0m\r\n\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.0/v2ray-linux-64.zip\u001b[0m\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r100   608    0   608    0     0   1036      0 --:--:-- --:--:-- --:--:--  1037\r\n\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r  1 10.5M    1  126k    0     0  73838      0  0:02:29  0:00:01  0:02:28  126k\r 60 10.5M   60 6522k    0     0  2386k      0  0:00:04  0:00:02  0:00:02 3298k\r100 10.5M  100 10.5M    0     0  3715k      0  0:00:02  0:00:02 --:--:-- 5020k\r\n\u001b[36mUpdating software repo\u001b[0m\r\n\u001b[36mInstalling unzip\u001b[0m\r\ndebconf: unable to initialize frontend: Dialog\r\ndebconf: (TERM is not set, so the dialog frontend is not usable.)\r\ndebconf: falling back to frontend: Readline\r\ndebconf: unable to initialize frontend: Readline\r\ndebconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)\r\ndebconf: falling back to frontend: Teletype\r\nSelecting previously unselected package unzip.\r\n(Reading database ... \r(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r(Reading database ... 70%\r(Reading database ... 75%\r(Reading database ... 80%\r(Reading database ... 85%\r(Reading database ... 90%\r(Reading database ... 95%\r(Reading database ... 100%\r(Reading database ... 21827 files and directories currently installed.)\r\nPreparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...\r\nUnpacking unzip (6.0-16+deb8u3) ...\r\nProcessing triggers for mime-support (3.58) ...\r\nProcessing triggers for man-db (2.7.0.2-5) ...\r\nSetting up unzip (6.0-16+deb8u3) ...\r\n\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m\r\nArchive:  /tmp/v2ray/v2ray.zip\r\n  inflating: /tmp/v2ray/config.json  \r\n   creating: /tmp/v2ray/doc/\r\n  inflating: /tmp/v2ray/doc/readme.md  \r\n  inflating: /tmp/v2ray/geoip.dat    \r\n  inflating: /tmp/v2ray/geosite.dat  \r\n   creating: /tmp/v2ray/systemd/\r\n  inflating: /tmp/v2ray/systemd/v2ray.service  \r\n   creating: /tmp/v2ray/systemv/\r\n  inflating: /tmp/v2ray/systemv/v2ray  \r\n  inflating: /tmp/v2ray/v2ctl        \r\n extracting: /tmp/v2ray/v2ctl.sig    \r\n  inflating: /tmp/v2ray/v2ray        \r\n extracting: /tmp/v2ray/v2ray.sig    \r\n  inflating: /tmp/v2ray/vpoint_socks_vmess.json  \r\n  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  \r\n\u001b[36mShutting down V2Ray service.\u001b[0m\r\nFailed to stop v2ray.service: Unit v2ray.service not loaded.\r\n\u001b[33mFailed to shutdown V2Ray service.\u001b[0m\r\n\u001b[36mPORT:28534\u001b[0m\r\n\u001b[36mUUID:780d60aa-4f5c-407b-a370-a6390866e286\u001b[0m\r\nCreated symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.\r\n\u001b[36mRestarting V2Ray service.\u001b[0m\r\n\u001b[32mV2Ray v4.18.0 is installed.\u001b[0m\r\nv2ray服务端安装成功\r\ncp /etc/v2ray/config.json /root/\r\nconfig文件备份成功\r\n", 
    "stdout_lines": [
        "安装v2ray服务端", 
        "bash <(curl -L -s https://install.direct/go.sh)", 
        "\u001b[36mInstalling V2Ray v4.18.0 on x86_64\u001b[0m", 
        "\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.0/v2ray-linux-64.zip\u001b[0m", 
        "  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current", 
        "                                 Dload  Upload   Total   Spent    Left  Speed", 
        "", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "100   608    0   608    0     0   1036      0 --:--:-- --:--:-- --:--:--  1037", 
        "", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "  1 10.5M    1  126k    0     0  73838      0  0:02:29  0:00:01  0:02:28  126k", 
        " 60 10.5M   60 6522k    0     0  2386k      0  0:00:04  0:00:02  0:00:02 3298k", 
        "100 10.5M  100 10.5M    0     0  3715k      0  0:00:02  0:00:02 --:--:-- 5020k", 
        "\u001b[36mUpdating software repo\u001b[0m", 
        "\u001b[36mInstalling unzip\u001b[0m", 
        "debconf: unable to initialize frontend: Dialog", 
        "debconf: (TERM is not set, so the dialog frontend is not usable.)", 
        "debconf: falling back to frontend: Readline", 
        "debconf: unable to initialize frontend: Readline", 
        "debconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)", 
        "debconf: falling back to frontend: Teletype", 
        "Selecting previously unselected package unzip.", 
        "(Reading database ... ", 
        "(Reading database ... 5%", 
        "(Reading database ... 10%", 
        "(Reading database ... 15%", 
        "(Reading database ... 20%", 
        "(Reading database ... 25%", 
        "(Reading database ... 30%", 
        "(Reading database ... 35%", 
        "(Reading database ... 40%", 
        "(Reading database ... 45%", 
        "(Reading database ... 50%", 
        "(Reading database ... 55%", 
        "(Reading database ... 60%", 
        "(Reading database ... 65%", 
        "(Reading database ... 70%", 
        "(Reading database ... 75%", 
        "(Reading database ... 80%", 
        "(Reading database ... 85%", 
        "(Reading database ... 90%", 
        "(Reading database ... 95%", 
        "(Reading database ... 100%", 
        "(Reading database ... 21827 files and directories currently installed.)", 
        "Preparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...", 
        "Unpacking unzip (6.0-16+deb8u3) ...", 
        "Processing triggers for mime-support (3.58) ...", 
        "Processing triggers for man-db (2.7.0.2-5) ...", 
        "Setting up unzip (6.0-16+deb8u3) ...", 
        "\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m", 
        "Archive:  /tmp/v2ray/v2ray.zip", 
        "  inflating: /tmp/v2ray/config.json  ", 
        "   creating: /tmp/v2ray/doc/", 
        "  inflating: /tmp/v2ray/doc/readme.md  ", 
        "  inflating: /tmp/v2ray/geoip.dat    ", 
        "  inflating: /tmp/v2ray/geosite.dat  ", 
        "   creating: /tmp/v2ray/systemd/", 
        "  inflating: /tmp/v2ray/systemd/v2ray.service  ", 
        "   creating: /tmp/v2ray/systemv/", 
        "  inflating: /tmp/v2ray/systemv/v2ray  ", 
        "  inflating: /tmp/v2ray/v2ctl        ", 
        " extracting: /tmp/v2ray/v2ctl.sig    ", 
        "  inflating: /tmp/v2ray/v2ray        ", 
        " extracting: /tmp/v2ray/v2ray.sig    ", 
        "  inflating: /tmp/v2ray/vpoint_socks_vmess.json  ", 
        "  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  ", 
        "\u001b[36mShutting down V2Ray service.\u001b[0m", 
        "Failed to stop v2ray.service: Unit v2ray.service not loaded.", 
        "\u001b[33mFailed to shutdown V2Ray service.\u001b[0m", 
        "\u001b[36mPORT:28534\u001b[0m", 
        "\u001b[36mUUID:780d60aa-4f5c-407b-a370-a6390866e286\u001b[0m", 
        "Created symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.", 
        "\u001b[36mRestarting V2Ray service.\u001b[0m", 
        "\u001b[32mV2Ray v4.18.0 is installed.\u001b[0m", 
        "v2ray服务端安装成功", 
        "cp /etc/v2ray/config.json /root/", 
        "config文件备份成功"
    ]
}
45.32.42.33 | CHANGED => {
    "changed": true, 
    "checksum": "642c4f754bbfa22a465305bf9f28f0be6b8d51d3", 
    "dest": "/etc/v2ray/config.json", 
    "gid": 0, 
    "group": "root", 
    "md5sum": "e1c9ae8913976ca140c692152b5ade95", 
    "mode": "0644", 
    "owner": "root", 
    "size": 1448, 
    "src": "/root/.ansible/tmp/ansible-tmp-1557909192.52-258645590274480/source", 
    "state": "file", 
    "uid": 0
}
2019-05-15 04:33:23 v2ray服务端安装完毕！
2019-05-15 04:33:23 获取v2ray服务器的IP\PORT\ID
45.32.42.33 | CHANGED | rc=0 >>
{
  "inbounds": [{
    "port": 28534,
    "protocol": "vmess",
    "settings": {
      "clients": [
        {
          "id": "780d60aa-4f5c-407b-a370-a6390866e286",
          "level": 1,
          "alterId": 64
        }
      ]
    }
  }],
  "outbounds": [{
    "protocol": "freedom",
    "settings": {}
  },{
    "protocol": "blackhole",
    "settings": {},
    "tag": "blocked"
  }],
  "routing": {
    "rules": [
      {
        "type": "field",
        "ip": ["geoip:private"],
        "outboundTag": "blocked"
      }
    ]
  }
}
45.32.42.33 | CHANGED | rc=0 >>
{
  "log" : {
    "access": "/var/log/v2ray/access.log",
    "error": "/var/log/v2ray/error.log",
    "loglevel": "warning"
  },
  "inbound": {
    "port": 31139,
    "protocol": "vmess", 
    "settings": {
      "clients": [
        {
          "id": "805ed8a8-7967-49c0-9f5d-057e86920c49",
          "level": 1,
          "alterId": 64
        }
      ],
      "detour":{
        "to":"dynamicPort"
      }
    },
    "streamSettings":{
      "network":"kcp"
    }
  },
  "inboundDetour":[
    {
      "protocol": "vmess",
      "port": "10000-20000",
      "tag": "dynamicPort",       
      "settings": {
        "default": {
          "level": 1,
          "alterId": 32
        }
      },
      "allocate": {            
        "strategy": "random",  
        "concurrency": 2,      
        "refresh": 3           
      },
      "streamSettings": {
        "network": "kcp"
      }
    }
  ],
  "outbound": {
    "protocol": "freedom",
    "settings": {}
  },
  "outboundDetour": [
    {
      "protocol": "blackhole",
      "settings": {},
      "tag": "blocked"
    }
  ],
 "transport":{
      "tcpSettings":{
         "connectionReuse":true
      },
      "kcpSettings":{ 
         "mtu":1350,
         "tti":20,
         "uplinkCapacity":100,
         "downlinkCapacity":100,
         "congestion":false,
         "readBufferSize":5,
         "writeBufferSize":5,
         "header":{
            "type":"utp"
         }
      }
   }
}
2019-05-15 04:33:50 45.32.42.33     "port": 28534,           "id": "780d60aa-4f5c-407b-a370-a6390866e286",
2019-05-15 04:33:50 正在修改-----------------
45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

2019-05-15 04:34:14 修改完毕，v2ray服务端配置成功!重启v2ray服务器
45.32.42.33 | CHANGED | rc=0 >>

2019-05-15 04:34:20 v2ray服务重启成功！
2019-05-15 04:34:20 -------------------
2019-05-15 04:35:20 更新局域网的网关服务
2019-05-15 04:35:20 正在验证gw 分组是否存在,请稍后...
2019-05-15 04:35:21 验证成功gw分组存在！分组名为gw
2019-05-15 04:36:21 正在验证gmasterw 分组是否存在,请稍后...
2019-05-15 04:36:29 验证成功gmasterw 分组存在！分组名为gmasterw
2019-05-15 04:36:37 v2ray_server的IP是45.32.42.33
2019-05-15 04:36:43     "port": 28534,
2019-05-15 04:36:47           "id": "780d60aa-4f5c-407b-a370-a6390866e286",
2019-05-15 04:36:47 下一步需要修改gw 组的配置文件，现在正在形成参数
2019-05-15 04:36:47 修改gw的配置文件/etc/v2ray/config.json,/opt/v2ray-firewall
2019-05-15 04:36:47 1.拼接ip地址
2019-05-15 04:36:47 "address":"45.32.42.33",
2019-05-15 04:36:47 2.拼接端口号
2019-05-15 04:36:47 "port": 28534,
2019-05-15 04:36:47 3.拼接id
2019-05-15 04:36:47 "id": "780d60aa-4f5c-407b-a370-a6390866e286",
2019-05-15 04:36:47 执行修改局域网GW的配置文件
2019-05-15 04:36:47 配置ip地址
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-15 04:36:50 配置端口
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-15 04:36:51 配置id
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-15 04:36:53 配置防火墙
2019-05-15 04:36:53 1.拼接防火墙
2019-05-15 04:36:53 iptables -t nat -A V2RAY -d 45.32.42.33 -j RETURN
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-15 04:36:54 重启gw的v2ray服务
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-15 04:36:58 服务重启成功！
2019-05-15 04:36:58 配置完毕！
                                                                              
2019-05-15 04:36:58 检测的网关名为ggww
2019-05-15 04:37:00 获取的v2ray服务器IP地址为45.76.219.250
2019-05-15 04:37:00 收集vultr的服务器列表
2019-05-15 04:37:05 ggww 调用API成功，开始执行监控程序
2019-05-15 04:37:05 获取的v2ray服务器subid为 24749973
2019-05-15 04:37:05 获取的v2ray服务器DCID为 25
2019-05-15 04:37:05 获取的v2ray服务器label为gslavew
2019-05-15 04:37:07 获取v2ray服务器宽带使用率为 367680538 字节
2019-05-15 04:37:07 获取的宽带使用率为0 G
2019-05-15 04:37:07 流量小于50G，监控结束！
                                                                              
2019-05-15 04:37:07 检测的网关名为dns
2019-05-15 04:37:09 获取的v2ray服务器IP地址为108.160.133.156
2019-05-15 04:37:09 收集vultr的服务器列表
2019-05-15 04:37:15 dns 调用API成功，开始执行监控程序
2019-05-15 04:37:15 获取的v2ray服务器subid为 24750017
2019-05-15 04:37:15 获取的v2ray服务器DCID为 25
2019-05-15 04:37:15 获取的v2ray服务器label为ddnnss
2019-05-15 04:37:19 获取v2ray服务器宽带使用率为 15664097 字节
2019-05-15 04:37:19 获取的宽带使用率为0 G
2019-05-15 04:37:19 流量小于50G，监控结束！
                                                                              
2019-05-15 04:37:19 检测的网关名为wifigw
2019-05-15 04:37:21 获取的v2ray服务器IP地址为202.182.100.205
2019-05-15 04:37:21 收集vultr的服务器列表
2019-05-15 04:37:23 wifigw 调用API成功，开始执行监控程序
2019-05-15 04:37:23 获取的v2ray服务器subid为 24750075
2019-05-15 04:37:23 获取的v2ray服务器DCID为 25
2019-05-15 04:37:23 获取的v2ray服务器label为wimasterfi
2019-05-15 04:37:28 获取v2ray服务器宽带使用率为 3601931 字节
2019-05-15 04:37:28 获取的宽带使用率为0 G
2019-05-15 04:37:28 流量小于50G，监控结束！
                                                                              
2019-05-15 04:37:28 检测的网关名为wifiggww
2019-05-15 04:37:30 获取的v2ray服务器IP地址为108.61.162.89
2019-05-15 04:37:30 收集vultr的服务器列表
2019-05-15 04:37:32 wifiggww 调用API成功，开始执行监控程序
2019-05-15 04:37:32 获取的v2ray服务器subid为 24759568
2019-05-15 04:37:32 获取的v2ray服务器DCID为 25
2019-05-15 04:37:32 获取的v2ray服务器label为wislavefi
2019-05-15 04:37:34 获取v2ray服务器宽带使用率为  字节
2019-05-15 04:37:34 获取的宽带使用率为 G
2019-05-15 04:37:34 流量小于50G，监控结束！
                                                                              
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                                                              
                                                                              
2019-05-16 04:30:01 检测的网关名为gw
2019-05-16 04:30:03 获取的v2ray服务器IP地址为45.32.42.33
2019-05-16 04:30:03 收集vultr的服务器列表
2019-05-16 04:30:15 gw 调用API成功，开始执行监控程序
2019-05-16 04:30:15 获取的v2ray服务器subid为 24759974
2019-05-16 04:30:15 获取的v2ray服务器DCID为 25
2019-05-16 04:30:15 获取的v2ray服务器label为gmasterw
2019-05-16 04:30:17 获取v2ray服务器宽带使用率为 133456296899 字节
2019-05-16 04:30:17 获取的宽带使用率为124 G
2019-05-16 04:30:17 触发重新搭建服务器条件,同时将keepalived服务停用
2019-05-16 04:30:17 正在停用keepalived服务
10.24.1.254 | CHANGED | rc=0 >>

2019-05-16 04:30:18 gw 的keepalived服务停用成功
2019-05-16 04:30:18 正在销毁v2ray服务器
2019-05-16 04:30:23 等待删除gmasterw
2019-05-16 04:30:53 删除gmasterw 成功
2019-05-16 04:30:53 获取gw 使用的v2ray服务器的label	gmasterw
2019-05-16 04:30:53 重新安装v2ray服务器
2019-05-16 04:30:56 installing server......
2019-05-16 04:30:56 正在安装的v2ray服务器的subid为24784565
2019-05-16 04:31:23 新建的v2ray服务器IP地址为45.32.42.33
2019-05-16 04:31:30 获取的v2ray服务器的密码为b]B2#8=S[d37+GZK
2019-05-16 04:31:30 sleep 60
2019-05-16 04:32:31 检查v2ray服务器ip地址存在！
2019-05-16 04:32:31 ------------------------
2019-05-16 04:32:31 清理本地已经存在45.32.42.33 的密钥
# Host 45.32.42.33 found: line 15
/root/.ssh/known_hosts updated.
Original contents retained as /root/.ssh/known_hosts.old
2019-05-16 04:32:31 重新添加45.32.42.33 的密钥，正在添加密钥！
2019-05-16 04:32:33 v2ray_server安装ssh密钥
2019-05-16 04:32:35 ------------
2019-05-16 04:32:35 正在配置ansible主控端
2019-05-16 04:32:35 gmasterw 已存在
2019-05-16 04:32:35 主控端配置完毕！
2019-05-16 04:32:35 ------------
2019-05-16 04:32:35 测试ansible被控端
45.32.42.33 | SUCCESS => {
    "changed": false, 
    "ping": "pong"
}
2019-05-16 04:32:46 主控端配置成功！
2019-05-16 04:32:46 -------------------
2019-05-16 04:32:46 开始安装v2ray服务端,并且进行配置，使用ansible的script模块拷贝配置文件
45.32.42.33 | CHANGED => {
    "changed": true, 
    "rc": 0, 
    "stderr": "Shared connection to 45.32.42.33 closed.\r\n", 
    "stderr_lines": [
        "Shared connection to 45.32.42.33 closed."
    ], 
    "stdout": "安装v2ray服务端\r\nbash <(curl -L -s https://install.direct/go.sh)\r\n\u001b[36mInstalling V2Ray v4.18.0 on x86_64\u001b[0m\r\n\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.0/v2ray-linux-64.zip\u001b[0m\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r100   608    0   608    0     0   1193      0 --:--:-- --:--:-- --:--:--  1194\r\n\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r  0 10.5M    0 50738    0     0  31088      0  0:05:56  0:00:01  0:05:55 54439\r 10 10.5M   10 1103k    0     0   426k      0  0:00:25  0:00:02  0:00:23  584k\r 93 10.5M   93  9.8M    0     0  2765k      0  0:00:03  0:00:03 --:--:-- 3421k\r100 10.5M  100 10.5M    0     0  2959k      0  0:00:03  0:00:03 --:--:-- 3661k\r\n\u001b[36mUpdating software repo\u001b[0m\r\n\u001b[36mInstalling unzip\u001b[0m\r\ndebconf: unable to initialize frontend: Dialog\r\ndebconf: (TERM is not set, so the dialog frontend is not usable.)\r\ndebconf: falling back to frontend: Readline\r\ndebconf: unable to initialize frontend: Readline\r\ndebconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)\r\ndebconf: falling back to frontend: Teletype\r\nSelecting previously unselected package unzip.\r\n(Reading database ... \r(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r(Reading database ... 70%\r(Reading database ... 75%\r(Reading database ... 80%\r(Reading database ... 85%\r(Reading database ... 90%\r(Reading database ... 95%\r(Reading database ... 100%\r(Reading database ... 21827 files and directories currently installed.)\r\nPreparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...\r\nUnpacking unzip (6.0-16+deb8u3) ...\r\nProcessing triggers for mime-support (3.58) ...\r\nProcessing triggers for man-db (2.7.0.2-5) ...\r\nSetting up unzip (6.0-16+deb8u3) ...\r\n\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m\r\nArchive:  /tmp/v2ray/v2ray.zip\r\n  inflating: /tmp/v2ray/config.json  \r\n   creating: /tmp/v2ray/doc/\r\n  inflating: /tmp/v2ray/doc/readme.md  \r\n  inflating: /tmp/v2ray/geoip.dat    \r\n  inflating: /tmp/v2ray/geosite.dat  \r\n   creating: /tmp/v2ray/systemd/\r\n  inflating: /tmp/v2ray/systemd/v2ray.service  \r\n   creating: /tmp/v2ray/systemv/\r\n  inflating: /tmp/v2ray/systemv/v2ray  \r\n  inflating: /tmp/v2ray/v2ctl        \r\n extracting: /tmp/v2ray/v2ctl.sig    \r\n  inflating: /tmp/v2ray/v2ray        \r\n extracting: /tmp/v2ray/v2ray.sig    \r\n  inflating: /tmp/v2ray/vpoint_socks_vmess.json  \r\n  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  \r\n\u001b[36mShutting down V2Ray service.\u001b[0m\r\nFailed to stop v2ray.service: Unit v2ray.service not loaded.\r\n\u001b[33mFailed to shutdown V2Ray service.\u001b[0m\r\n\u001b[36mPORT:27576\u001b[0m\r\n\u001b[36mUUID:7601359e-fd17-43b2-9f7c-9c6fe34d8521\u001b[0m\r\nCreated symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.\r\n\u001b[36mRestarting V2Ray service.\u001b[0m\r\n\u001b[32mV2Ray v4.18.0 is installed.\u001b[0m\r\nv2ray服务端安装成功\r\ncp /etc/v2ray/config.json /root/\r\nconfig文件备份成功\r\n", 
    "stdout_lines": [
        "安装v2ray服务端", 
        "bash <(curl -L -s https://install.direct/go.sh)", 
        "\u001b[36mInstalling V2Ray v4.18.0 on x86_64\u001b[0m", 
        "\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.0/v2ray-linux-64.zip\u001b[0m", 
        "  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current", 
        "                                 Dload  Upload   Total   Spent    Left  Speed", 
        "", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "100   608    0   608    0     0   1193      0 --:--:-- --:--:-- --:--:--  1194", 
        "", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "  0 10.5M    0 50738    0     0  31088      0  0:05:56  0:00:01  0:05:55 54439", 
        " 10 10.5M   10 1103k    0     0   426k      0  0:00:25  0:00:02  0:00:23  584k", 
        " 93 10.5M   93  9.8M    0     0  2765k      0  0:00:03  0:00:03 --:--:-- 3421k", 
        "100 10.5M  100 10.5M    0     0  2959k      0  0:00:03  0:00:03 --:--:-- 3661k", 
        "\u001b[36mUpdating software repo\u001b[0m", 
        "\u001b[36mInstalling unzip\u001b[0m", 
        "debconf: unable to initialize frontend: Dialog", 
        "debconf: (TERM is not set, so the dialog frontend is not usable.)", 
        "debconf: falling back to frontend: Readline", 
        "debconf: unable to initialize frontend: Readline", 
        "debconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)", 
        "debconf: falling back to frontend: Teletype", 
        "Selecting previously unselected package unzip.", 
        "(Reading database ... ", 
        "(Reading database ... 5%", 
        "(Reading database ... 10%", 
        "(Reading database ... 15%", 
        "(Reading database ... 20%", 
        "(Reading database ... 25%", 
        "(Reading database ... 30%", 
        "(Reading database ... 35%", 
        "(Reading database ... 40%", 
        "(Reading database ... 45%", 
        "(Reading database ... 50%", 
        "(Reading database ... 55%", 
        "(Reading database ... 60%", 
        "(Reading database ... 65%", 
        "(Reading database ... 70%", 
        "(Reading database ... 75%", 
        "(Reading database ... 80%", 
        "(Reading database ... 85%", 
        "(Reading database ... 90%", 
        "(Reading database ... 95%", 
        "(Reading database ... 100%", 
        "(Reading database ... 21827 files and directories currently installed.)", 
        "Preparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...", 
        "Unpacking unzip (6.0-16+deb8u3) ...", 
        "Processing triggers for mime-support (3.58) ...", 
        "Processing triggers for man-db (2.7.0.2-5) ...", 
        "Setting up unzip (6.0-16+deb8u3) ...", 
        "\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m", 
        "Archive:  /tmp/v2ray/v2ray.zip", 
        "  inflating: /tmp/v2ray/config.json  ", 
        "   creating: /tmp/v2ray/doc/", 
        "  inflating: /tmp/v2ray/doc/readme.md  ", 
        "  inflating: /tmp/v2ray/geoip.dat    ", 
        "  inflating: /tmp/v2ray/geosite.dat  ", 
        "   creating: /tmp/v2ray/systemd/", 
        "  inflating: /tmp/v2ray/systemd/v2ray.service  ", 
        "   creating: /tmp/v2ray/systemv/", 
        "  inflating: /tmp/v2ray/systemv/v2ray  ", 
        "  inflating: /tmp/v2ray/v2ctl        ", 
        " extracting: /tmp/v2ray/v2ctl.sig    ", 
        "  inflating: /tmp/v2ray/v2ray        ", 
        " extracting: /tmp/v2ray/v2ray.sig    ", 
        "  inflating: /tmp/v2ray/vpoint_socks_vmess.json  ", 
        "  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  ", 
        "\u001b[36mShutting down V2Ray service.\u001b[0m", 
        "Failed to stop v2ray.service: Unit v2ray.service not loaded.", 
        "\u001b[33mFailed to shutdown V2Ray service.\u001b[0m", 
        "\u001b[36mPORT:27576\u001b[0m", 
        "\u001b[36mUUID:7601359e-fd17-43b2-9f7c-9c6fe34d8521\u001b[0m", 
        "Created symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.", 
        "\u001b[36mRestarting V2Ray service.\u001b[0m", 
        "\u001b[32mV2Ray v4.18.0 is installed.\u001b[0m", 
        "v2ray服务端安装成功", 
        "cp /etc/v2ray/config.json /root/", 
        "config文件备份成功"
    ]
}
45.32.42.33 | CHANGED => {
    "changed": true, 
    "checksum": "642c4f754bbfa22a465305bf9f28f0be6b8d51d3", 
    "dest": "/etc/v2ray/config.json", 
    "gid": 0, 
    "group": "root", 
    "md5sum": "e1c9ae8913976ca140c692152b5ade95", 
    "mode": "0644", 
    "owner": "root", 
    "size": 1448, 
    "src": "/root/.ansible/tmp/ansible-tmp-1557995583.0-216556951120869/source", 
    "state": "file", 
    "uid": 0
}
2019-05-16 04:33:11 v2ray服务端安装完毕！
2019-05-16 04:33:11 获取v2ray服务器的IP\PORT\ID
45.32.42.33 | CHANGED | rc=0 >>
{
  "inbounds": [{
    "port": 27576,
    "protocol": "vmess",
    "settings": {
      "clients": [
        {
          "id": "7601359e-fd17-43b2-9f7c-9c6fe34d8521",
          "level": 1,
          "alterId": 64
        }
      ]
    }
  }],
  "outbounds": [{
    "protocol": "freedom",
    "settings": {}
  },{
    "protocol": "blackhole",
    "settings": {},
    "tag": "blocked"
  }],
  "routing": {
    "rules": [
      {
        "type": "field",
        "ip": ["geoip:private"],
        "outboundTag": "blocked"
      }
    ]
  }
}
45.32.42.33 | CHANGED | rc=0 >>
{
  "log" : {
    "access": "/var/log/v2ray/access.log",
    "error": "/var/log/v2ray/error.log",
    "loglevel": "warning"
  },
  "inbound": {
    "port": 31139,
    "protocol": "vmess", 
    "settings": {
      "clients": [
        {
          "id": "805ed8a8-7967-49c0-9f5d-057e86920c49",
          "level": 1,
          "alterId": 64
        }
      ],
      "detour":{
        "to":"dynamicPort"
      }
    },
    "streamSettings":{
      "network":"kcp"
    }
  },
  "inboundDetour":[
    {
      "protocol": "vmess",
      "port": "10000-20000",
      "tag": "dynamicPort",       
      "settings": {
        "default": {
          "level": 1,
          "alterId": 32
        }
      },
      "allocate": {            
        "strategy": "random",  
        "concurrency": 2,      
        "refresh": 3           
      },
      "streamSettings": {
        "network": "kcp"
      }
    }
  ],
  "outbound": {
    "protocol": "freedom",
    "settings": {}
  },
  "outboundDetour": [
    {
      "protocol": "blackhole",
      "settings": {},
      "tag": "blocked"
    }
  ],
 "transport":{
      "tcpSettings":{
         "connectionReuse":true
      },
      "kcpSettings":{ 
         "mtu":1350,
         "tti":20,
         "uplinkCapacity":100,
         "downlinkCapacity":100,
         "congestion":false,
         "readBufferSize":5,
         "writeBufferSize":5,
         "header":{
            "type":"utp"
         }
      }
   }
}
2019-05-16 04:33:33 45.32.42.33     "port": 27576,           "id": "7601359e-fd17-43b2-9f7c-9c6fe34d8521",
2019-05-16 04:33:33 正在修改-----------------
45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

2019-05-16 04:33:48 修改完毕，v2ray服务端配置成功!重启v2ray服务器
45.32.42.33 | CHANGED | rc=0 >>

2019-05-16 04:33:52 v2ray服务重启成功！
2019-05-16 04:33:52 -------------------
2019-05-16 04:34:52 更新局域网的网关服务
2019-05-16 04:34:52 正在验证gw 分组是否存在,请稍后...
2019-05-16 04:34:54 验证成功gw分组存在！分组名为gw
2019-05-16 04:35:54 正在验证gmasterw 分组是否存在,请稍后...
2019-05-16 04:36:09 验证成功gmasterw 分组存在！分组名为gmasterw
2019-05-16 04:36:17 v2ray_server的IP是45.32.42.33
2019-05-16 04:36:25     "port": 27576,
2019-05-16 04:36:36           "id": "7601359e-fd17-43b2-9f7c-9c6fe34d8521",
2019-05-16 04:36:36 下一步需要修改gw 组的配置文件，现在正在形成参数
2019-05-16 04:36:36 修改gw的配置文件/etc/v2ray/config.json,/opt/v2ray-firewall
2019-05-16 04:36:36 1.拼接ip地址
2019-05-16 04:36:36 "address":"45.32.42.33",
2019-05-16 04:36:36 2.拼接端口号
2019-05-16 04:36:36 "port": 27576,
2019-05-16 04:36:36 3.拼接id
2019-05-16 04:36:36 "id": "7601359e-fd17-43b2-9f7c-9c6fe34d8521",
2019-05-16 04:36:36 执行修改局域网GW的配置文件
2019-05-16 04:36:36 配置ip地址
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-16 04:36:38 配置端口
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-16 04:36:40 配置id
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-16 04:36:41 配置防火墙
2019-05-16 04:36:41 1.拼接防火墙
2019-05-16 04:36:41 iptables -t nat -A V2RAY -d 45.32.42.33 -j RETURN
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-16 04:36:42 重启gw的v2ray服务
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-16 04:36:46 服务重启成功！
2019-05-16 04:36:46 配置完毕！
                                                                              
2019-05-16 04:36:46 检测的网关名为ggww
2019-05-16 04:36:48 获取的v2ray服务器IP地址为45.76.219.250
2019-05-16 04:36:48 收集vultr的服务器列表
2019-05-16 04:36:52 ggww 调用API成功，开始执行监控程序
2019-05-16 04:36:52 获取的v2ray服务器subid为 24783692
2019-05-16 04:36:52 获取的v2ray服务器DCID为 25
2019-05-16 04:36:52 获取的v2ray服务器label为gslavew
2019-05-16 04:36:53 获取v2ray服务器宽带使用率为 34155197863 字节
2019-05-16 04:36:53 获取的宽带使用率为31 G
2019-05-16 04:36:53 流量小于50G，监控结束！
                                                                              
2019-05-16 04:36:53 检测的网关名为dns
2019-05-16 04:36:56 获取的v2ray服务器IP地址为108.160.133.156
2019-05-16 04:36:56 收集vultr的服务器列表
2019-05-16 04:36:57 dns 调用API成功，开始执行监控程序
2019-05-16 04:36:57 获取的v2ray服务器subid为 24750017
2019-05-16 04:36:57 获取的v2ray服务器DCID为 25
2019-05-16 04:36:57 获取的v2ray服务器label为ddnnss
2019-05-16 04:36:59 获取v2ray服务器宽带使用率为 9131414401 字节
2019-05-16 04:36:59 获取的宽带使用率为8 G
2019-05-16 04:36:59 流量小于50G，监控结束！
                                                                              
2019-05-16 04:36:59 检测的网关名为wifigw
2019-05-16 04:37:01 获取的v2ray服务器IP地址为202.182.100.205
2019-05-16 04:37:01 收集vultr的服务器列表
2019-05-16 04:37:03 wifigw 调用API成功，开始执行监控程序
2019-05-16 04:37:03 获取的v2ray服务器subid为 24750075
2019-05-16 04:37:03 获取的v2ray服务器DCID为 25
2019-05-16 04:37:03 获取的v2ray服务器label为wimasterfi
2019-05-16 04:37:11 获取v2ray服务器宽带使用率为 16630410 字节
2019-05-16 04:37:11 获取的宽带使用率为0 G
2019-05-16 04:37:11 流量小于50G，监控结束！
                                                                              
2019-05-16 04:37:11 检测的网关名为wifiggww
2019-05-16 04:37:13 获取的v2ray服务器IP地址为108.61.162.89
2019-05-16 04:37:13 收集vultr的服务器列表
2019-05-16 04:37:20 wifiggww 调用API成功，开始执行监控程序
2019-05-16 04:37:20 获取的v2ray服务器subid为 24759568
2019-05-16 04:37:20 获取的v2ray服务器DCID为 25
2019-05-16 04:37:20 获取的v2ray服务器label为wislavefi
2019-05-16 04:37:22 获取v2ray服务器宽带使用率为 6069240 字节
2019-05-16 04:37:22 获取的宽带使用率为0 G
2019-05-16 04:37:22 流量小于50G，监控结束！
                                                                              
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                                                              
                                                                              
2019-05-18 04:30:01 检测的网关名为gw
2019-05-18 04:30:03 获取的v2ray服务器IP地址为45.32.42.33
2019-05-18 04:30:03 收集vultr的服务器列表
2019-05-18 04:30:04 gw 调用API成功，开始执行监控程序
2019-05-18 04:30:04 获取的v2ray服务器subid为 24803405
2019-05-18 04:30:04 获取的v2ray服务器DCID为 25
2019-05-18 04:30:04 获取的v2ray服务器label为gmasterw
2019-05-18 04:32:12 获取v2ray服务器宽带使用率为  字节
2019-05-18 04:32:12 获取的宽带使用率为 G
2019-05-18 04:32:12 流量小于10G，监控结束！
                                                                              
2019-05-18 04:32:12 检测的网关名为ggww
2019-05-18 04:32:14 获取的v2ray服务器IP地址为45.76.219.250
2019-05-18 04:32:14 收集vultr的服务器列表
2019-05-18 04:32:22 ggww 调用API成功，开始执行监控程序
2019-05-18 04:32:22 获取的v2ray服务器subid为 24803570
2019-05-18 04:32:22 获取的v2ray服务器DCID为 25
2019-05-18 04:32:22 获取的v2ray服务器label为gslavew
2019-05-18 04:32:23 获取v2ray服务器宽带使用率为 1812978837 字节
2019-05-18 04:32:23 获取的宽带使用率为1 G
2019-05-18 04:32:23 流量小于10G，监控结束！
                                                                              
2019-05-18 04:32:23 检测的网关名为dns
2019-05-18 04:32:25 获取的v2ray服务器IP地址为108.160.133.156
2019-05-18 04:32:25 收集vultr的服务器列表
2019-05-18 04:32:26 dns 调用API成功，开始执行监控程序
2019-05-18 04:32:26 获取的v2ray服务器subid为 24750017
2019-05-18 04:32:26 获取的v2ray服务器DCID为 25
2019-05-18 04:32:26 获取的v2ray服务器label为ddnnss
2019-05-18 04:32:27 获取v2ray服务器宽带使用率为 9197171750 字节
2019-05-18 04:32:27 获取的宽带使用率为8 G
2019-05-18 04:32:27 流量小于10G，监控结束！
                                                                              
2019-05-18 04:32:27 检测的网关名为wifigw
2019-05-18 04:32:29 获取的v2ray服务器IP地址为202.182.100.205
2019-05-18 04:32:29 收集vultr的服务器列表
2019-05-18 04:32:31 wifigw 调用API成功，开始执行监控程序
2019-05-18 04:32:31 获取的v2ray服务器subid为 24750075
2019-05-18 04:32:31 获取的v2ray服务器DCID为 25
2019-05-18 04:32:31 获取的v2ray服务器label为wimasterfi
2019-05-18 04:32:32 获取v2ray服务器宽带使用率为 33057091 字节
2019-05-18 04:32:32 获取的宽带使用率为0 G
2019-05-18 04:32:32 流量小于10G，监控结束！
                                                                              
2019-05-18 04:32:32 检测的网关名为wifiggww
2019-05-18 04:32:34 获取的v2ray服务器IP地址为108.61.162.89
2019-05-18 04:32:34 收集vultr的服务器列表
2019-05-18 04:32:35 wifiggww 调用API成功，开始执行监控程序
2019-05-18 04:32:35 获取的v2ray服务器subid为 24759568
2019-05-18 04:32:35 获取的v2ray服务器DCID为 25
2019-05-18 04:32:35 获取的v2ray服务器label为wislavefi
2019-05-18 04:32:36 获取v2ray服务器宽带使用率为 18276998 字节
2019-05-18 04:32:36 获取的宽带使用率为0 G
2019-05-18 04:32:36 流量小于10G，监控结束！
                                                                              
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                                                              
                                                                              
2019-05-19 04:30:01 检测的网关名为gw
2019-05-19 04:30:03 获取的v2ray服务器IP地址为45.32.42.33
2019-05-19 04:30:03 收集vultr的服务器列表
2019-05-19 04:30:04 gw 调用API成功，开始执行监控程序
2019-05-19 04:30:04 获取的v2ray服务器subid为 24824315
2019-05-19 04:30:04 获取的v2ray服务器DCID为 25
2019-05-19 04:30:04 获取的v2ray服务器label为gmasterw
2019-05-19 04:30:06 获取v2ray服务器宽带使用率为 3495081759 字节
2019-05-19 04:30:06 获取的宽带使用率为3 G
2019-05-19 04:30:06 流量小于10G，监控结束！
                                                                              
2019-05-19 04:30:06 检测的网关名为ggww
2019-05-19 04:30:07 获取的v2ray服务器IP地址为45.76.219.250
2019-05-19 04:30:07 收集vultr的服务器列表
2019-05-19 04:30:09 ggww 调用API成功，开始执行监控程序
2019-05-19 04:30:09 获取的v2ray服务器subid为 24803570
2019-05-19 04:30:09 获取的v2ray服务器DCID为 25
2019-05-19 04:30:09 获取的v2ray服务器label为gslavew
2019-05-19 04:30:10 获取v2ray服务器宽带使用率为 1942896453 字节
2019-05-19 04:30:10 获取的宽带使用率为1 G
2019-05-19 04:30:10 流量小于10G，监控结束！
                                                                              
2019-05-19 04:30:10 检测的网关名为dns
2019-05-19 04:30:12 获取的v2ray服务器IP地址为108.160.133.156
2019-05-19 04:30:12 收集vultr的服务器列表
2019-05-19 04:30:13 dns 调用API成功，开始执行监控程序
2019-05-19 04:30:13 获取的v2ray服务器subid为 24750017
2019-05-19 04:30:13 获取的v2ray服务器DCID为 25
2019-05-19 04:30:13 获取的v2ray服务器label为ddnnss
2019-05-19 04:30:14 获取v2ray服务器宽带使用率为 9230026294 字节
2019-05-19 04:30:14 获取的宽带使用率为8 G
2019-05-19 04:30:14 流量小于10G，监控结束！
                                                                              
2019-05-19 04:30:14 检测的网关名为wifigw
2019-05-19 04:30:16 获取的v2ray服务器IP地址为202.182.100.205
2019-05-19 04:30:16 收集vultr的服务器列表
2019-05-19 04:30:17 wifigw 调用API成功，开始执行监控程序
2019-05-19 04:30:17 获取的v2ray服务器subid为 24750075
2019-05-19 04:30:17 获取的v2ray服务器DCID为 25
2019-05-19 04:30:17 获取的v2ray服务器label为wimasterfi
2019-05-19 04:30:18 获取v2ray服务器宽带使用率为 41732185 字节
2019-05-19 04:30:18 获取的宽带使用率为0 G
2019-05-19 04:30:18 流量小于10G，监控结束！
                                                                              
2019-05-19 04:30:18 检测的网关名为wifiggww
2019-05-19 04:30:20 获取的v2ray服务器IP地址为108.61.162.89
2019-05-19 04:30:20 收集vultr的服务器列表
2019-05-19 04:30:21 wifiggww 调用API成功，开始执行监控程序
2019-05-19 04:30:21 获取的v2ray服务器subid为 24759568
2019-05-19 04:30:21 获取的v2ray服务器DCID为 25
2019-05-19 04:30:21 获取的v2ray服务器label为wislavefi
2019-05-19 04:30:23 获取v2ray服务器宽带使用率为 24099933 字节
2019-05-19 04:30:23 获取的宽带使用率为0 G
2019-05-19 04:30:23 流量小于10G，监控结束！
                                                                              
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                                                              
                                                                              
2019-05-20 04:30:01 检测的网关名为gw
2019-05-20 04:30:03 获取的v2ray服务器IP地址为45.32.42.33
2019-05-20 04:30:03 收集vultr的服务器列表
2019-05-20 04:30:04 gw 调用API成功，开始执行监控程序
2019-05-20 04:30:04 获取的v2ray服务器subid为 24824315
2019-05-20 04:30:04 获取的v2ray服务器DCID为 25
2019-05-20 04:30:04 获取的v2ray服务器label为gmasterw
2019-05-20 04:30:05 获取v2ray服务器宽带使用率为 11888805784 字节
2019-05-20 04:30:05 获取的宽带使用率为11 G
2019-05-20 04:30:05 触发重新搭建服务器条件,同时将keepalived服务停用
2019-05-20 04:30:05 正在停用keepalived服务
10.24.1.254 | CHANGED | rc=0 >>

2019-05-20 04:30:07 gw 的keepalived服务停用成功
2019-05-20 04:30:07 正在销毁v2ray服务器
2019-05-20 04:30:08 等待删除gmasterw
2019-05-20 04:30:38 删除gmasterw 成功
2019-05-20 04:30:38 获取gw 使用的v2ray服务器的label	gmasterw
2019-05-20 04:30:38 重新安装v2ray服务器
2019-05-20 04:30:41 installing server......
2019-05-20 04:30:41 正在安装的v2ray服务器的subid为24865714
2019-05-20 04:31:02 新建的v2ray服务器IP地址为45.32.42.33
2019-05-20 04:31:04 获取的v2ray服务器的密码为5bT@U_AzYJv#vYz+
2019-05-20 04:31:04 sleep 60
2019-05-20 04:32:05 检查v2ray服务器ip地址存在！
2019-05-20 04:32:05 ------------------------
2019-05-20 04:32:05 清理本地已经存在45.32.42.33 的密钥
# Host 45.32.42.33 found: line 18
/root/.ssh/known_hosts updated.
Original contents retained as /root/.ssh/known_hosts.old
2019-05-20 04:32:05 重新添加45.32.42.33 的密钥，正在添加密钥！
2019-05-20 04:32:06 v2ray_server安装ssh密钥
2019-05-20 04:32:09 ------------
2019-05-20 04:32:09 正在配置ansible主控端
2019-05-20 04:32:09 gmasterw 已存在
2019-05-20 04:32:09 主控端配置完毕！
2019-05-20 04:32:09 ------------
2019-05-20 04:32:09 测试ansible被控端
45.32.42.33 | SUCCESS => {
    "changed": false, 
    "ping": "pong"
}
2019-05-20 04:32:19 主控端配置成功！
2019-05-20 04:32:19 -------------------
2019-05-20 04:32:19 开始安装v2ray服务端,并且进行配置，使用ansible的script模块拷贝配置文件
45.32.42.33 | CHANGED => {
    "changed": true, 
    "rc": 0, 
    "stderr": "Shared connection to 45.32.42.33 closed.\r\n", 
    "stderr_lines": [
        "Shared connection to 45.32.42.33 closed."
    ], 
    "stdout": "安装v2ray服务端\r\nbash <(curl -L -s https://install.direct/go.sh)\r\n\u001b[36mInstalling V2Ray v4.18.2 on x86_64\u001b[0m\r\n\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.2/v2ray-linux-64.zip\u001b[0m\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r100   608    0   608    0     0   1121      0 --:--:-- --:--:-- --:--:--  1121\r\n\r  0 11.2M    0 50738    0     0  30991      0  0:06:20  0:00:01  0:06:19 30991\r 16 11.2M   16 1953k    0     0   771k      0  0:00:14  0:00:02  0:00:12 2125k\r 75 11.2M   75 8744k    0     0  2420k      0  0:00:04  0:00:03  0:00:01 4400k\r100 11.2M  100 11.2M    0     0  2775k      0  0:00:04  0:00:04 --:--:-- 4562k\r\n\u001b[36mUpdating software repo\u001b[0m\r\n\u001b[36mInstalling unzip\u001b[0m\r\ndebconf: unable to initialize frontend: Dialog\r\ndebconf: (TERM is not set, so the dialog frontend is not usable.)\r\ndebconf: falling back to frontend: Readline\r\ndebconf: unable to initialize frontend: Readline\r\ndebconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)\r\ndebconf: falling back to frontend: Teletype\r\nSelecting previously unselected package unzip.\r\n(Reading database ... \r(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r(Reading database ... 70%\r(Reading database ... 75%\r(Reading database ... 80%\r(Reading database ... 85%\r(Reading database ... 90%\r(Reading database ... 95%\r(Reading database ... 100%\r(Reading database ... 21827 files and directories currently installed.)\r\nPreparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...\r\nUnpacking unzip (6.0-16+deb8u3) ...\r\nProcessing triggers for mime-support (3.58) ...\r\nProcessing triggers for man-db (2.7.0.2-5) ...\r\nSetting up unzip (6.0-16+deb8u3) ...\r\n\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m\r\nArchive:  /tmp/v2ray/v2ray.zip\r\n  inflating: /tmp/v2ray/config.json  \r\n   creating: /tmp/v2ray/doc/\r\n  inflating: /tmp/v2ray/doc/readme.md  \r\n  inflating: /tmp/v2ray/geoip.dat    \r\n  inflating: /tmp/v2ray/geosite.dat  \r\n   creating: /tmp/v2ray/systemd/\r\n  inflating: /tmp/v2ray/systemd/v2ray.service  \r\n   creating: /tmp/v2ray/systemv/\r\n  inflating: /tmp/v2ray/systemv/v2ray  \r\n  inflating: /tmp/v2ray/v2ctl        \r\n extracting: /tmp/v2ray/v2ctl.sig    \r\n  inflating: /tmp/v2ray/v2ray        \r\n extracting: /tmp/v2ray/v2ray.sig    \r\n  inflating: /tmp/v2ray/vpoint_socks_vmess.json  \r\n  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  \r\n\u001b[36mShutting down V2Ray service.\u001b[0m\r\nFailed to stop v2ray.service: Unit v2ray.service not loaded.\r\n\u001b[33mFailed to shutdown V2Ray service.\u001b[0m\r\n\u001b[36mPORT:40614\u001b[0m\r\n\u001b[36mUUID:a159a264-55d9-4e9d-baef-47eb82aea157\u001b[0m\r\nCreated symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.\r\n\u001b[36mRestarting V2Ray service.\u001b[0m\r\n\u001b[32mV2Ray v4.18.2 is installed.\u001b[0m\r\nv2ray服务端安装成功\r\ncp /etc/v2ray/config.json /root/\r\nconfig文件备份成功\r\n", 
    "stdout_lines": [
        "安装v2ray服务端", 
        "bash <(curl -L -s https://install.direct/go.sh)", 
        "\u001b[36mInstalling V2Ray v4.18.2 on x86_64\u001b[0m", 
        "\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.2/v2ray-linux-64.zip\u001b[0m", 
        "  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current", 
        "                                 Dload  Upload   Total   Spent    Left  Speed", 
        "", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "100   608    0   608    0     0   1121      0 --:--:-- --:--:-- --:--:--  1121", 
        "", 
        "  0 11.2M    0 50738    0     0  30991      0  0:06:20  0:00:01  0:06:19 30991", 
        " 16 11.2M   16 1953k    0     0   771k      0  0:00:14  0:00:02  0:00:12 2125k", 
        " 75 11.2M   75 8744k    0     0  2420k      0  0:00:04  0:00:03  0:00:01 4400k", 
        "100 11.2M  100 11.2M    0     0  2775k      0  0:00:04  0:00:04 --:--:-- 4562k", 
        "\u001b[36mUpdating software repo\u001b[0m", 
        "\u001b[36mInstalling unzip\u001b[0m", 
        "debconf: unable to initialize frontend: Dialog", 
        "debconf: (TERM is not set, so the dialog frontend is not usable.)", 
        "debconf: falling back to frontend: Readline", 
        "debconf: unable to initialize frontend: Readline", 
        "debconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)", 
        "debconf: falling back to frontend: Teletype", 
        "Selecting previously unselected package unzip.", 
        "(Reading database ... ", 
        "(Reading database ... 5%", 
        "(Reading database ... 10%", 
        "(Reading database ... 15%", 
        "(Reading database ... 20%", 
        "(Reading database ... 25%", 
        "(Reading database ... 30%", 
        "(Reading database ... 35%", 
        "(Reading database ... 40%", 
        "(Reading database ... 45%", 
        "(Reading database ... 50%", 
        "(Reading database ... 55%", 
        "(Reading database ... 60%", 
        "(Reading database ... 65%", 
        "(Reading database ... 70%", 
        "(Reading database ... 75%", 
        "(Reading database ... 80%", 
        "(Reading database ... 85%", 
        "(Reading database ... 90%", 
        "(Reading database ... 95%", 
        "(Reading database ... 100%", 
        "(Reading database ... 21827 files and directories currently installed.)", 
        "Preparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...", 
        "Unpacking unzip (6.0-16+deb8u3) ...", 
        "Processing triggers for mime-support (3.58) ...", 
        "Processing triggers for man-db (2.7.0.2-5) ...", 
        "Setting up unzip (6.0-16+deb8u3) ...", 
        "\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m", 
        "Archive:  /tmp/v2ray/v2ray.zip", 
        "  inflating: /tmp/v2ray/config.json  ", 
        "   creating: /tmp/v2ray/doc/", 
        "  inflating: /tmp/v2ray/doc/readme.md  ", 
        "  inflating: /tmp/v2ray/geoip.dat    ", 
        "  inflating: /tmp/v2ray/geosite.dat  ", 
        "   creating: /tmp/v2ray/systemd/", 
        "  inflating: /tmp/v2ray/systemd/v2ray.service  ", 
        "   creating: /tmp/v2ray/systemv/", 
        "  inflating: /tmp/v2ray/systemv/v2ray  ", 
        "  inflating: /tmp/v2ray/v2ctl        ", 
        " extracting: /tmp/v2ray/v2ctl.sig    ", 
        "  inflating: /tmp/v2ray/v2ray        ", 
        " extracting: /tmp/v2ray/v2ray.sig    ", 
        "  inflating: /tmp/v2ray/vpoint_socks_vmess.json  ", 
        "  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  ", 
        "\u001b[36mShutting down V2Ray service.\u001b[0m", 
        "Failed to stop v2ray.service: Unit v2ray.service not loaded.", 
        "\u001b[33mFailed to shutdown V2Ray service.\u001b[0m", 
        "\u001b[36mPORT:40614\u001b[0m", 
        "\u001b[36mUUID:a159a264-55d9-4e9d-baef-47eb82aea157\u001b[0m", 
        "Created symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.", 
        "\u001b[36mRestarting V2Ray service.\u001b[0m", 
        "\u001b[32mV2Ray v4.18.2 is installed.\u001b[0m", 
        "v2ray服务端安装成功", 
        "cp /etc/v2ray/config.json /root/", 
        "config文件备份成功"
    ]
}
45.32.42.33 | CHANGED => {
    "changed": true, 
    "checksum": "642c4f754bbfa22a465305bf9f28f0be6b8d51d3", 
    "dest": "/etc/v2ray/config.json", 
    "gid": 0, 
    "group": "root", 
    "md5sum": "e1c9ae8913976ca140c692152b5ade95", 
    "mode": "0644", 
    "owner": "root", 
    "size": 1448, 
    "src": "/root/.ansible/tmp/ansible-tmp-1558297956.73-75275132461880/source", 
    "state": "file", 
    "uid": 0
}
2019-05-20 04:32:44 v2ray服务端安装完毕！
2019-05-20 04:32:44 获取v2ray服务器的IP\PORT\ID
45.32.42.33 | CHANGED | rc=0 >>
{
  "inbounds": [{
    "port": 40614,
    "protocol": "vmess",
    "settings": {
      "clients": [
        {
          "id": "a159a264-55d9-4e9d-baef-47eb82aea157",
          "level": 1,
          "alterId": 64
        }
      ]
    }
  }],
  "outbounds": [{
    "protocol": "freedom",
    "settings": {}
  },{
    "protocol": "blackhole",
    "settings": {},
    "tag": "blocked"
  }],
  "routing": {
    "rules": [
      {
        "type": "field",
        "ip": ["geoip:private"],
        "outboundTag": "blocked"
      }
    ]
  }
}
45.32.42.33 | CHANGED | rc=0 >>
{
  "log" : {
    "access": "/var/log/v2ray/access.log",
    "error": "/var/log/v2ray/error.log",
    "loglevel": "warning"
  },
  "inbound": {
    "port": 31139,
    "protocol": "vmess", 
    "settings": {
      "clients": [
        {
          "id": "805ed8a8-7967-49c0-9f5d-057e86920c49",
          "level": 1,
          "alterId": 64
        }
      ],
      "detour":{
        "to":"dynamicPort"
      }
    },
    "streamSettings":{
      "network":"kcp"
    }
  },
  "inboundDetour":[
    {
      "protocol": "vmess",
      "port": "10000-20000",
      "tag": "dynamicPort",       
      "settings": {
        "default": {
          "level": 1,
          "alterId": 32
        }
      },
      "allocate": {            
        "strategy": "random",  
        "concurrency": 2,      
        "refresh": 3           
      },
      "streamSettings": {
        "network": "kcp"
      }
    }
  ],
  "outbound": {
    "protocol": "freedom",
    "settings": {}
  },
  "outboundDetour": [
    {
      "protocol": "blackhole",
      "settings": {},
      "tag": "blocked"
    }
  ],
 "transport":{
      "tcpSettings":{
         "connectionReuse":true
      },
      "kcpSettings":{ 
         "mtu":1350,
         "tti":20,
         "uplinkCapacity":100,
         "downlinkCapacity":100,
         "congestion":false,
         "readBufferSize":5,
         "writeBufferSize":5,
         "header":{
            "type":"utp"
         }
      }
   }
}
2019-05-20 04:33:04 45.32.42.33     "port": 40614,           "id": "a159a264-55d9-4e9d-baef-47eb82aea157",
2019-05-20 04:33:04 正在修改-----------------
45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

2019-05-20 04:33:19 修改完毕，v2ray服务端配置成功!重启v2ray服务器
45.32.42.33 | CHANGED | rc=0 >>

2019-05-20 04:33:23 v2ray服务重启成功！
2019-05-20 04:33:23 -------------------
2019-05-20 04:34:23 更新局域网的网关服务
2019-05-20 04:34:23 正在验证gw 分组是否存在,请稍后...
2019-05-20 04:34:25 验证成功gw分组存在！分组名为gw
2019-05-20 04:35:25 正在验证gmasterw 分组是否存在,请稍后...
2019-05-20 04:35:32 验证成功gmasterw 分组存在！分组名为gmasterw
2019-05-20 04:35:36 v2ray_server的IP是45.32.42.33
2019-05-20 04:35:39     "port": 40614,
2019-05-20 04:35:43           "id": "a159a264-55d9-4e9d-baef-47eb82aea157",
2019-05-20 04:35:43 下一步需要修改gw 组的配置文件，现在正在形成参数
2019-05-20 04:35:43 修改gw的配置文件/etc/v2ray/config.json,/opt/v2ray-firewall
2019-05-20 04:35:43 1.拼接ip地址
2019-05-20 04:35:43 "address":"45.32.42.33",
2019-05-20 04:35:43 2.拼接端口号
2019-05-20 04:35:43 "port": 40614,
2019-05-20 04:35:43 3.拼接id
2019-05-20 04:35:43 "id": "a159a264-55d9-4e9d-baef-47eb82aea157",
2019-05-20 04:35:43 执行修改局域网GW的配置文件
2019-05-20 04:35:43 配置ip地址
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-20 04:35:46 配置端口
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-20 04:35:47 配置id
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-20 04:35:49 配置防火墙
2019-05-20 04:35:49 1.拼接防火墙
2019-05-20 04:35:49 iptables -t nat -A V2RAY -d 45.32.42.33 -j RETURN
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-20 04:35:50 重启gw的v2ray服务
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-20 04:35:52 服务重启成功！
2019-05-20 04:35:52 配置完毕！
                                                                              
2019-05-20 04:35:52 检测的网关名为ggww
2019-05-20 04:35:55 获取的v2ray服务器IP地址为45.76.219.250
2019-05-20 04:35:55 收集vultr的服务器列表
2019-05-20 04:35:56 ggww 调用API成功，开始执行监控程序
2019-05-20 04:35:56 获取的v2ray服务器subid为 24803570
2019-05-20 04:35:56 获取的v2ray服务器DCID为 25
2019-05-20 04:35:56 获取的v2ray服务器label为gslavew
2019-05-20 04:35:58 获取v2ray服务器宽带使用率为 2055059352 字节
2019-05-20 04:35:58 获取的宽带使用率为1 G
2019-05-20 04:35:58 流量小于10G，监控结束！
                                                                              
2019-05-20 04:35:58 检测的网关名为dns
2019-05-20 04:35:59 获取的v2ray服务器IP地址为108.160.133.156
2019-05-20 04:35:59 收集vultr的服务器列表
2019-05-20 04:36:01 dns 调用API成功，开始执行监控程序
2019-05-20 04:36:01 获取的v2ray服务器subid为 24750017
2019-05-20 04:36:01 获取的v2ray服务器DCID为 25
2019-05-20 04:36:01 获取的v2ray服务器label为ddnnss
2019-05-20 04:36:02 获取v2ray服务器宽带使用率为 9258362374 字节
2019-05-20 04:36:02 获取的宽带使用率为8 G
2019-05-20 04:36:02 流量小于10G，监控结束！
                                                                              
2019-05-20 04:36:02 检测的网关名为wifigw
2019-05-20 04:36:04 获取的v2ray服务器IP地址为202.182.100.205
2019-05-20 04:36:04 收集vultr的服务器列表
2019-05-20 04:36:05 wifigw 调用API成功，开始执行监控程序
2019-05-20 04:36:05 获取的v2ray服务器subid为 24750075
2019-05-20 04:36:05 获取的v2ray服务器DCID为 25
2019-05-20 04:36:05 获取的v2ray服务器label为wimasterfi
2019-05-20 04:36:08 获取v2ray服务器宽带使用率为 50519157 字节
2019-05-20 04:36:08 获取的宽带使用率为0 G
2019-05-20 04:36:08 流量小于10G，监控结束！
                                                                              
2019-05-20 04:36:08 检测的网关名为wifiggww
2019-05-20 04:36:10 获取的v2ray服务器IP地址为108.61.162.89
2019-05-20 04:36:10 收集vultr的服务器列表
2019-05-20 04:36:11 wifiggww 调用API成功，开始执行监控程序
2019-05-20 04:36:11 获取的v2ray服务器subid为 24759568
2019-05-20 04:36:11 获取的v2ray服务器DCID为 25
2019-05-20 04:36:11 获取的v2ray服务器label为wislavefi
2019-05-20 04:36:13 获取v2ray服务器宽带使用率为 30824545 字节
2019-05-20 04:36:13 获取的宽带使用率为0 G
2019-05-20 04:36:13 流量小于10G，监控结束！
                                                                              
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                                                              
                                                                              
2019-05-21 04:30:01 检测的网关名为gw
2019-05-21 04:30:03 获取的v2ray服务器IP地址为45.32.42.33
2019-05-21 04:30:03 收集vultr的服务器列表
2019-05-21 04:30:05 gw 调用API成功，开始执行监控程序
2019-05-21 04:30:05 获取的v2ray服务器subid为 24880128
2019-05-21 04:30:05 获取的v2ray服务器DCID为 25
2019-05-21 04:30:05 获取的v2ray服务器label为gmasterw
2019-05-21 04:30:06 获取v2ray服务器宽带使用率为 2011382661 字节
2019-05-21 04:30:06 获取的宽带使用率为1 G
2019-05-21 04:30:06 流量小于10G，监控结束！
                                                                              
2019-05-21 04:30:06 检测的网关名为ggww
2019-05-21 04:30:08 获取的v2ray服务器IP地址为45.76.219.250
2019-05-21 04:30:08 收集vultr的服务器列表
2019-05-21 04:30:09 ggww 调用API成功，开始执行监控程序
2019-05-21 04:30:09 获取的v2ray服务器subid为 24803570
2019-05-21 04:30:09 获取的v2ray服务器DCID为 25
2019-05-21 04:30:09 获取的v2ray服务器label为gslavew
2019-05-21 04:30:10 获取v2ray服务器宽带使用率为 42023181603 字节
2019-05-21 04:30:10 获取的宽带使用率为39 G
2019-05-21 04:30:10 触发重新搭建服务器条件,同时将keepalived服务停用
2019-05-21 04:30:10 正在停用keepalived服务
10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

2019-05-21 04:30:12 ggww 的keepalived服务停用成功
2019-05-21 04:30:12 正在销毁v2ray服务器
2019-05-21 04:30:14 等待删除gslavew
2019-05-21 04:30:44 删除gslavew 成功
2019-05-21 04:30:44 获取ggww 使用的v2ray服务器的label	gslavew
2019-05-21 04:30:44 重新安装v2ray服务器
2019-05-21 04:30:46 installing server......
2019-05-21 04:30:46 正在安装的v2ray服务器的subid为24888608
2019-05-21 04:31:07 新建的v2ray服务器IP地址为45.76.219.250
2019-05-21 04:31:08 getting pwd......
2019-05-21 04:31:30 获取的v2ray服务器的密码为d,V8h!KWGv_pQMgm
2019-05-21 04:31:30 sleep 60
2019-05-21 04:32:33 连接超时，重新安装服务器
Unable to reinstall server: Server is currently locked2019-05-21 04:34:05 检查v2ray服务器ip地址存在！
2019-05-21 04:34:05 ------------------------
2019-05-21 04:34:05 清理本地已经存在45.76.219.250 的密钥
# Host 45.76.219.250 found: line 15
/root/.ssh/known_hosts updated.
Original contents retained as /root/.ssh/known_hosts.old
2019-05-21 04:34:05 重新添加45.76.219.250 的密钥，正在添加密钥！
2019-05-21 04:34:06 v2ray_server安装ssh密钥
2019-05-21 04:34:10 ------------
2019-05-21 04:34:10 正在配置ansible主控端
2019-05-21 04:34:10 gslavew 已存在
2019-05-21 04:34:10 主控端配置完毕！
2019-05-21 04:34:10 ------------
2019-05-21 04:34:10 测试ansible被控端
45.76.219.250 | SUCCESS => {
    "changed": false, 
    "ping": "pong"
}
2019-05-21 04:34:19 主控端配置成功！
2019-05-21 04:34:19 -------------------
2019-05-21 04:34:19 开始安装v2ray服务端,并且进行配置，使用ansible的script模块拷贝配置文件
45.76.219.250 | CHANGED => {
    "changed": true, 
    "rc": 0, 
    "stderr": "Shared connection to 45.76.219.250 closed.\r\n", 
    "stderr_lines": [
        "Shared connection to 45.76.219.250 closed."
    ], 
    "stdout": "安装v2ray服务端\r\nbash <(curl -L -s https://install.direct/go.sh)\r\n\u001b[36mInstalling V2Ray v4.18.2 on x86_64\u001b[0m\r\n\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.2/v2ray-linux-64.zip\u001b[0m\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r100   608    0   608    0     0   1173      0 --:--:-- --:--:-- --:--:--  1173\r\n\r  0 11.2M    0     0    0     0      0      0 --:--:--  0:00:01 --:--:--     0\r  5 11.2M    5  627k    0     0   304k      0  0:00:37  0:00:02  0:00:35  740k\r 68 11.2M   68 7918k    0     0  2595k      0  0:00:04  0:00:03  0:00:01 4308k\r100 11.2M  100 11.2M    0     0  3377k      0  0:00:03  0:00:03 --:--:-- 5240k\r\n\u001b[36mUpdating software repo\u001b[0m\r\n\u001b[36mInstalling unzip\u001b[0m\r\ndebconf: unable to initialize frontend: Dialog\r\ndebconf: (TERM is not set, so the dialog frontend is not usable.)\r\ndebconf: falling back to frontend: Readline\r\ndebconf: unable to initialize frontend: Readline\r\ndebconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)\r\ndebconf: falling back to frontend: Teletype\r\nSelecting previously unselected package unzip.\r\n(Reading database ... \r(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r(Reading database ... 70%\r(Reading database ... 75%\r(Reading database ... 80%\r(Reading database ... 85%\r(Reading database ... 90%\r(Reading database ... 95%\r(Reading database ... 100%\r(Reading database ... 21827 files and directories currently installed.)\r\nPreparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...\r\nUnpacking unzip (6.0-16+deb8u3) ...\r\nProcessing triggers for mime-support (3.58) ...\r\nProcessing triggers for man-db (2.7.0.2-5) ...\r\nSetting up unzip (6.0-16+deb8u3) ...\r\n\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m\r\nArchive:  /tmp/v2ray/v2ray.zip\r\n  inflating: /tmp/v2ray/config.json  \r\n   creating: /tmp/v2ray/doc/\r\n  inflating: /tmp/v2ray/doc/readme.md  \r\n  inflating: /tmp/v2ray/geoip.dat    \r\n  inflating: /tmp/v2ray/geosite.dat  \r\n   creating: /tmp/v2ray/systemd/\r\n  inflating: /tmp/v2ray/systemd/v2ray.service  \r\n   creating: /tmp/v2ray/systemv/\r\n  inflating: /tmp/v2ray/systemv/v2ray  \r\n  inflating: /tmp/v2ray/v2ctl        \r\n extracting: /tmp/v2ray/v2ctl.sig    \r\n  inflating: /tmp/v2ray/v2ray        \r\n extracting: /tmp/v2ray/v2ray.sig    \r\n  inflating: /tmp/v2ray/vpoint_socks_vmess.json  \r\n  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  \r\n\u001b[36mShutting down V2Ray service.\u001b[0m\r\nFailed to stop v2ray.service: Unit v2ray.service not loaded.\r\n\u001b[33mFailed to shutdown V2Ray service.\u001b[0m\r\n\u001b[36mPORT:42355\u001b[0m\r\n\u001b[36mUUID:2031a3d2-9147-43fb-8dcd-c089bcb686a4\u001b[0m\r\nCreated symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.\r\n\u001b[36mRestarting V2Ray service.\u001b[0m\r\n\u001b[32mV2Ray v4.18.2 is installed.\u001b[0m\r\nv2ray服务端安装成功\r\ncp /etc/v2ray/config.json /root/\r\nconfig文件备份成功\r\n", 
    "stdout_lines": [
        "安装v2ray服务端", 
        "bash <(curl -L -s https://install.direct/go.sh)", 
        "\u001b[36mInstalling V2Ray v4.18.2 on x86_64\u001b[0m", 
        "\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.2/v2ray-linux-64.zip\u001b[0m", 
        "  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current", 
        "                                 Dload  Upload   Total   Spent    Left  Speed", 
        "", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "100   608    0   608    0     0   1173      0 --:--:-- --:--:-- --:--:--  1173", 
        "", 
        "  0 11.2M    0     0    0     0      0      0 --:--:--  0:00:01 --:--:--     0", 
        "  5 11.2M    5  627k    0     0   304k      0  0:00:37  0:00:02  0:00:35  740k", 
        " 68 11.2M   68 7918k    0     0  2595k      0  0:00:04  0:00:03  0:00:01 4308k", 
        "100 11.2M  100 11.2M    0     0  3377k      0  0:00:03  0:00:03 --:--:-- 5240k", 
        "\u001b[36mUpdating software repo\u001b[0m", 
        "\u001b[36mInstalling unzip\u001b[0m", 
        "debconf: unable to initialize frontend: Dialog", 
        "debconf: (TERM is not set, so the dialog frontend is not usable.)", 
        "debconf: falling back to frontend: Readline", 
        "debconf: unable to initialize frontend: Readline", 
        "debconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)", 
        "debconf: falling back to frontend: Teletype", 
        "Selecting previously unselected package unzip.", 
        "(Reading database ... ", 
        "(Reading database ... 5%", 
        "(Reading database ... 10%", 
        "(Reading database ... 15%", 
        "(Reading database ... 20%", 
        "(Reading database ... 25%", 
        "(Reading database ... 30%", 
        "(Reading database ... 35%", 
        "(Reading database ... 40%", 
        "(Reading database ... 45%", 
        "(Reading database ... 50%", 
        "(Reading database ... 55%", 
        "(Reading database ... 60%", 
        "(Reading database ... 65%", 
        "(Reading database ... 70%", 
        "(Reading database ... 75%", 
        "(Reading database ... 80%", 
        "(Reading database ... 85%", 
        "(Reading database ... 90%", 
        "(Reading database ... 95%", 
        "(Reading database ... 100%", 
        "(Reading database ... 21827 files and directories currently installed.)", 
        "Preparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...", 
        "Unpacking unzip (6.0-16+deb8u3) ...", 
        "Processing triggers for mime-support (3.58) ...", 
        "Processing triggers for man-db (2.7.0.2-5) ...", 
        "Setting up unzip (6.0-16+deb8u3) ...", 
        "\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m", 
        "Archive:  /tmp/v2ray/v2ray.zip", 
        "  inflating: /tmp/v2ray/config.json  ", 
        "   creating: /tmp/v2ray/doc/", 
        "  inflating: /tmp/v2ray/doc/readme.md  ", 
        "  inflating: /tmp/v2ray/geoip.dat    ", 
        "  inflating: /tmp/v2ray/geosite.dat  ", 
        "   creating: /tmp/v2ray/systemd/", 
        "  inflating: /tmp/v2ray/systemd/v2ray.service  ", 
        "   creating: /tmp/v2ray/systemv/", 
        "  inflating: /tmp/v2ray/systemv/v2ray  ", 
        "  inflating: /tmp/v2ray/v2ctl        ", 
        " extracting: /tmp/v2ray/v2ctl.sig    ", 
        "  inflating: /tmp/v2ray/v2ray        ", 
        " extracting: /tmp/v2ray/v2ray.sig    ", 
        "  inflating: /tmp/v2ray/vpoint_socks_vmess.json  ", 
        "  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  ", 
        "\u001b[36mShutting down V2Ray service.\u001b[0m", 
        "Failed to stop v2ray.service: Unit v2ray.service not loaded.", 
        "\u001b[33mFailed to shutdown V2Ray service.\u001b[0m", 
        "\u001b[36mPORT:42355\u001b[0m", 
        "\u001b[36mUUID:2031a3d2-9147-43fb-8dcd-c089bcb686a4\u001b[0m", 
        "Created symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.", 
        "\u001b[36mRestarting V2Ray service.\u001b[0m", 
        "\u001b[32mV2Ray v4.18.2 is installed.\u001b[0m", 
        "v2ray服务端安装成功", 
        "cp /etc/v2ray/config.json /root/", 
        "config文件备份成功"
    ]
}
45.76.219.250 | CHANGED => {
    "changed": true, 
    "checksum": "642c4f754bbfa22a465305bf9f28f0be6b8d51d3", 
    "dest": "/etc/v2ray/config.json", 
    "gid": 0, 
    "group": "root", 
    "md5sum": "e1c9ae8913976ca140c692152b5ade95", 
    "mode": "0644", 
    "owner": "root", 
    "size": 1448, 
    "src": "/root/.ansible/tmp/ansible-tmp-1558384477.32-261039720645186/source", 
    "state": "file", 
    "uid": 0
}
2019-05-21 04:34:44 v2ray服务端安装完毕！
2019-05-21 04:34:44 获取v2ray服务器的IP\PORT\ID
45.76.219.250 | CHANGED | rc=0 >>
{
  "inbounds": [{
    "port": 42355,
    "protocol": "vmess",
    "settings": {
      "clients": [
        {
          "id": "2031a3d2-9147-43fb-8dcd-c089bcb686a4",
          "level": 1,
          "alterId": 64
        }
      ]
    }
  }],
  "outbounds": [{
    "protocol": "freedom",
    "settings": {}
  },{
    "protocol": "blackhole",
    "settings": {},
    "tag": "blocked"
  }],
  "routing": {
    "rules": [
      {
        "type": "field",
        "ip": ["geoip:private"],
        "outboundTag": "blocked"
      }
    ]
  }
}
45.76.219.250 | CHANGED | rc=0 >>
{
  "log" : {
    "access": "/var/log/v2ray/access.log",
    "error": "/var/log/v2ray/error.log",
    "loglevel": "warning"
  },
  "inbound": {
    "port": 31139,
    "protocol": "vmess", 
    "settings": {
      "clients": [
        {
          "id": "805ed8a8-7967-49c0-9f5d-057e86920c49",
          "level": 1,
          "alterId": 64
        }
      ],
      "detour":{
        "to":"dynamicPort"
      }
    },
    "streamSettings":{
      "network":"kcp"
    }
  },
  "inboundDetour":[
    {
      "protocol": "vmess",
      "port": "10000-20000",
      "tag": "dynamicPort",       
      "settings": {
        "default": {
          "level": 1,
          "alterId": 32
        }
      },
      "allocate": {            
        "strategy": "random",  
        "concurrency": 2,      
        "refresh": 3           
      },
      "streamSettings": {
        "network": "kcp"
      }
    }
  ],
  "outbound": {
    "protocol": "freedom",
    "settings": {}
  },
  "outboundDetour": [
    {
      "protocol": "blackhole",
      "settings": {},
      "tag": "blocked"
    }
  ],
 "transport":{
      "tcpSettings":{
         "connectionReuse":true
      },
      "kcpSettings":{ 
         "mtu":1350,
         "tti":20,
         "uplinkCapacity":100,
         "downlinkCapacity":100,
         "congestion":false,
         "readBufferSize":5,
         "writeBufferSize":5,
         "header":{
            "type":"utp"
         }
      }
   }
}
2019-05-21 04:35:00 45.76.219.250     "port": 42355,           "id": "2031a3d2-9147-43fb-8dcd-c089bcb686a4",
2019-05-21 04:35:00 正在修改-----------------
45.76.219.250 | CHANGED | rc=0 >>

45.76.219.250 | CHANGED | rc=0 >>

45.76.219.250 | CHANGED | rc=0 >>

45.76.219.250 | CHANGED | rc=0 >>

2019-05-21 04:35:14 修改完毕，v2ray服务端配置成功!重启v2ray服务器
45.76.219.250 | CHANGED | rc=0 >>

2019-05-21 04:35:17 v2ray服务重启成功！
2019-05-21 04:35:17 -------------------
2019-05-21 04:36:17 更新局域网的网关服务
2019-05-21 04:36:17 正在验证ggww 分组是否存在,请稍后...
2019-05-21 04:36:19 验证成功gw分组存在！分组名为ggww
2019-05-21 04:37:19 正在验证gslavew 分组是否存在,请稍后...
2019-05-21 04:37:25 验证成功gslavew 分组存在！分组名为gslavew
2019-05-21 04:37:28 v2ray_server的IP是45.76.219.250
2019-05-21 04:37:32     "port": 42355,
2019-05-21 04:37:35           "id": "2031a3d2-9147-43fb-8dcd-c089bcb686a4",
2019-05-21 04:37:35 下一步需要修改ggww 组的配置文件，现在正在形成参数
2019-05-21 04:37:35 修改gw的配置文件/etc/v2ray/config.json,/opt/v2ray-firewall
2019-05-21 04:37:35 1.拼接ip地址
2019-05-21 04:37:35 "address":"45.76.219.250",
2019-05-21 04:37:35 2.拼接端口号
2019-05-21 04:37:35 "port": 42355,
2019-05-21 04:37:35 3.拼接id
2019-05-21 04:37:35 "id": "2031a3d2-9147-43fb-8dcd-c089bcb686a4",
2019-05-21 04:37:35 执行修改局域网GW的配置文件
2019-05-21 04:37:35 配置ip地址
10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

2019-05-21 04:37:37 配置端口
192.168.1.252 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

2019-05-21 04:37:39 配置id
192.168.1.252 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

2019-05-21 04:37:40 配置防火墙
2019-05-21 04:37:40 1.拼接防火墙
2019-05-21 04:37:40 iptables -t nat -A V2RAY -d 45.76.219.250 -j RETURN
192.168.1.252 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

2019-05-21 04:37:41 重启gw的v2ray服务
192.168.1.252 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

2019-05-21 04:37:50 服务重启成功！
2019-05-21 04:37:50 配置完毕！
                                                                              
2019-05-21 04:37:50 检测的网关名为dns
2019-05-21 04:37:51 获取的v2ray服务器IP地址为108.160.133.156
2019-05-21 04:37:51 收集vultr的服务器列表
2019-05-21 04:37:53 dns 调用API成功，开始执行监控程序
2019-05-21 04:37:53 获取的v2ray服务器subid为 24750017
2019-05-21 04:37:53 获取的v2ray服务器DCID为 25
2019-05-21 04:37:53 获取的v2ray服务器label为ddnnss
2019-05-21 04:37:54 获取v2ray服务器宽带使用率为 9317256170 字节
2019-05-21 04:37:54 获取的宽带使用率为8 G
2019-05-21 04:37:54 流量小于10G，监控结束！
                                                                              
2019-05-21 04:37:54 检测的网关名为wifigw
2019-05-21 04:37:56 获取的v2ray服务器IP地址为202.182.100.205
2019-05-21 04:37:56 收集vultr的服务器列表
2019-05-21 04:37:57 wifigw 调用API成功，开始执行监控程序
2019-05-21 04:37:57 获取的v2ray服务器subid为 24750075
2019-05-21 04:37:57 获取的v2ray服务器DCID为 25
2019-05-21 04:37:57 获取的v2ray服务器label为wimasterfi
2019-05-21 04:37:58 获取v2ray服务器宽带使用率为 63295973 字节
2019-05-21 04:37:58 获取的宽带使用率为0 G
2019-05-21 04:37:58 流量小于10G，监控结束！
                                                                              
2019-05-21 04:37:58 检测的网关名为wifiggww
2019-05-21 04:38:00 获取的v2ray服务器IP地址为108.61.162.89
2019-05-21 04:38:00 收集vultr的服务器列表
2019-05-21 04:38:01 wifiggww 调用API成功，开始执行监控程序
2019-05-21 04:38:01 获取的v2ray服务器subid为 24759568
2019-05-21 04:38:01 获取的v2ray服务器DCID为 25
2019-05-21 04:38:01 获取的v2ray服务器label为wislavefi
2019-05-21 04:38:02 获取v2ray服务器宽带使用率为 36429807 字节
2019-05-21 04:38:02 获取的宽带使用率为0 G
2019-05-21 04:38:02 流量小于10G，监控结束！
                                                                              
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                                                              
                                                                              
2019-05-22 04:30:01 检测的网关名为gw
2019-05-22 04:30:03 获取的v2ray服务器IP地址为45.32.42.33
2019-05-22 04:30:03 收集vultr的服务器列表
2019-05-22 04:30:05 gw 调用API成功，开始执行监控程序
2019-05-22 04:30:05 获取的v2ray服务器subid为 24894312
2019-05-22 04:30:05 获取的v2ray服务器DCID为 25
2019-05-22 04:30:05 获取的v2ray服务器label为gmasterw
2019-05-22 04:30:06 获取v2ray服务器宽带使用率为 48201362374 字节
2019-05-22 04:30:06 获取的宽带使用率为44 G
2019-05-22 04:30:06 触发重新搭建服务器条件,同时将keepalived服务停用
2019-05-22 04:30:06 正在停用keepalived服务
10.24.1.254 | CHANGED | rc=0 >>

2019-05-22 04:30:08 gw 的keepalived服务停用成功
2019-05-22 04:30:08 正在销毁v2ray服务器
2019-05-22 04:30:10 等待删除gmasterw
2019-05-22 04:30:40 删除gmasterw 成功
2019-05-22 04:30:40 获取gw 使用的v2ray服务器的label	gmasterw
2019-05-22 04:30:40 重新安装v2ray服务器
2019-05-22 04:30:42 installing server......
2019-05-22 04:30:42 正在安装的v2ray服务器的subid为24912513
2019-05-22 04:31:04 新建的v2ray服务器IP地址为45.32.42.33
2019-05-22 04:31:05 getting pwd......
2019-05-22 04:31:27 获取的v2ray服务器的密码为9vE)[zSvpr@@)Pbk
2019-05-22 04:31:27 sleep 60
2019-05-22 04:32:30 连接超时，重新安装服务器
Unable to reinstall server: Server is currently locked2019-05-22 04:34:03 检查v2ray服务器ip地址存在！
2019-05-22 04:34:03 ------------------------
2019-05-22 04:34:03 清理本地已经存在45.32.42.33 的密钥
# Host 45.32.42.33 found: line 18
/root/.ssh/known_hosts updated.
Original contents retained as /root/.ssh/known_hosts.old
2019-05-22 04:34:03 重新添加45.32.42.33 的密钥，正在添加密钥！
2019-05-22 04:34:04 v2ray_server安装ssh密钥
2019-05-22 04:34:08 ------------
2019-05-22 04:34:08 正在配置ansible主控端
2019-05-22 04:34:08 gmasterw 已存在
2019-05-22 04:34:08 主控端配置完毕！
2019-05-22 04:34:08 ------------
2019-05-22 04:34:08 测试ansible被控端
45.32.42.33 | SUCCESS => {
    "changed": false, 
    "ping": "pong"
}
2019-05-22 04:34:17 主控端配置成功！
2019-05-22 04:34:17 -------------------
2019-05-22 04:34:17 开始安装v2ray服务端,并且进行配置，使用ansible的script模块拷贝配置文件
45.32.42.33 | CHANGED => {
    "changed": true, 
    "rc": 0, 
    "stderr": "Shared connection to 45.32.42.33 closed.\r\n", 
    "stderr_lines": [
        "Shared connection to 45.32.42.33 closed."
    ], 
    "stdout": "安装v2ray服务端\r\nbash <(curl -L -s https://install.direct/go.sh)\r\n\u001b[36mInstalling V2Ray v4.18.2 on x86_64\u001b[0m\r\n\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.2/v2ray-linux-64.zip\u001b[0m\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r100   608    0   608    0     0   1133      0 --:--:-- --:--:-- --:--:--  1132\r\n\r  0 11.2M    0     0    0     0      0      0 --:--:--  0:00:01 --:--:--     0\r  5 11.2M    5  610k    0     0   283k      0  0:00:40  0:00:02  0:00:38  702k\r100 11.2M  100 11.2M    0     0  3811k      0  0:00:03  0:00:03 --:--:-- 6629k\r\n\u001b[36mUpdating software repo\u001b[0m\r\n\u001b[36mInstalling unzip\u001b[0m\r\ndebconf: unable to initialize frontend: Dialog\r\ndebconf: (TERM is not set, so the dialog frontend is not usable.)\r\ndebconf: falling back to frontend: Readline\r\ndebconf: unable to initialize frontend: Readline\r\ndebconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)\r\ndebconf: falling back to frontend: Teletype\r\nSelecting previously unselected package unzip.\r\n(Reading database ... \r(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r(Reading database ... 70%\r(Reading database ... 75%\r(Reading database ... 80%\r(Reading database ... 85%\r(Reading database ... 90%\r(Reading database ... 95%\r(Reading database ... 100%\r(Reading database ... 21827 files and directories currently installed.)\r\nPreparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...\r\nUnpacking unzip (6.0-16+deb8u3) ...\r\nProcessing triggers for mime-support (3.58) ...\r\nProcessing triggers for man-db (2.7.0.2-5) ...\r\nSetting up unzip (6.0-16+deb8u3) ...\r\n\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m\r\nArchive:  /tmp/v2ray/v2ray.zip\r\n  inflating: /tmp/v2ray/config.json  \r\n   creating: /tmp/v2ray/doc/\r\n  inflating: /tmp/v2ray/doc/readme.md  \r\n  inflating: /tmp/v2ray/geoip.dat    \r\n  inflating: /tmp/v2ray/geosite.dat  \r\n   creating: /tmp/v2ray/systemd/\r\n  inflating: /tmp/v2ray/systemd/v2ray.service  \r\n   creating: /tmp/v2ray/systemv/\r\n  inflating: /tmp/v2ray/systemv/v2ray  \r\n  inflating: /tmp/v2ray/v2ctl        \r\n extracting: /tmp/v2ray/v2ctl.sig    \r\n  inflating: /tmp/v2ray/v2ray        \r\n extracting: /tmp/v2ray/v2ray.sig    \r\n  inflating: /tmp/v2ray/vpoint_socks_vmess.json  \r\n  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  \r\n\u001b[36mShutting down V2Ray service.\u001b[0m\r\nFailed to stop v2ray.service: Unit v2ray.service not loaded.\r\n\u001b[33mFailed to shutdown V2Ray service.\u001b[0m\r\n\u001b[36mPORT:42381\u001b[0m\r\n\u001b[36mUUID:c5c06836-1b7d-49e1-82e2-561ce73c3866\u001b[0m\r\nCreated symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.\r\n\u001b[36mRestarting V2Ray service.\u001b[0m\r\n\u001b[32mV2Ray v4.18.2 is installed.\u001b[0m\r\nv2ray服务端安装成功\r\ncp /etc/v2ray/config.json /root/\r\nconfig文件备份成功\r\n", 
    "stdout_lines": [
        "安装v2ray服务端", 
        "bash <(curl -L -s https://install.direct/go.sh)", 
        "\u001b[36mInstalling V2Ray v4.18.2 on x86_64\u001b[0m", 
        "\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.2/v2ray-linux-64.zip\u001b[0m", 
        "  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current", 
        "                                 Dload  Upload   Total   Spent    Left  Speed", 
        "", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "100   608    0   608    0     0   1133      0 --:--:-- --:--:-- --:--:--  1132", 
        "", 
        "  0 11.2M    0     0    0     0      0      0 --:--:--  0:00:01 --:--:--     0", 
        "  5 11.2M    5  610k    0     0   283k      0  0:00:40  0:00:02  0:00:38  702k", 
        "100 11.2M  100 11.2M    0     0  3811k      0  0:00:03  0:00:03 --:--:-- 6629k", 
        "\u001b[36mUpdating software repo\u001b[0m", 
        "\u001b[36mInstalling unzip\u001b[0m", 
        "debconf: unable to initialize frontend: Dialog", 
        "debconf: (TERM is not set, so the dialog frontend is not usable.)", 
        "debconf: falling back to frontend: Readline", 
        "debconf: unable to initialize frontend: Readline", 
        "debconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)", 
        "debconf: falling back to frontend: Teletype", 
        "Selecting previously unselected package unzip.", 
        "(Reading database ... ", 
        "(Reading database ... 5%", 
        "(Reading database ... 10%", 
        "(Reading database ... 15%", 
        "(Reading database ... 20%", 
        "(Reading database ... 25%", 
        "(Reading database ... 30%", 
        "(Reading database ... 35%", 
        "(Reading database ... 40%", 
        "(Reading database ... 45%", 
        "(Reading database ... 50%", 
        "(Reading database ... 55%", 
        "(Reading database ... 60%", 
        "(Reading database ... 65%", 
        "(Reading database ... 70%", 
        "(Reading database ... 75%", 
        "(Reading database ... 80%", 
        "(Reading database ... 85%", 
        "(Reading database ... 90%", 
        "(Reading database ... 95%", 
        "(Reading database ... 100%", 
        "(Reading database ... 21827 files and directories currently installed.)", 
        "Preparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...", 
        "Unpacking unzip (6.0-16+deb8u3) ...", 
        "Processing triggers for mime-support (3.58) ...", 
        "Processing triggers for man-db (2.7.0.2-5) ...", 
        "Setting up unzip (6.0-16+deb8u3) ...", 
        "\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m", 
        "Archive:  /tmp/v2ray/v2ray.zip", 
        "  inflating: /tmp/v2ray/config.json  ", 
        "   creating: /tmp/v2ray/doc/", 
        "  inflating: /tmp/v2ray/doc/readme.md  ", 
        "  inflating: /tmp/v2ray/geoip.dat    ", 
        "  inflating: /tmp/v2ray/geosite.dat  ", 
        "   creating: /tmp/v2ray/systemd/", 
        "  inflating: /tmp/v2ray/systemd/v2ray.service  ", 
        "   creating: /tmp/v2ray/systemv/", 
        "  inflating: /tmp/v2ray/systemv/v2ray  ", 
        "  inflating: /tmp/v2ray/v2ctl        ", 
        " extracting: /tmp/v2ray/v2ctl.sig    ", 
        "  inflating: /tmp/v2ray/v2ray        ", 
        " extracting: /tmp/v2ray/v2ray.sig    ", 
        "  inflating: /tmp/v2ray/vpoint_socks_vmess.json  ", 
        "  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  ", 
        "\u001b[36mShutting down V2Ray service.\u001b[0m", 
        "Failed to stop v2ray.service: Unit v2ray.service not loaded.", 
        "\u001b[33mFailed to shutdown V2Ray service.\u001b[0m", 
        "\u001b[36mPORT:42381\u001b[0m", 
        "\u001b[36mUUID:c5c06836-1b7d-49e1-82e2-561ce73c3866\u001b[0m", 
        "Created symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.", 
        "\u001b[36mRestarting V2Ray service.\u001b[0m", 
        "\u001b[32mV2Ray v4.18.2 is installed.\u001b[0m", 
        "v2ray服务端安装成功", 
        "cp /etc/v2ray/config.json /root/", 
        "config文件备份成功"
    ]
}
45.32.42.33 | CHANGED => {
    "changed": true, 
    "checksum": "642c4f754bbfa22a465305bf9f28f0be6b8d51d3", 
    "dest": "/etc/v2ray/config.json", 
    "gid": 0, 
    "group": "root", 
    "md5sum": "e1c9ae8913976ca140c692152b5ade95", 
    "mode": "0644", 
    "owner": "root", 
    "size": 1448, 
    "src": "/root/.ansible/tmp/ansible-tmp-1558470872.51-223211148773141/source", 
    "state": "file", 
    "uid": 0
}
2019-05-22 04:34:39 v2ray服务端安装完毕！
2019-05-22 04:34:39 获取v2ray服务器的IP\PORT\ID
45.32.42.33 | CHANGED | rc=0 >>
{
  "inbounds": [{
    "port": 42381,
    "protocol": "vmess",
    "settings": {
      "clients": [
        {
          "id": "c5c06836-1b7d-49e1-82e2-561ce73c3866",
          "level": 1,
          "alterId": 64
        }
      ]
    }
  }],
  "outbounds": [{
    "protocol": "freedom",
    "settings": {}
  },{
    "protocol": "blackhole",
    "settings": {},
    "tag": "blocked"
  }],
  "routing": {
    "rules": [
      {
        "type": "field",
        "ip": ["geoip:private"],
        "outboundTag": "blocked"
      }
    ]
  }
}
45.32.42.33 | CHANGED | rc=0 >>
{
  "log" : {
    "access": "/var/log/v2ray/access.log",
    "error": "/var/log/v2ray/error.log",
    "loglevel": "warning"
  },
  "inbound": {
    "port": 31139,
    "protocol": "vmess", 
    "settings": {
      "clients": [
        {
          "id": "805ed8a8-7967-49c0-9f5d-057e86920c49",
          "level": 1,
          "alterId": 64
        }
      ],
      "detour":{
        "to":"dynamicPort"
      }
    },
    "streamSettings":{
      "network":"kcp"
    }
  },
  "inboundDetour":[
    {
      "protocol": "vmess",
      "port": "10000-20000",
      "tag": "dynamicPort",       
      "settings": {
        "default": {
          "level": 1,
          "alterId": 32
        }
      },
      "allocate": {            
        "strategy": "random",  
        "concurrency": 2,      
        "refresh": 3           
      },
      "streamSettings": {
        "network": "kcp"
      }
    }
  ],
  "outbound": {
    "protocol": "freedom",
    "settings": {}
  },
  "outboundDetour": [
    {
      "protocol": "blackhole",
      "settings": {},
      "tag": "blocked"
    }
  ],
 "transport":{
      "tcpSettings":{
         "connectionReuse":true
      },
      "kcpSettings":{ 
         "mtu":1350,
         "tti":20,
         "uplinkCapacity":100,
         "downlinkCapacity":100,
         "congestion":false,
         "readBufferSize":5,
         "writeBufferSize":5,
         "header":{
            "type":"utp"
         }
      }
   }
}
2019-05-22 04:34:56 45.32.42.33     "port": 42381,           "id": "c5c06836-1b7d-49e1-82e2-561ce73c3866",
2019-05-22 04:34:56 正在修改-----------------
45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

2019-05-22 04:35:10 修改完毕，v2ray服务端配置成功!重启v2ray服务器
45.32.42.33 | CHANGED | rc=0 >>

2019-05-22 04:35:13 v2ray服务重启成功！
2019-05-22 04:35:13 -------------------
2019-05-22 04:36:13 更新局域网的网关服务
2019-05-22 04:36:13 正在验证gw 分组是否存在,请稍后...
2019-05-22 04:36:15 验证成功gw分组存在！分组名为gw
2019-05-22 04:37:15 正在验证gmasterw 分组是否存在,请稍后...
2019-05-22 04:37:21 验证成功gmasterw 分组存在！分组名为gmasterw
2019-05-22 04:37:24 v2ray_server的IP是45.32.42.33
2019-05-22 04:37:28     "port": 42381,
2019-05-22 04:37:31           "id": "c5c06836-1b7d-49e1-82e2-561ce73c3866",
2019-05-22 04:37:31 下一步需要修改gw 组的配置文件，现在正在形成参数
2019-05-22 04:37:31 修改gw的配置文件/etc/v2ray/config.json,/opt/v2ray-firewall
2019-05-22 04:37:31 1.拼接ip地址
2019-05-22 04:37:31 "address":"45.32.42.33",
2019-05-22 04:37:31 2.拼接端口号
2019-05-22 04:37:31 "port": 42381,
2019-05-22 04:37:31 3.拼接id
2019-05-22 04:37:31 "id": "c5c06836-1b7d-49e1-82e2-561ce73c3866",
2019-05-22 04:37:31 执行修改局域网GW的配置文件
2019-05-22 04:37:31 配置ip地址
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-22 04:37:34 配置端口
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-22 04:37:35 配置id
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-22 04:37:36 配置防火墙
2019-05-22 04:37:36 1.拼接防火墙
2019-05-22 04:37:36 iptables -t nat -A V2RAY -d 45.32.42.33 -j RETURN
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-22 04:37:38 重启gw的v2ray服务
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-22 04:37:42 服务重启成功！
2019-05-22 04:37:42 配置完毕！
                                                                              
2019-05-22 04:37:42 检测的网关名为ggww
2019-05-22 04:37:44 获取的v2ray服务器IP地址为45.76.219.250
2019-05-22 04:37:44 收集vultr的服务器列表
2019-05-22 04:37:46 ggww 调用API成功，开始执行监控程序
2019-05-22 04:37:46 获取的v2ray服务器subid为 24888608
2019-05-22 04:37:46 获取的v2ray服务器DCID为 25
2019-05-22 04:37:46 获取的v2ray服务器label为gslavew
2019-05-22 04:37:47 获取v2ray服务器宽带使用率为 36235174295 字节
2019-05-22 04:37:47 获取的宽带使用率为33 G
2019-05-22 04:37:47 触发重新搭建服务器条件,同时将keepalived服务停用
2019-05-22 04:37:47 正在停用keepalived服务
192.168.1.252 | FAILED | rc=1 >>
Job for keepalived.service canceled.non-zero return code
10.24.1.253 | CHANGED | rc=0 >>

2019-05-22 04:37:49 ggww 的keepalived服务停用成功
2019-05-22 04:37:49 正在销毁v2ray服务器
2019-05-22 04:37:51 等待删除gslavew
2019-05-22 04:38:21 删除gslavew 成功
2019-05-22 04:38:21 获取ggww 使用的v2ray服务器的label	gslavew
2019-05-22 04:38:21 重新安装v2ray服务器
2019-05-22 04:38:23 installing server......
2019-05-22 04:38:23 正在安装的v2ray服务器的subid为24912584
2019-05-22 04:38:45 新建的v2ray服务器IP地址为45.76.219.250
2019-05-22 04:38:46 getting pwd......
2019-05-22 04:39:07 获取的v2ray服务器的密码为1V@nr2_JQ9.4?zE#
2019-05-22 04:39:07 sleep 60
2019-05-22 04:40:10 连接超时，重新安装服务器
Unable to reinstall server: Server is currently locked2019-05-22 04:41:43 检查v2ray服务器ip地址存在！
2019-05-22 04:41:43 ------------------------
2019-05-22 04:41:43 清理本地已经存在45.76.219.250 的密钥
# Host 45.76.219.250 found: line 17
/root/.ssh/known_hosts updated.
Original contents retained as /root/.ssh/known_hosts.old
2019-05-22 04:41:43 重新添加45.76.219.250 的密钥，正在添加密钥！
2019-05-22 04:41:44 v2ray_server安装ssh密钥
2019-05-22 04:41:45 ------------
2019-05-22 04:41:45 正在配置ansible主控端
2019-05-22 04:41:45 gslavew 已存在
2019-05-22 04:41:45 主控端配置完毕！
2019-05-22 04:41:45 ------------
2019-05-22 04:41:45 测试ansible被控端
45.76.219.250 | SUCCESS => {
    "changed": false, 
    "ping": "pong"
}
2019-05-22 04:41:55 主控端配置成功！
2019-05-22 04:41:55 -------------------
2019-05-22 04:41:55 开始安装v2ray服务端,并且进行配置，使用ansible的script模块拷贝配置文件
45.76.219.250 | CHANGED => {
    "changed": true, 
    "rc": 0, 
    "stderr": "Shared connection to 45.76.219.250 closed.\r\n", 
    "stderr_lines": [
        "Shared connection to 45.76.219.250 closed."
    ], 
    "stdout": "安装v2ray服务端\r\nbash <(curl -L -s https://install.direct/go.sh)\r\n\u001b[36mInstalling V2Ray v4.18.2 on x86_64\u001b[0m\r\n\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.2/v2ray-linux-64.zip\u001b[0m\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r100   608    0   608    0     0   1188      0 --:--:-- --:--:-- --:--:--  1189\r\n\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r  0 11.2M    0  101k    0     0  64677      0  0:03:02  0:00:01  0:03:01  110k\r 31 11.2M   31 3574k    0     0  1375k      0  0:00:08  0:00:02  0:00:06 1871k\r100 11.2M  100 11.2M    0     0  3861k      0  0:00:02  0:00:02 --:--:-- 5023k\r\n\u001b[36mUpdating software repo\u001b[0m\r\n\u001b[36mInstalling unzip\u001b[0m\r\ndebconf: unable to initialize frontend: Dialog\r\ndebconf: (TERM is not set, so the dialog frontend is not usable.)\r\ndebconf: falling back to frontend: Readline\r\ndebconf: unable to initialize frontend: Readline\r\ndebconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)\r\ndebconf: falling back to frontend: Teletype\r\nSelecting previously unselected package unzip.\r\n(Reading database ... \r(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r(Reading database ... 70%\r(Reading database ... 75%\r(Reading database ... 80%\r(Reading database ... 85%\r(Reading database ... 90%\r(Reading database ... 95%\r(Reading database ... 100%\r(Reading database ... 21827 files and directories currently installed.)\r\nPreparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...\r\nUnpacking unzip (6.0-16+deb8u3) ...\r\nProcessing triggers for mime-support (3.58) ...\r\nProcessing triggers for man-db (2.7.0.2-5) ...\r\nSetting up unzip (6.0-16+deb8u3) ...\r\n\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m\r\nArchive:  /tmp/v2ray/v2ray.zip\r\n  inflating: /tmp/v2ray/config.json  \r\n   creating: /tmp/v2ray/doc/\r\n  inflating: /tmp/v2ray/doc/readme.md  \r\n  inflating: /tmp/v2ray/geoip.dat    \r\n  inflating: /tmp/v2ray/geosite.dat  \r\n   creating: /tmp/v2ray/systemd/\r\n  inflating: /tmp/v2ray/systemd/v2ray.service  \r\n   creating: /tmp/v2ray/systemv/\r\n  inflating: /tmp/v2ray/systemv/v2ray  \r\n  inflating: /tmp/v2ray/v2ctl        \r\n extracting: /tmp/v2ray/v2ctl.sig    \r\n  inflating: /tmp/v2ray/v2ray        \r\n extracting: /tmp/v2ray/v2ray.sig    \r\n  inflating: /tmp/v2ray/vpoint_socks_vmess.json  \r\n  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  \r\n\u001b[36mShutting down V2Ray service.\u001b[0m\r\nFailed to stop v2ray.service: Unit v2ray.service not loaded.\r\n\u001b[33mFailed to shutdown V2Ray service.\u001b[0m\r\n\u001b[36mPORT:16142\u001b[0m\r\n\u001b[36mUUID:ede8f9a2-dd21-4666-8e5b-fb572ae04615\u001b[0m\r\nCreated symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.\r\n\u001b[36mRestarting V2Ray service.\u001b[0m\r\n\u001b[32mV2Ray v4.18.2 is installed.\u001b[0m\r\nv2ray服务端安装成功\r\ncp /etc/v2ray/config.json /root/\r\nconfig文件备份成功\r\n", 
    "stdout_lines": [
        "安装v2ray服务端", 
        "bash <(curl -L -s https://install.direct/go.sh)", 
        "\u001b[36mInstalling V2Ray v4.18.2 on x86_64\u001b[0m", 
        "\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.2/v2ray-linux-64.zip\u001b[0m", 
        "  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current", 
        "                                 Dload  Upload   Total   Spent    Left  Speed", 
        "", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "100   608    0   608    0     0   1188      0 --:--:-- --:--:-- --:--:--  1189", 
        "", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "  0 11.2M    0  101k    0     0  64677      0  0:03:02  0:00:01  0:03:01  110k", 
        " 31 11.2M   31 3574k    0     0  1375k      0  0:00:08  0:00:02  0:00:06 1871k", 
        "100 11.2M  100 11.2M    0     0  3861k      0  0:00:02  0:00:02 --:--:-- 5023k", 
        "\u001b[36mUpdating software repo\u001b[0m", 
        "\u001b[36mInstalling unzip\u001b[0m", 
        "debconf: unable to initialize frontend: Dialog", 
        "debconf: (TERM is not set, so the dialog frontend is not usable.)", 
        "debconf: falling back to frontend: Readline", 
        "debconf: unable to initialize frontend: Readline", 
        "debconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)", 
        "debconf: falling back to frontend: Teletype", 
        "Selecting previously unselected package unzip.", 
        "(Reading database ... ", 
        "(Reading database ... 5%", 
        "(Reading database ... 10%", 
        "(Reading database ... 15%", 
        "(Reading database ... 20%", 
        "(Reading database ... 25%", 
        "(Reading database ... 30%", 
        "(Reading database ... 35%", 
        "(Reading database ... 40%", 
        "(Reading database ... 45%", 
        "(Reading database ... 50%", 
        "(Reading database ... 55%", 
        "(Reading database ... 60%", 
        "(Reading database ... 65%", 
        "(Reading database ... 70%", 
        "(Reading database ... 75%", 
        "(Reading database ... 80%", 
        "(Reading database ... 85%", 
        "(Reading database ... 90%", 
        "(Reading database ... 95%", 
        "(Reading database ... 100%", 
        "(Reading database ... 21827 files and directories currently installed.)", 
        "Preparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...", 
        "Unpacking unzip (6.0-16+deb8u3) ...", 
        "Processing triggers for mime-support (3.58) ...", 
        "Processing triggers for man-db (2.7.0.2-5) ...", 
        "Setting up unzip (6.0-16+deb8u3) ...", 
        "\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m", 
        "Archive:  /tmp/v2ray/v2ray.zip", 
        "  inflating: /tmp/v2ray/config.json  ", 
        "   creating: /tmp/v2ray/doc/", 
        "  inflating: /tmp/v2ray/doc/readme.md  ", 
        "  inflating: /tmp/v2ray/geoip.dat    ", 
        "  inflating: /tmp/v2ray/geosite.dat  ", 
        "   creating: /tmp/v2ray/systemd/", 
        "  inflating: /tmp/v2ray/systemd/v2ray.service  ", 
        "   creating: /tmp/v2ray/systemv/", 
        "  inflating: /tmp/v2ray/systemv/v2ray  ", 
        "  inflating: /tmp/v2ray/v2ctl        ", 
        " extracting: /tmp/v2ray/v2ctl.sig    ", 
        "  inflating: /tmp/v2ray/v2ray        ", 
        " extracting: /tmp/v2ray/v2ray.sig    ", 
        "  inflating: /tmp/v2ray/vpoint_socks_vmess.json  ", 
        "  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  ", 
        "\u001b[36mShutting down V2Ray service.\u001b[0m", 
        "Failed to stop v2ray.service: Unit v2ray.service not loaded.", 
        "\u001b[33mFailed to shutdown V2Ray service.\u001b[0m", 
        "\u001b[36mPORT:16142\u001b[0m", 
        "\u001b[36mUUID:ede8f9a2-dd21-4666-8e5b-fb572ae04615\u001b[0m", 
        "Created symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.", 
        "\u001b[36mRestarting V2Ray service.\u001b[0m", 
        "\u001b[32mV2Ray v4.18.2 is installed.\u001b[0m", 
        "v2ray服务端安装成功", 
        "cp /etc/v2ray/config.json /root/", 
        "config文件备份成功"
    ]
}
45.76.219.250 | CHANGED => {
    "changed": true, 
    "checksum": "642c4f754bbfa22a465305bf9f28f0be6b8d51d3", 
    "dest": "/etc/v2ray/config.json", 
    "gid": 0, 
    "group": "root", 
    "md5sum": "e1c9ae8913976ca140c692152b5ade95", 
    "mode": "0644", 
    "owner": "root", 
    "size": 1448, 
    "src": "/root/.ansible/tmp/ansible-tmp-1558471331.83-35640760762367/source", 
    "state": "file", 
    "uid": 0
}
2019-05-22 04:42:18 v2ray服务端安装完毕！
2019-05-22 04:42:18 获取v2ray服务器的IP\PORT\ID
45.76.219.250 | CHANGED | rc=0 >>
{
  "inbounds": [{
    "port": 16142,
    "protocol": "vmess",
    "settings": {
      "clients": [
        {
          "id": "ede8f9a2-dd21-4666-8e5b-fb572ae04615",
          "level": 1,
          "alterId": 64
        }
      ]
    }
  }],
  "outbounds": [{
    "protocol": "freedom",
    "settings": {}
  },{
    "protocol": "blackhole",
    "settings": {},
    "tag": "blocked"
  }],
  "routing": {
    "rules": [
      {
        "type": "field",
        "ip": ["geoip:private"],
        "outboundTag": "blocked"
      }
    ]
  }
}
45.76.219.250 | CHANGED | rc=0 >>
{
  "log" : {
    "access": "/var/log/v2ray/access.log",
    "error": "/var/log/v2ray/error.log",
    "loglevel": "warning"
  },
  "inbound": {
    "port": 31139,
    "protocol": "vmess", 
    "settings": {
      "clients": [
        {
          "id": "805ed8a8-7967-49c0-9f5d-057e86920c49",
          "level": 1,
          "alterId": 64
        }
      ],
      "detour":{
        "to":"dynamicPort"
      }
    },
    "streamSettings":{
      "network":"kcp"
    }
  },
  "inboundDetour":[
    {
      "protocol": "vmess",
      "port": "10000-20000",
      "tag": "dynamicPort",       
      "settings": {
        "default": {
          "level": 1,
          "alterId": 32
        }
      },
      "allocate": {            
        "strategy": "random",  
        "concurrency": 2,      
        "refresh": 3           
      },
      "streamSettings": {
        "network": "kcp"
      }
    }
  ],
  "outbound": {
    "protocol": "freedom",
    "settings": {}
  },
  "outboundDetour": [
    {
      "protocol": "blackhole",
      "settings": {},
      "tag": "blocked"
    }
  ],
 "transport":{
      "tcpSettings":{
         "connectionReuse":true
      },
      "kcpSettings":{ 
         "mtu":1350,
         "tti":20,
         "uplinkCapacity":100,
         "downlinkCapacity":100,
         "congestion":false,
         "readBufferSize":5,
         "writeBufferSize":5,
         "header":{
            "type":"utp"
         }
      }
   }
}
2019-05-22 04:42:35 45.76.219.250     "port": 16142,           "id": "ede8f9a2-dd21-4666-8e5b-fb572ae04615",
2019-05-22 04:42:35 正在修改-----------------
45.76.219.250 | CHANGED | rc=0 >>

45.76.219.250 | CHANGED | rc=0 >>

45.76.219.250 | CHANGED | rc=0 >>

45.76.219.250 | CHANGED | rc=0 >>

2019-05-22 04:42:48 修改完毕，v2ray服务端配置成功!重启v2ray服务器
45.76.219.250 | CHANGED | rc=0 >>

2019-05-22 04:42:52 v2ray服务重启成功！
2019-05-22 04:42:52 -------------------
2019-05-22 04:43:52 更新局域网的网关服务
2019-05-22 04:43:52 正在验证ggww 分组是否存在,请稍后...
2019-05-22 04:43:54 验证成功gw分组存在！分组名为ggww
2019-05-22 04:44:54 正在验证gslavew 分组是否存在,请稍后...
2019-05-22 04:45:00 验证成功gslavew 分组存在！分组名为gslavew
2019-05-22 04:45:03 v2ray_server的IP是45.76.219.250
2019-05-22 04:45:07     "port": 16142,
2019-05-22 04:45:10           "id": "ede8f9a2-dd21-4666-8e5b-fb572ae04615",
2019-05-22 04:45:10 下一步需要修改ggww 组的配置文件，现在正在形成参数
2019-05-22 04:45:10 修改gw的配置文件/etc/v2ray/config.json,/opt/v2ray-firewall
2019-05-22 04:45:10 1.拼接ip地址
2019-05-22 04:45:10 "address":"45.76.219.250",
2019-05-22 04:45:10 2.拼接端口号
2019-05-22 04:45:10 "port": 16142,
2019-05-22 04:45:10 3.拼接id
2019-05-22 04:45:10 "id": "ede8f9a2-dd21-4666-8e5b-fb572ae04615",
2019-05-22 04:45:10 执行修改局域网GW的配置文件
2019-05-22 04:45:10 配置ip地址
10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

2019-05-22 04:45:13 配置端口
192.168.1.252 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

2019-05-22 04:45:14 配置id
192.168.1.252 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

2019-05-22 04:45:15 配置防火墙
2019-05-22 04:45:15 1.拼接防火墙
2019-05-22 04:45:15 iptables -t nat -A V2RAY -d 45.76.219.250 -j RETURN
192.168.1.252 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

2019-05-22 04:45:17 重启gw的v2ray服务
192.168.1.252 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

2019-05-22 04:45:20 服务重启成功！
2019-05-22 04:45:20 配置完毕！
                                                                              
2019-05-22 04:45:20 检测的网关名为dns
2019-05-22 04:45:22 获取的v2ray服务器IP地址为108.160.133.156
2019-05-22 04:45:22 收集vultr的服务器列表
2019-05-22 04:45:23 dns 调用API成功，开始执行监控程序
2019-05-22 04:45:23 获取的v2ray服务器subid为 24750017
2019-05-22 04:45:23 获取的v2ray服务器DCID为 25
2019-05-22 04:45:23 获取的v2ray服务器label为ddnnss
2019-05-22 04:45:25 获取v2ray服务器宽带使用率为 9354980624 字节
2019-05-22 04:45:25 获取的宽带使用率为8 G
2019-05-22 04:45:25 流量小于10G，监控结束！
                                                                              
2019-05-22 04:45:25 检测的网关名为wifigw
2019-05-22 04:45:27 获取的v2ray服务器IP地址为202.182.100.205
2019-05-22 04:45:27 收集vultr的服务器列表
2019-05-22 04:45:28 wifigw 调用API成功，开始执行监控程序
2019-05-22 04:45:28 获取的v2ray服务器subid为 24750075
2019-05-22 04:45:28 获取的v2ray服务器DCID为 25
2019-05-22 04:45:28 获取的v2ray服务器label为wimasterfi
2019-05-22 04:45:29 获取v2ray服务器宽带使用率为 77395888 字节
2019-05-22 04:45:29 获取的宽带使用率为0 G
2019-05-22 04:45:29 流量小于10G，监控结束！
                                                                              
2019-05-22 04:45:29 检测的网关名为wifiggww
2019-05-22 04:45:31 获取的v2ray服务器IP地址为108.61.162.89
2019-05-22 04:45:31 收集vultr的服务器列表
2019-05-22 04:45:33 wifiggww 调用API成功，开始执行监控程序
2019-05-22 04:45:33 获取的v2ray服务器subid为 24759568
2019-05-22 04:45:33 获取的v2ray服务器DCID为 25
2019-05-22 04:45:33 获取的v2ray服务器label为wislavefi
2019-05-22 04:45:34 获取v2ray服务器宽带使用率为 43018728 字节
2019-05-22 04:45:34 获取的宽带使用率为0 G
2019-05-22 04:45:34 流量小于10G，监控结束！
                                                                              
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                                                              
                                                                              
2019-05-23 04:30:01 检测的网关名为gw
2019-05-23 04:30:02 获取的v2ray服务器IP地址为45.32.42.33
2019-05-23 04:30:02 收集vultr的服务器列表
2019-05-23 04:30:04 gw 调用API成功，开始执行监控程序
2019-05-23 04:30:04 获取的v2ray服务器subid为 24923631
2019-05-23 04:30:04 获取的v2ray服务器DCID为 25
2019-05-23 04:30:04 获取的v2ray服务器label为gmasterw
2019-05-23 04:30:06 获取v2ray服务器宽带使用率为 17691712748 字节
2019-05-23 04:30:06 获取的宽带使用率为16 G
2019-05-23 04:30:06 触发重新搭建服务器条件,同时将keepalived服务停用
2019-05-23 04:30:06 正在停用keepalived服务
10.24.1.254 | CHANGED | rc=0 >>

2019-05-23 04:30:08 gw 的keepalived服务停用成功
2019-05-23 04:30:08 正在销毁v2ray服务器
2019-05-23 04:30:10 等待删除gmasterw
2019-05-23 04:30:40 删除gmasterw 成功
2019-05-23 04:30:40 获取gw 使用的v2ray服务器的label	gmasterw
2019-05-23 04:30:40 重新安装v2ray服务器
2019-05-23 04:30:42 installing server......
2019-05-23 04:30:42 正在安装的v2ray服务器的subid为24935579
2019-05-23 04:31:04 新建的v2ray服务器IP地址为45.32.42.33
2019-05-23 04:31:05 获取的v2ray服务器的密码为T%m7KVQ1S!ZAnx#+
2019-05-23 04:31:05 sleep 60
2019-05-23 04:32:08 连接超时，重新安装服务器
Unable to reinstall server: Server is currently locked2019-05-23 04:33:41 检查v2ray服务器ip地址存在！
2019-05-23 04:33:41 ------------------------
2019-05-23 04:33:41 清理本地已经存在45.32.42.33 的密钥
# Host 45.32.42.33 found: line 18
/root/.ssh/known_hosts updated.
Original contents retained as /root/.ssh/known_hosts.old
2019-05-23 04:33:41 重新添加45.32.42.33 的密钥，正在添加密钥！
2019-05-23 04:33:42 v2ray_server安装ssh密钥
2019-05-23 04:33:46 ------------
2019-05-23 04:33:46 正在配置ansible主控端
2019-05-23 04:33:46 gmasterw 已存在
2019-05-23 04:33:46 主控端配置完毕！
2019-05-23 04:33:46 ------------
2019-05-23 04:33:46 测试ansible被控端
45.32.42.33 | SUCCESS => {
    "changed": false, 
    "ping": "pong"
}
2019-05-23 04:33:58 主控端配置成功！
2019-05-23 04:33:58 -------------------
2019-05-23 04:33:58 开始安装v2ray服务端,并且进行配置，使用ansible的script模块拷贝配置文件
45.32.42.33 | CHANGED => {
    "changed": true, 
    "rc": 0, 
    "stderr": "Shared connection to 45.32.42.33 closed.\r\n", 
    "stderr_lines": [
        "Shared connection to 45.32.42.33 closed."
    ], 
    "stdout": "安装v2ray服务端\r\nbash <(curl -L -s https://install.direct/go.sh)\r\n\u001b[36mInstalling V2Ray v4.18.2 on x86_64\u001b[0m\r\n\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.2/v2ray-linux-64.zip\u001b[0m\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r100   608    0   608    0     0   2090      0 --:--:-- --:--:-- --:--:--  2089\r\n\r  0 11.2M    0     0    0     0      0      0 --:--:--  0:00:01 --:--:--     0\r  3 11.2M    3  348k    0     0   160k      0  0:01:11  0:00:02  0:01:09  327k\r  7 11.2M    7  841k    0     0   271k      0  0:00:42  0:00:03  0:00:39  422k\r 10 11.2M   10 1231k    0     0   298k      0  0:00:38  0:00:04  0:00:34  408k\r 14 11.2M   14 1640k    0     0   319k      0  0:00:36  0:00:05  0:00:31  407k\r 17 11.2M   17 2065k    0     0   333k      0  0:00:34  0:00:06  0:00:28  406k\r 21 11.2M   21 2473k    0     0   346k      0  0:00:33  0:00:07  0:00:26  427k\r 25 11.2M   25 2982k    0     0   355k      0  0:00:32  0:00:08  0:00:24  405k\r 28 11.2M   28 3306k    0     0   363k      0  0:00:31  0:00:09  0:00:22  417k\r 32 11.2M   32 3748k    0     0   369k      0  0:00:31  0:00:10  0:00:21  419k\r 36 11.2M   36 4172k    0     0   373k      0  0:00:30  0:00:11  0:00:19  423k\r 39 11.2M   39 4512k    0     0   372k      0  0:00:30  0:00:12  0:00:18  410k\r 42 11.2M   42 4853k    0     0   368k      0  0:00:31  0:00:13  0:00:18  390k\r 45 11.2M   45 5244k    0     0   370k      0  0:00:31  0:00:14  0:00:17  382k\r 48 11.2M   48 5583k    0     0   369k      0  0:00:31  0:00:15  0:00:16  369k\r 51 11.2M   51 5992k    0     0   370k      0  0:00:31  0:00:16  0:00:15  362k\r 55 11.2M   55 6417k    0     0   371k      0  0:00:31  0:00:17  0:00:14  370k\r 58 11.2M   58 6773k    0     0   373k      0  0:00:30  0:00:18  0:00:12  386k\r 62 11.2M   62 7216k    0     0   375k      0  0:00:30  0:00:19  0:00:11  390k\r 66 11.2M   66 7641k    0     0   380k      0  0:00:30  0:00:20  0:00:10  414k\r 71 11.2M   71 8270k    0     0   390k      0  0:00:29  0:00:21  0:00:08  458k\r 79 11.2M   79 9136k    0     0   413k      0  0:00:27  0:00:22  0:00:05  562k\r 87 11.2M   87  9.8M    0     0   437k      0  0:00:26  0:00:23  0:00:03  670k\r100 11.2M  100 11.2M    0     0   480k      0  0:00:24  0:00:24 --:--:--  899k\r\n\u001b[36mUpdating software repo\u001b[0m\r\n\u001b[36mInstalling unzip\u001b[0m\r\ndebconf: unable to initialize frontend: Dialog\r\ndebconf: (TERM is not set, so the dialog frontend is not usable.)\r\ndebconf: falling back to frontend: Readline\r\ndebconf: unable to initialize frontend: Readline\r\ndebconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)\r\ndebconf: falling back to frontend: Teletype\r\nSelecting previously unselected package unzip.\r\n(Reading database ... \r(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r(Reading database ... 70%\r(Reading database ... 75%\r(Reading database ... 80%\r(Reading database ... 85%\r(Reading database ... 90%\r(Reading database ... 95%\r(Reading database ... 100%\r(Reading database ... 21827 files and directories currently installed.)\r\nPreparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...\r\nUnpacking unzip (6.0-16+deb8u3) ...\r\nProcessing triggers for mime-support (3.58) ...\r\nProcessing triggers for man-db (2.7.0.2-5) ...\r\nSetting up unzip (6.0-16+deb8u3) ...\r\n\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m\r\nArchive:  /tmp/v2ray/v2ray.zip\r\n  inflating: /tmp/v2ray/config.json  \r\n   creating: /tmp/v2ray/doc/\r\n  inflating: /tmp/v2ray/doc/readme.md  \r\n  inflating: /tmp/v2ray/geoip.dat    \r\n  inflating: /tmp/v2ray/geosite.dat  \r\n   creating: /tmp/v2ray/systemd/\r\n  inflating: /tmp/v2ray/systemd/v2ray.service  \r\n   creating: /tmp/v2ray/systemv/\r\n  inflating: /tmp/v2ray/systemv/v2ray  \r\n  inflating: /tmp/v2ray/v2ctl        \r\n extracting: /tmp/v2ray/v2ctl.sig    \r\n  inflating: /tmp/v2ray/v2ray        \r\n extracting: /tmp/v2ray/v2ray.sig    \r\n  inflating: /tmp/v2ray/vpoint_socks_vmess.json  \r\n  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  \r\n\u001b[36mShutting down V2Ray service.\u001b[0m\r\nFailed to stop v2ray.service: Unit v2ray.service not loaded.\r\n\u001b[33mFailed to shutdown V2Ray service.\u001b[0m\r\n\u001b[36mPORT:29103\u001b[0m\r\n\u001b[36mUUID:c2edc601-fc1b-4018-8d2a-6e4d9fcc031a\u001b[0m\r\nCreated symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.\r\n\u001b[36mRestarting V2Ray service.\u001b[0m\r\n\u001b[32mV2Ray v4.18.2 is installed.\u001b[0m\r\nv2ray服务端安装成功\r\ncp /etc/v2ray/config.json /root/\r\nconfig文件备份成功\r\n", 
    "stdout_lines": [
        "安装v2ray服务端", 
        "bash <(curl -L -s https://install.direct/go.sh)", 
        "\u001b[36mInstalling V2Ray v4.18.2 on x86_64\u001b[0m", 
        "\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.2/v2ray-linux-64.zip\u001b[0m", 
        "  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current", 
        "                                 Dload  Upload   Total   Spent    Left  Speed", 
        "", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "100   608    0   608    0     0   2090      0 --:--:-- --:--:-- --:--:--  2089", 
        "", 
        "  0 11.2M    0     0    0     0      0      0 --:--:--  0:00:01 --:--:--     0", 
        "  3 11.2M    3  348k    0     0   160k      0  0:01:11  0:00:02  0:01:09  327k", 
        "  7 11.2M    7  841k    0     0   271k      0  0:00:42  0:00:03  0:00:39  422k", 
        " 10 11.2M   10 1231k    0     0   298k      0  0:00:38  0:00:04  0:00:34  408k", 
        " 14 11.2M   14 1640k    0     0   319k      0  0:00:36  0:00:05  0:00:31  407k", 
        " 17 11.2M   17 2065k    0     0   333k      0  0:00:34  0:00:06  0:00:28  406k", 
        " 21 11.2M   21 2473k    0     0   346k      0  0:00:33  0:00:07  0:00:26  427k", 
        " 25 11.2M   25 2982k    0     0   355k      0  0:00:32  0:00:08  0:00:24  405k", 
        " 28 11.2M   28 3306k    0     0   363k      0  0:00:31  0:00:09  0:00:22  417k", 
        " 32 11.2M   32 3748k    0     0   369k      0  0:00:31  0:00:10  0:00:21  419k", 
        " 36 11.2M   36 4172k    0     0   373k      0  0:00:30  0:00:11  0:00:19  423k", 
        " 39 11.2M   39 4512k    0     0   372k      0  0:00:30  0:00:12  0:00:18  410k", 
        " 42 11.2M   42 4853k    0     0   368k      0  0:00:31  0:00:13  0:00:18  390k", 
        " 45 11.2M   45 5244k    0     0   370k      0  0:00:31  0:00:14  0:00:17  382k", 
        " 48 11.2M   48 5583k    0     0   369k      0  0:00:31  0:00:15  0:00:16  369k", 
        " 51 11.2M   51 5992k    0     0   370k      0  0:00:31  0:00:16  0:00:15  362k", 
        " 55 11.2M   55 6417k    0     0   371k      0  0:00:31  0:00:17  0:00:14  370k", 
        " 58 11.2M   58 6773k    0     0   373k      0  0:00:30  0:00:18  0:00:12  386k", 
        " 62 11.2M   62 7216k    0     0   375k      0  0:00:30  0:00:19  0:00:11  390k", 
        " 66 11.2M   66 7641k    0     0   380k      0  0:00:30  0:00:20  0:00:10  414k", 
        " 71 11.2M   71 8270k    0     0   390k      0  0:00:29  0:00:21  0:00:08  458k", 
        " 79 11.2M   79 9136k    0     0   413k      0  0:00:27  0:00:22  0:00:05  562k", 
        " 87 11.2M   87  9.8M    0     0   437k      0  0:00:26  0:00:23  0:00:03  670k", 
        "100 11.2M  100 11.2M    0     0   480k      0  0:00:24  0:00:24 --:--:--  899k", 
        "\u001b[36mUpdating software repo\u001b[0m", 
        "\u001b[36mInstalling unzip\u001b[0m", 
        "debconf: unable to initialize frontend: Dialog", 
        "debconf: (TERM is not set, so the dialog frontend is not usable.)", 
        "debconf: falling back to frontend: Readline", 
        "debconf: unable to initialize frontend: Readline", 
        "debconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)", 
        "debconf: falling back to frontend: Teletype", 
        "Selecting previously unselected package unzip.", 
        "(Reading database ... ", 
        "(Reading database ... 5%", 
        "(Reading database ... 10%", 
        "(Reading database ... 15%", 
        "(Reading database ... 20%", 
        "(Reading database ... 25%", 
        "(Reading database ... 30%", 
        "(Reading database ... 35%", 
        "(Reading database ... 40%", 
        "(Reading database ... 45%", 
        "(Reading database ... 50%", 
        "(Reading database ... 55%", 
        "(Reading database ... 60%", 
        "(Reading database ... 65%", 
        "(Reading database ... 70%", 
        "(Reading database ... 75%", 
        "(Reading database ... 80%", 
        "(Reading database ... 85%", 
        "(Reading database ... 90%", 
        "(Reading database ... 95%", 
        "(Reading database ... 100%", 
        "(Reading database ... 21827 files and directories currently installed.)", 
        "Preparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...", 
        "Unpacking unzip (6.0-16+deb8u3) ...", 
        "Processing triggers for mime-support (3.58) ...", 
        "Processing triggers for man-db (2.7.0.2-5) ...", 
        "Setting up unzip (6.0-16+deb8u3) ...", 
        "\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m", 
        "Archive:  /tmp/v2ray/v2ray.zip", 
        "  inflating: /tmp/v2ray/config.json  ", 
        "   creating: /tmp/v2ray/doc/", 
        "  inflating: /tmp/v2ray/doc/readme.md  ", 
        "  inflating: /tmp/v2ray/geoip.dat    ", 
        "  inflating: /tmp/v2ray/geosite.dat  ", 
        "   creating: /tmp/v2ray/systemd/", 
        "  inflating: /tmp/v2ray/systemd/v2ray.service  ", 
        "   creating: /tmp/v2ray/systemv/", 
        "  inflating: /tmp/v2ray/systemv/v2ray  ", 
        "  inflating: /tmp/v2ray/v2ctl        ", 
        " extracting: /tmp/v2ray/v2ctl.sig    ", 
        "  inflating: /tmp/v2ray/v2ray        ", 
        " extracting: /tmp/v2ray/v2ray.sig    ", 
        "  inflating: /tmp/v2ray/vpoint_socks_vmess.json  ", 
        "  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  ", 
        "\u001b[36mShutting down V2Ray service.\u001b[0m", 
        "Failed to stop v2ray.service: Unit v2ray.service not loaded.", 
        "\u001b[33mFailed to shutdown V2Ray service.\u001b[0m", 
        "\u001b[36mPORT:29103\u001b[0m", 
        "\u001b[36mUUID:c2edc601-fc1b-4018-8d2a-6e4d9fcc031a\u001b[0m", 
        "Created symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.", 
        "\u001b[36mRestarting V2Ray service.\u001b[0m", 
        "\u001b[32mV2Ray v4.18.2 is installed.\u001b[0m", 
        "v2ray服务端安装成功", 
        "cp /etc/v2ray/config.json /root/", 
        "config文件备份成功"
    ]
}
45.32.42.33 | CHANGED => {
    "changed": true, 
    "checksum": "642c4f754bbfa22a465305bf9f28f0be6b8d51d3", 
    "dest": "/etc/v2ray/config.json", 
    "gid": 0, 
    "group": "root", 
    "md5sum": "e1c9ae8913976ca140c692152b5ade95", 
    "mode": "0644", 
    "owner": "root", 
    "size": 1448, 
    "src": "/root/.ansible/tmp/ansible-tmp-1558557273.85-82046005285907/source", 
    "state": "file", 
    "uid": 0
}
2019-05-23 04:34:44 v2ray服务端安装完毕！
2019-05-23 04:34:44 获取v2ray服务器的IP\PORT\ID
45.32.42.33 | CHANGED | rc=0 >>
{
  "inbounds": [{
    "port": 29103,
    "protocol": "vmess",
    "settings": {
      "clients": [
        {
          "id": "c2edc601-fc1b-4018-8d2a-6e4d9fcc031a",
          "level": 1,
          "alterId": 64
        }
      ]
    }
  }],
  "outbounds": [{
    "protocol": "freedom",
    "settings": {}
  },{
    "protocol": "blackhole",
    "settings": {},
    "tag": "blocked"
  }],
  "routing": {
    "rules": [
      {
        "type": "field",
        "ip": ["geoip:private"],
        "outboundTag": "blocked"
      }
    ]
  }
}
45.32.42.33 | CHANGED | rc=0 >>
{
  "log" : {
    "access": "/var/log/v2ray/access.log",
    "error": "/var/log/v2ray/error.log",
    "loglevel": "warning"
  },
  "inbound": {
    "port": 31139,
    "protocol": "vmess", 
    "settings": {
      "clients": [
        {
          "id": "805ed8a8-7967-49c0-9f5d-057e86920c49",
          "level": 1,
          "alterId": 64
        }
      ],
      "detour":{
        "to":"dynamicPort"
      }
    },
    "streamSettings":{
      "network":"kcp"
    }
  },
  "inboundDetour":[
    {
      "protocol": "vmess",
      "port": "10000-20000",
      "tag": "dynamicPort",       
      "settings": {
        "default": {
          "level": 1,
          "alterId": 32
        }
      },
      "allocate": {            
        "strategy": "random",  
        "concurrency": 2,      
        "refresh": 3           
      },
      "streamSettings": {
        "network": "kcp"
      }
    }
  ],
  "outbound": {
    "protocol": "freedom",
    "settings": {}
  },
  "outboundDetour": [
    {
      "protocol": "blackhole",
      "settings": {},
      "tag": "blocked"
    }
  ],
 "transport":{
      "tcpSettings":{
         "connectionReuse":true
      },
      "kcpSettings":{ 
         "mtu":1350,
         "tti":20,
         "uplinkCapacity":100,
         "downlinkCapacity":100,
         "congestion":false,
         "readBufferSize":5,
         "writeBufferSize":5,
         "header":{
            "type":"utp"
         }
      }
   }
}
2019-05-23 04:35:03 45.32.42.33     "port": 29103,           "id": "c2edc601-fc1b-4018-8d2a-6e4d9fcc031a",
2019-05-23 04:35:03 正在修改-----------------
45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

2019-05-23 04:35:16 修改完毕，v2ray服务端配置成功!重启v2ray服务器
45.32.42.33 | CHANGED | rc=0 >>

2019-05-23 04:35:20 v2ray服务重启成功！
2019-05-23 04:35:20 -------------------
2019-05-23 04:36:20 更新局域网的网关服务
2019-05-23 04:36:20 正在验证gw 分组是否存在,请稍后...
2019-05-23 04:36:22 验证成功gw分组存在！分组名为gw
2019-05-23 04:37:22 正在验证gmasterw 分组是否存在,请稍后...
2019-05-23 04:37:28 验证成功gmasterw 分组存在！分组名为gmasterw
2019-05-23 04:37:32 v2ray_server的IP是45.32.42.33
2019-05-23 04:37:35     "port": 29103,
2019-05-23 04:37:39           "id": "c2edc601-fc1b-4018-8d2a-6e4d9fcc031a",
2019-05-23 04:37:39 下一步需要修改gw 组的配置文件，现在正在形成参数
2019-05-23 04:37:39 修改gw的配置文件/etc/v2ray/config.json,/opt/v2ray-firewall
2019-05-23 04:37:39 1.拼接ip地址
2019-05-23 04:37:39 "address":"45.32.42.33",
2019-05-23 04:37:39 2.拼接端口号
2019-05-23 04:37:39 "port": 29103,
2019-05-23 04:37:39 3.拼接id
2019-05-23 04:37:39 "id": "c2edc601-fc1b-4018-8d2a-6e4d9fcc031a",
2019-05-23 04:37:39 执行修改局域网GW的配置文件
2019-05-23 04:37:39 配置ip地址
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-23 04:37:41 配置端口
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-23 04:37:43 配置id
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-23 04:37:44 配置防火墙
2019-05-23 04:37:44 1.拼接防火墙
2019-05-23 04:37:44 iptables -t nat -A V2RAY -d 45.32.42.33 -j RETURN
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-23 04:37:45 重启gw的v2ray服务
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-23 04:37:47 服务重启成功！
2019-05-23 04:37:47 配置完毕！
                                                                              
2019-05-23 04:37:47 检测的网关名为ggww
2019-05-23 04:37:49 获取的v2ray服务器IP地址为45.76.219.250
2019-05-23 04:37:49 收集vultr的服务器列表
2019-05-23 04:37:51 ggww 调用API成功，开始执行监控程序
2019-05-23 04:37:51 获取的v2ray服务器subid为 24912584
2019-05-23 04:37:51 获取的v2ray服务器DCID为 25
2019-05-23 04:37:51 获取的v2ray服务器label为gslavew
2019-05-23 04:37:52 获取v2ray服务器宽带使用率为 3462497662 字节
2019-05-23 04:37:52 获取的宽带使用率为3 G
2019-05-23 04:37:52 流量小于10G，监控结束！
                                                                              
2019-05-23 04:37:52 检测的网关名为dns
2019-05-23 04:37:54 获取的v2ray服务器IP地址为108.160.133.156
2019-05-23 04:37:54 收集vultr的服务器列表
2019-05-23 04:37:56 dns 调用API成功，开始执行监控程序
2019-05-23 04:37:56 获取的v2ray服务器subid为 24750017
2019-05-23 04:37:56 获取的v2ray服务器DCID为 25
2019-05-23 04:37:56 获取的v2ray服务器label为ddnnss
2019-05-23 04:37:58 获取v2ray服务器宽带使用率为 9393299014 字节
2019-05-23 04:37:58 获取的宽带使用率为8 G
2019-05-23 04:37:58 流量小于10G，监控结束！
                                                                              
2019-05-23 04:37:58 检测的网关名为wifigw
2019-05-23 04:37:59 获取的v2ray服务器IP地址为202.182.100.205
2019-05-23 04:37:59 收集vultr的服务器列表
2019-05-23 04:38:01 wifigw 调用API成功，开始执行监控程序
2019-05-23 04:38:01 获取的v2ray服务器subid为 24750075
2019-05-23 04:38:01 获取的v2ray服务器DCID为 25
2019-05-23 04:38:01 获取的v2ray服务器label为wimasterfi
2019-05-23 04:38:03 获取v2ray服务器宽带使用率为 94249273 字节
2019-05-23 04:38:03 获取的宽带使用率为0 G
2019-05-23 04:38:03 流量小于10G，监控结束！
                                                                              
2019-05-23 04:38:03 检测的网关名为wifiggww
2019-05-23 04:38:05 获取的v2ray服务器IP地址为108.61.162.89
2019-05-23 04:38:05 收集vultr的服务器列表
2019-05-23 04:38:06 wifiggww 调用API成功，开始执行监控程序
2019-05-23 04:38:06 获取的v2ray服务器subid为 24759568
2019-05-23 04:38:06 获取的v2ray服务器DCID为 25
2019-05-23 04:38:06 获取的v2ray服务器label为wislavefi
2019-05-23 04:38:08 获取v2ray服务器宽带使用率为 49657966 字节
2019-05-23 04:38:08 获取的宽带使用率为0 G
2019-05-23 04:38:08 流量小于10G，监控结束！
                                                                              
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                                                              
                                                                              
2019-05-24 04:30:02 检测的网关名为gw
2019-05-24 04:30:03 获取的v2ray服务器IP地址为45.32.42.33
2019-05-24 04:30:03 收集vultr的服务器列表
2019-05-24 04:30:05 gw 调用API成功，开始执行监控程序
2019-05-24 04:30:05 获取的v2ray服务器subid为 24952786
2019-05-24 04:30:05 获取的v2ray服务器DCID为 25
2019-05-24 04:30:05 获取的v2ray服务器label为gmasterw
2019-05-24 04:30:07 获取v2ray服务器宽带使用率为 4994282 字节
2019-05-24 04:30:07 获取的宽带使用率为0 G
2019-05-24 04:30:07 流量小于10G，监控结束！
                                                                              
2019-05-24 04:30:07 检测的网关名为ggww
2019-05-24 04:30:08 获取的v2ray服务器IP地址为45.76.219.250
2019-05-24 04:30:08 收集vultr的服务器列表
2019-05-24 04:30:12 ggww 调用API成功，开始执行监控程序
2019-05-24 04:30:12 获取的v2ray服务器subid为 24912584
2019-05-24 04:30:12 获取的v2ray服务器DCID为 25
2019-05-24 04:30:12 获取的v2ray服务器label为gslavew
2019-05-24 04:30:13 获取v2ray服务器宽带使用率为 10609544901 字节
2019-05-24 04:30:13 获取的宽带使用率为9 G
2019-05-24 04:30:13 流量小于10G，监控结束！
                                                                              
2019-05-24 04:30:13 检测的网关名为dns
2019-05-24 04:30:15 获取的v2ray服务器IP地址为108.160.133.156
2019-05-24 04:30:15 收集vultr的服务器列表
2019-05-24 04:30:17 dns 调用API成功，开始执行监控程序
2019-05-24 04:30:17 获取的v2ray服务器subid为 24750017
2019-05-24 04:30:17 获取的v2ray服务器DCID为 25
2019-05-24 04:30:17 获取的v2ray服务器label为ddnnss
2019-05-24 04:30:18 获取v2ray服务器宽带使用率为 9618041764 字节
2019-05-24 04:30:18 获取的宽带使用率为8 G
2019-05-24 04:30:18 流量小于10G，监控结束！
                                                                              
2019-05-24 04:30:18 检测的网关名为wifigw
2019-05-24 04:30:20 获取的v2ray服务器IP地址为202.182.100.205
2019-05-24 04:30:20 收集vultr的服务器列表
2019-05-24 04:30:21 wifigw 调用API成功，开始执行监控程序
2019-05-24 04:30:21 获取的v2ray服务器subid为 24750075
2019-05-24 04:30:21 获取的v2ray服务器DCID为 25
2019-05-24 04:30:21 获取的v2ray服务器label为wimasterfi
2019-05-24 04:30:22 获取v2ray服务器宽带使用率为 109264951 字节
2019-05-24 04:30:22 获取的宽带使用率为0 G
2019-05-24 04:30:22 流量小于10G，监控结束！
                                                                              
2019-05-24 04:30:22 检测的网关名为wifiggww
2019-05-24 04:30:24 获取的v2ray服务器IP地址为108.61.162.89
2019-05-24 04:30:24 收集vultr的服务器列表
2019-05-24 04:30:25 wifiggww 调用API成功，开始执行监控程序
2019-05-24 04:30:25 获取的v2ray服务器subid为 24759568
2019-05-24 04:30:25 获取的v2ray服务器DCID为 25
2019-05-24 04:30:25 获取的v2ray服务器label为wislavefi
2019-05-24 04:30:26 获取v2ray服务器宽带使用率为 56673662 字节
2019-05-24 04:30:26 获取的宽带使用率为0 G
2019-05-24 04:30:26 流量小于10G，监控结束！
                                                                              
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                                                              
                                                                              
2019-05-25 04:30:01 检测的网关名为gw
2019-05-25 04:30:03 获取的v2ray服务器IP地址为45.32.42.33
2019-05-25 04:30:03 收集vultr的服务器列表
2019-05-25 04:30:04 gw 调用API成功，开始执行监控程序
2019-05-25 04:30:04 获取的v2ray服务器subid为 24952786
2019-05-25 04:30:04 获取的v2ray服务器DCID为 25
2019-05-25 04:30:04 获取的v2ray服务器label为gmasterw
2019-05-25 04:30:05 获取v2ray服务器宽带使用率为 28305555 字节
2019-05-25 04:30:05 获取的宽带使用率为0 G
2019-05-25 04:30:05 流量小于10G，监控结束！
                                                                              
2019-05-25 04:30:05 检测的网关名为ggww
2019-05-25 04:30:07 获取的v2ray服务器IP地址为45.76.219.250
2019-05-25 04:30:07 收集vultr的服务器列表
2019-05-25 04:30:08 ggww 调用API成功，开始执行监控程序
2019-05-25 04:30:08 获取的v2ray服务器subid为 24968582
2019-05-25 04:30:08 获取的v2ray服务器DCID为 25
2019-05-25 04:30:08 获取的v2ray服务器label为gslavew
2019-05-25 04:30:09 获取v2ray服务器宽带使用率为 807897799 字节
2019-05-25 04:30:09 获取的宽带使用率为0 G
2019-05-25 04:30:09 流量小于10G，监控结束！
                                                                              
2019-05-25 04:30:09 检测的网关名为dns
2019-05-25 04:30:11 获取的v2ray服务器IP地址为108.160.133.156
2019-05-25 04:30:11 收集vultr的服务器列表
2019-05-25 04:30:12 dns 调用API成功，开始执行监控程序
2019-05-25 04:30:12 获取的v2ray服务器subid为 24750017
2019-05-25 04:30:12 获取的v2ray服务器DCID为 25
2019-05-25 04:30:12 获取的v2ray服务器label为ddnnss
2019-05-25 04:30:14 获取v2ray服务器宽带使用率为 16363470649 字节
2019-05-25 04:30:14 获取的宽带使用率为15 G
2019-05-25 04:30:14 触发重新搭建服务器条件,同时将keepalived服务停用
2019-05-25 04:30:14 正在停用keepalived服务
10.24.1.252 | CHANGED | rc=0 >>

192.168.1.251 | CHANGED | rc=0 >>

10.24.1.251 | CHANGED | rc=0 >>

192.168.10.252 | CHANGED | rc=0 >>

192.168.10.251 | CHANGED | rc=0 >>

2019-05-25 04:30:15 dns 的keepalived服务停用成功
2019-05-25 04:30:15 正在销毁v2ray服务器
2019-05-25 04:30:17 等待删除ddnnss
2019-05-25 04:30:47 删除ddnnss 成功
2019-05-25 04:30:47 获取dns 使用的v2ray服务器的label	ddnnss
2019-05-25 04:30:47 重新安装v2ray服务器
2019-05-25 04:30:49 installing server......
2019-05-25 04:30:49 正在安装的v2ray服务器的subid为24977958
2019-05-25 04:31:11 新建的v2ray服务器IP地址为108.160.133.156
2019-05-25 04:31:13 getting pwd......
2019-05-25 04:31:34 获取的v2ray服务器的密码为6Yn!9PM3fARwv$$h
2019-05-25 04:31:34 sleep 60
2019-05-25 04:32:35 连接超时，重新安装服务器
Unable to reinstall server: Server is currently locked2019-05-25 04:34:10 连接超时，重新安装服务器
Unable to reinstall server: Server is currently locked重试2次无效，退出
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                                                              
                                                                              
2019-05-26 04:30:01 检测的网关名为gw
2019-05-26 04:30:03 获取的v2ray服务器IP地址为45.32.42.33
2019-05-26 04:30:03 收集vultr的服务器列表
2019-05-26 04:30:09 gw 调用API成功，开始执行监控程序
2019-05-26 04:30:09 获取的v2ray服务器subid为 24952786
2019-05-26 04:30:09 获取的v2ray服务器DCID为 25
2019-05-26 04:30:09 获取的v2ray服务器label为gmasterw
2019-05-26 04:30:11 获取v2ray服务器宽带使用率为 52527807 字节
2019-05-26 04:30:11 获取的宽带使用率为0 G
2019-05-26 04:30:11 流量小于10G，监控结束！
                                                                              
2019-05-26 04:30:11 检测的网关名为ggww
2019-05-26 04:30:12 获取的v2ray服务器IP地址为45.76.219.250
2019-05-26 04:30:12 收集vultr的服务器列表
2019-05-26 04:30:14 ggww 调用API成功，开始执行监控程序
2019-05-26 04:30:14 获取的v2ray服务器subid为 24968582
2019-05-26 04:30:14 获取的v2ray服务器DCID为 25
2019-05-26 04:30:14 获取的v2ray服务器label为gslavew
2019-05-26 04:30:15 获取v2ray服务器宽带使用率为 7284619720 字节
2019-05-26 04:30:15 获取的宽带使用率为6 G
2019-05-26 04:30:15 流量小于10G，监控结束！
                                                                              
2019-05-26 04:30:15 检测的网关名为dns
2019-05-26 04:30:17 获取的v2ray服务器IP地址为108.160.133.156
2019-05-26 04:30:17 收集vultr的服务器列表
2019-05-26 04:30:18 dns 调用API成功，开始执行监控程序
2019-05-26 04:30:18 获取的v2ray服务器subid为 24977958
2019-05-26 04:30:18 获取的v2ray服务器DCID为 25
2019-05-26 04:30:18 获取的v2ray服务器label为ddnnss
2019-05-26 04:30:19 获取v2ray服务器宽带使用率为 53403883 字节
2019-05-26 04:30:19 获取的宽带使用率为0 G
2019-05-26 04:30:19 流量小于10G，监控结束！
                                                                              
2019-05-26 04:30:19 检测的网关名为wifigw
2019-05-26 04:30:21 获取的v2ray服务器IP地址为202.182.100.205
2019-05-26 04:30:21 收集vultr的服务器列表
2019-05-26 04:30:23 wifigw 调用API成功，开始执行监控程序
2019-05-26 04:30:23 获取的v2ray服务器subid为 24750075
2019-05-26 04:30:23 获取的v2ray服务器DCID为 25
2019-05-26 04:30:23 获取的v2ray服务器label为wimasterfi
2019-05-26 04:30:24 获取v2ray服务器宽带使用率为 137150299 字节
2019-05-26 04:30:24 获取的宽带使用率为0 G
2019-05-26 04:30:24 流量小于10G，监控结束！
                                                                              
2019-05-26 04:30:24 检测的网关名为wifiggww
2019-05-26 04:30:26 获取的v2ray服务器IP地址为108.61.162.89
2019-05-26 04:30:26 收集vultr的服务器列表
2019-05-26 04:30:29 wifiggww 调用API成功，开始执行监控程序
2019-05-26 04:30:29 获取的v2ray服务器subid为 24759568
2019-05-26 04:30:29 获取的v2ray服务器DCID为 25
2019-05-26 04:30:29 获取的v2ray服务器label为wislavefi
2019-05-26 04:30:30 获取v2ray服务器宽带使用率为 69545060 字节
2019-05-26 04:30:30 获取的宽带使用率为0 G
2019-05-26 04:30:30 流量小于10G，监控结束！
                                                                              
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                                                              
                                                                              
2019-05-27 04:30:02 检测的网关名为gw
2019-05-27 04:30:03 获取的v2ray服务器IP地址为45.32.42.33
2019-05-27 04:30:03 收集vultr的服务器列表
2019-05-27 04:30:05 gw 调用API成功，开始执行监控程序
2019-05-27 04:30:05 获取的v2ray服务器subid为 24952786
2019-05-27 04:30:05 获取的v2ray服务器DCID为 25
2019-05-27 04:30:05 获取的v2ray服务器label为gmasterw
2019-05-27 04:30:06 获取v2ray服务器宽带使用率为 85742320 字节
2019-05-27 04:30:06 获取的宽带使用率为0 G
2019-05-27 04:30:06 流量小于10G，监控结束！
                                                                              
2019-05-27 04:30:06 检测的网关名为ggww
2019-05-27 04:30:08 获取的v2ray服务器IP地址为45.76.219.250
2019-05-27 04:30:08 收集vultr的服务器列表
2019-05-27 04:30:09 ggww 调用API成功，开始执行监控程序
2019-05-27 04:30:09 获取的v2ray服务器subid为 24968582
2019-05-27 04:30:09 获取的v2ray服务器DCID为 25
2019-05-27 04:30:09 获取的v2ray服务器label为gslavew
2019-05-27 04:30:10 获取v2ray服务器宽带使用率为 9239364997 字节
2019-05-27 04:30:10 获取的宽带使用率为8 G
2019-05-27 04:30:10 流量小于10G，监控结束！
                                                                              
2019-05-27 04:30:10 检测的网关名为dns
2019-05-27 04:30:12 获取的v2ray服务器IP地址为108.160.133.156
2019-05-27 04:30:12 收集vultr的服务器列表
2019-05-27 04:30:13 dns 调用API成功，开始执行监控程序
2019-05-27 04:30:13 获取的v2ray服务器subid为 24977958
2019-05-27 04:30:13 获取的v2ray服务器DCID为 25
2019-05-27 04:30:13 获取的v2ray服务器label为ddnnss
2019-05-27 04:30:14 获取v2ray服务器宽带使用率为 103646905 字节
2019-05-27 04:30:14 获取的宽带使用率为0 G
2019-05-27 04:30:14 流量小于10G，监控结束！
                                                                              
2019-05-27 04:30:14 检测的网关名为wifigw
2019-05-27 04:30:16 获取的v2ray服务器IP地址为202.182.100.205
2019-05-27 04:30:16 收集vultr的服务器列表
2019-05-27 04:30:17 wifigw 调用API成功，开始执行监控程序
2019-05-27 04:30:17 获取的v2ray服务器subid为 24750075
2019-05-27 04:30:17 获取的v2ray服务器DCID为 25
2019-05-27 04:30:17 获取的v2ray服务器label为wimasterfi
2019-05-27 04:30:20 获取v2ray服务器宽带使用率为 145155748 字节
2019-05-27 04:30:20 获取的宽带使用率为0 G
2019-05-27 04:30:20 流量小于10G，监控结束！
                                                                              
2019-05-27 04:30:20 检测的网关名为wifiggww
2019-05-27 04:30:22 获取的v2ray服务器IP地址为108.61.162.89
2019-05-27 04:30:22 收集vultr的服务器列表
2019-05-27 04:30:23 wifiggww 调用API成功，开始执行监控程序
2019-05-27 04:30:23 获取的v2ray服务器subid为 24759568
2019-05-27 04:30:23 获取的v2ray服务器DCID为 25
2019-05-27 04:30:23 获取的v2ray服务器label为wislavefi
2019-05-27 04:30:25 获取v2ray服务器宽带使用率为 87455796 字节
2019-05-27 04:30:25 获取的宽带使用率为0 G
2019-05-27 04:30:25 流量小于10G，监控结束！
                                                                              
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                                                              
                                                                              
2019-05-28 04:30:01 检测的网关名为gw
2019-05-28 04:30:03 获取的v2ray服务器IP地址为45.32.42.33
2019-05-28 04:30:03 收集vultr的服务器列表
2019-05-28 04:30:05 gw 调用API成功，开始执行监控程序
2019-05-28 04:30:05 获取的v2ray服务器subid为 25030663
2019-05-28 04:30:05 获取的v2ray服务器DCID为 25
2019-05-28 04:30:05 获取的v2ray服务器label为gmasterw
2019-05-28 04:30:06 获取v2ray服务器宽带使用率为 32716338773 字节
2019-05-28 04:30:06 获取的宽带使用率为30 G
2019-05-28 04:30:06 触发重新搭建服务器条件,同时将keepalived服务停用
2019-05-28 04:30:06 正在停用keepalived服务
10.24.1.254 | CHANGED | rc=0 >>

2019-05-28 04:30:08 gw 的keepalived服务停用成功
2019-05-28 04:30:08 正在销毁v2ray服务器
2019-05-28 04:30:09 等待删除gmasterw
2019-05-28 04:30:39 删除gmasterw 成功
2019-05-28 04:30:39 获取gw 使用的v2ray服务器的label	gmasterw
2019-05-28 04:30:39 重新安装v2ray服务器
2019-05-28 04:30:42 installing server......
2019-05-28 04:30:42 正在安装的v2ray服务器的subid为25037769
2019-05-28 04:31:03 新建的v2ray服务器IP地址为45.32.42.33
2019-05-28 04:31:04 获取的v2ray服务器的密码为pT5]=v..16[.Ndj$
2019-05-28 04:31:04 sleep 60
2019-05-28 04:32:07 连接超时，重新安装服务器
Unable to reinstall server: Server is currently locked2019-05-28 04:33:39 检查v2ray服务器ip地址存在！
2019-05-28 04:33:39 ------------------------
2019-05-28 04:33:39 清理本地已经存在45.32.42.33 的密钥
# Host 45.32.42.33 found: line 18
/root/.ssh/known_hosts updated.
Original contents retained as /root/.ssh/known_hosts.old
2019-05-28 04:33:39 重新添加45.32.42.33 的密钥，正在添加密钥！
2019-05-28 04:35:40 v2ray_server安装ssh密钥
2019-05-28 04:36:10 ------------
2019-05-28 04:36:10 正在配置ansible主控端
2019-05-28 04:36:10 gmasterw 已存在
2019-05-28 04:36:10 主控端配置完毕！
2019-05-28 04:36:10 ------------
2019-05-28 04:36:10 测试ansible被控端
45.32.42.33 | SUCCESS => {
    "changed": false, 
    "ping": "pong"
}
2019-05-28 04:36:20 主控端配置成功！
2019-05-28 04:36:20 -------------------
2019-05-28 04:36:20 开始安装v2ray服务端,并且进行配置，使用ansible的script模块拷贝配置文件
45.32.42.33 | CHANGED => {
    "changed": true, 
    "rc": 0, 
    "stderr": "Shared connection to 45.32.42.33 closed.\r\n", 
    "stderr_lines": [
        "Shared connection to 45.32.42.33 closed."
    ], 
    "stdout": "安装v2ray服务端\r\nbash <(curl -L -s https://install.direct/go.sh)\r\n\u001b[36mInstalling V2Ray v4.18.2 on x86_64\u001b[0m\r\n\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.2/v2ray-linux-64.zip\u001b[0m\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r100   608    0   608    0     0   2253      0 --:--:-- --:--:-- --:--:--  2251\r\n\r  0 11.2M    0 16970    0     0  14215      0  0:13:50  0:00:01  0:13:49 14215\r 15 11.2M   15 1732k    0     0   760k      0  0:00:15  0:00:02  0:00:13 1583k\r100 11.2M  100 11.2M    0     0  4071k      0  0:00:02  0:00:02 --:--:-- 7032k\r\n\u001b[36mUpdating software repo\u001b[0m\r\n\u001b[36mInstalling unzip\u001b[0m\r\ndebconf: unable to initialize frontend: Dialog\r\ndebconf: (TERM is not set, so the dialog frontend is not usable.)\r\ndebconf: falling back to frontend: Readline\r\ndebconf: unable to initialize frontend: Readline\r\ndebconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)\r\ndebconf: falling back to frontend: Teletype\r\nSelecting previously unselected package unzip.\r\n(Reading database ... \r(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r(Reading database ... 70%\r(Reading database ... 75%\r(Reading database ... 80%\r(Reading database ... 85%\r(Reading database ... 90%\r(Reading database ... 95%\r(Reading database ... 100%\r(Reading database ... 21827 files and directories currently installed.)\r\nPreparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...\r\nUnpacking unzip (6.0-16+deb8u3) ...\r\nProcessing triggers for mime-support (3.58) ...\r\nProcessing triggers for man-db (2.7.0.2-5) ...\r\nSetting up unzip (6.0-16+deb8u3) ...\r\n\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m\r\nArchive:  /tmp/v2ray/v2ray.zip\r\n  inflating: /tmp/v2ray/config.json  \r\n   creating: /tmp/v2ray/doc/\r\n  inflating: /tmp/v2ray/doc/readme.md  \r\n  inflating: /tmp/v2ray/geoip.dat    \r\n  inflating: /tmp/v2ray/geosite.dat  \r\n   creating: /tmp/v2ray/systemd/\r\n  inflating: /tmp/v2ray/systemd/v2ray.service  \r\n   creating: /tmp/v2ray/systemv/\r\n  inflating: /tmp/v2ray/systemv/v2ray  \r\n  inflating: /tmp/v2ray/v2ctl        \r\n extracting: /tmp/v2ray/v2ctl.sig    \r\n  inflating: /tmp/v2ray/v2ray        \r\n extracting: /tmp/v2ray/v2ray.sig    \r\n  inflating: /tmp/v2ray/vpoint_socks_vmess.json  \r\n  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  \r\n\u001b[36mShutting down V2Ray service.\u001b[0m\r\nFailed to stop v2ray.service: Unit v2ray.service not loaded.\r\n\u001b[33mFailed to shutdown V2Ray service.\u001b[0m\r\n\u001b[36mPORT:38081\u001b[0m\r\n\u001b[36mUUID:b655022b-5d6a-4dfb-9b46-c15003fc559b\u001b[0m\r\nCreated symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.\r\n\u001b[36mRestarting V2Ray service.\u001b[0m\r\n\u001b[32mV2Ray v4.18.2 is installed.\u001b[0m\r\nv2ray服务端安装成功\r\ncp /etc/v2ray/config.json /root/\r\nconfig文件备份成功\r\n", 
    "stdout_lines": [
        "安装v2ray服务端", 
        "bash <(curl -L -s https://install.direct/go.sh)", 
        "\u001b[36mInstalling V2Ray v4.18.2 on x86_64\u001b[0m", 
        "\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.2/v2ray-linux-64.zip\u001b[0m", 
        "  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current", 
        "                                 Dload  Upload   Total   Spent    Left  Speed", 
        "", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "100   608    0   608    0     0   2253      0 --:--:-- --:--:-- --:--:--  2251", 
        "", 
        "  0 11.2M    0 16970    0     0  14215      0  0:13:50  0:00:01  0:13:49 14215", 
        " 15 11.2M   15 1732k    0     0   760k      0  0:00:15  0:00:02  0:00:13 1583k", 
        "100 11.2M  100 11.2M    0     0  4071k      0  0:00:02  0:00:02 --:--:-- 7032k", 
        "\u001b[36mUpdating software repo\u001b[0m", 
        "\u001b[36mInstalling unzip\u001b[0m", 
        "debconf: unable to initialize frontend: Dialog", 
        "debconf: (TERM is not set, so the dialog frontend is not usable.)", 
        "debconf: falling back to frontend: Readline", 
        "debconf: unable to initialize frontend: Readline", 
        "debconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)", 
        "debconf: falling back to frontend: Teletype", 
        "Selecting previously unselected package unzip.", 
        "(Reading database ... ", 
        "(Reading database ... 5%", 
        "(Reading database ... 10%", 
        "(Reading database ... 15%", 
        "(Reading database ... 20%", 
        "(Reading database ... 25%", 
        "(Reading database ... 30%", 
        "(Reading database ... 35%", 
        "(Reading database ... 40%", 
        "(Reading database ... 45%", 
        "(Reading database ... 50%", 
        "(Reading database ... 55%", 
        "(Reading database ... 60%", 
        "(Reading database ... 65%", 
        "(Reading database ... 70%", 
        "(Reading database ... 75%", 
        "(Reading database ... 80%", 
        "(Reading database ... 85%", 
        "(Reading database ... 90%", 
        "(Reading database ... 95%", 
        "(Reading database ... 100%", 
        "(Reading database ... 21827 files and directories currently installed.)", 
        "Preparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...", 
        "Unpacking unzip (6.0-16+deb8u3) ...", 
        "Processing triggers for mime-support (3.58) ...", 
        "Processing triggers for man-db (2.7.0.2-5) ...", 
        "Setting up unzip (6.0-16+deb8u3) ...", 
        "\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m", 
        "Archive:  /tmp/v2ray/v2ray.zip", 
        "  inflating: /tmp/v2ray/config.json  ", 
        "   creating: /tmp/v2ray/doc/", 
        "  inflating: /tmp/v2ray/doc/readme.md  ", 
        "  inflating: /tmp/v2ray/geoip.dat    ", 
        "  inflating: /tmp/v2ray/geosite.dat  ", 
        "   creating: /tmp/v2ray/systemd/", 
        "  inflating: /tmp/v2ray/systemd/v2ray.service  ", 
        "   creating: /tmp/v2ray/systemv/", 
        "  inflating: /tmp/v2ray/systemv/v2ray  ", 
        "  inflating: /tmp/v2ray/v2ctl        ", 
        " extracting: /tmp/v2ray/v2ctl.sig    ", 
        "  inflating: /tmp/v2ray/v2ray        ", 
        " extracting: /tmp/v2ray/v2ray.sig    ", 
        "  inflating: /tmp/v2ray/vpoint_socks_vmess.json  ", 
        "  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  ", 
        "\u001b[36mShutting down V2Ray service.\u001b[0m", 
        "Failed to stop v2ray.service: Unit v2ray.service not loaded.", 
        "\u001b[33mFailed to shutdown V2Ray service.\u001b[0m", 
        "\u001b[36mPORT:38081\u001b[0m", 
        "\u001b[36mUUID:b655022b-5d6a-4dfb-9b46-c15003fc559b\u001b[0m", 
        "Created symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.", 
        "\u001b[36mRestarting V2Ray service.\u001b[0m", 
        "\u001b[32mV2Ray v4.18.2 is installed.\u001b[0m", 
        "v2ray服务端安装成功", 
        "cp /etc/v2ray/config.json /root/", 
        "config文件备份成功"
    ]
}
45.32.42.33 | CHANGED => {
    "changed": true, 
    "checksum": "642c4f754bbfa22a465305bf9f28f0be6b8d51d3", 
    "dest": "/etc/v2ray/config.json", 
    "gid": 0, 
    "group": "root", 
    "md5sum": "e1c9ae8913976ca140c692152b5ade95", 
    "mode": "0644", 
    "owner": "root", 
    "size": 1448, 
    "src": "/root/.ansible/tmp/ansible-tmp-1558989395.74-166532698733212/source", 
    "state": "file", 
    "uid": 0
}
2019-05-28 04:36:42 v2ray服务端安装完毕！
2019-05-28 04:36:42 获取v2ray服务器的IP\PORT\ID
45.32.42.33 | CHANGED | rc=0 >>
{
  "inbounds": [{
    "port": 38081,
    "protocol": "vmess",
    "settings": {
      "clients": [
        {
          "id": "b655022b-5d6a-4dfb-9b46-c15003fc559b",
          "level": 1,
          "alterId": 64
        }
      ]
    }
  }],
  "outbounds": [{
    "protocol": "freedom",
    "settings": {}
  },{
    "protocol": "blackhole",
    "settings": {},
    "tag": "blocked"
  }],
  "routing": {
    "rules": [
      {
        "type": "field",
        "ip": ["geoip:private"],
        "outboundTag": "blocked"
      }
    ]
  }
}
45.32.42.33 | CHANGED | rc=0 >>
{
  "log" : {
    "access": "/var/log/v2ray/access.log",
    "error": "/var/log/v2ray/error.log",
    "loglevel": "warning"
  },
  "inbound": {
    "port": 31139,
    "protocol": "vmess", 
    "settings": {
      "clients": [
        {
          "id": "805ed8a8-7967-49c0-9f5d-057e86920c49",
          "level": 1,
          "alterId": 64
        }
      ],
      "detour":{
        "to":"dynamicPort"
      }
    },
    "streamSettings":{
      "network":"kcp"
    }
  },
  "inboundDetour":[
    {
      "protocol": "vmess",
      "port": "10000-20000",
      "tag": "dynamicPort",       
      "settings": {
        "default": {
          "level": 1,
          "alterId": 32
        }
      },
      "allocate": {            
        "strategy": "random",  
        "concurrency": 2,      
        "refresh": 3           
      },
      "streamSettings": {
        "network": "kcp"
      }
    }
  ],
  "outbound": {
    "protocol": "freedom",
    "settings": {}
  },
  "outboundDetour": [
    {
      "protocol": "blackhole",
      "settings": {},
      "tag": "blocked"
    }
  ],
 "transport":{
      "tcpSettings":{
         "connectionReuse":true
      },
      "kcpSettings":{ 
         "mtu":1350,
         "tti":20,
         "uplinkCapacity":100,
         "downlinkCapacity":100,
         "congestion":false,
         "readBufferSize":5,
         "writeBufferSize":5,
         "header":{
            "type":"utp"
         }
      }
   }
}
2019-05-28 04:37:00 45.32.42.33     "port": 38081,           "id": "b655022b-5d6a-4dfb-9b46-c15003fc559b",
2019-05-28 04:37:00 正在修改-----------------
45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

2019-05-28 04:37:14 修改完毕，v2ray服务端配置成功!重启v2ray服务器
45.32.42.33 | CHANGED | rc=0 >>

2019-05-28 04:37:17 v2ray服务重启成功！
2019-05-28 04:37:17 -------------------
2019-05-28 04:38:17 更新局域网的网关服务
2019-05-28 04:38:17 正在验证gw 分组是否存在,请稍后...
2019-05-28 04:38:19 验证成功gw分组存在！分组名为gw
2019-05-28 04:39:19 正在验证gmasterw 分组是否存在,请稍后...
2019-05-28 04:39:25 验证成功gmasterw 分组存在！分组名为gmasterw
2019-05-28 04:39:29 v2ray_server的IP是45.32.42.33
2019-05-28 04:39:32     "port": 38081,
2019-05-28 04:39:36           "id": "b655022b-5d6a-4dfb-9b46-c15003fc559b",
2019-05-28 04:39:36 下一步需要修改gw 组的配置文件，现在正在形成参数
2019-05-28 04:39:36 修改gw的配置文件/etc/v2ray/config.json,/opt/v2ray-firewall
2019-05-28 04:39:36 1.拼接ip地址
2019-05-28 04:39:36 "address":"45.32.42.33",
2019-05-28 04:39:36 2.拼接端口号
2019-05-28 04:39:36 "port": 38081,
2019-05-28 04:39:36 3.拼接id
2019-05-28 04:39:36 "id": "b655022b-5d6a-4dfb-9b46-c15003fc559b",
2019-05-28 04:39:36 执行修改局域网GW的配置文件
2019-05-28 04:39:36 配置ip地址
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-28 04:39:38 配置端口
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-28 04:39:40 配置id
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-28 04:39:41 配置防火墙
2019-05-28 04:39:41 1.拼接防火墙
2019-05-28 04:39:41 iptables -t nat -A V2RAY -d 45.32.42.33 -j RETURN
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-28 04:39:42 重启gw的v2ray服务
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-28 04:39:45 服务重启成功！
2019-05-28 04:39:45 配置完毕！
                                                                              
2019-05-28 04:39:45 检测的网关名为ggww
2019-05-28 04:39:49 获取的v2ray服务器IP地址为45.76.219.250
2019-05-28 04:39:49 收集vultr的服务器列表
2019-05-28 04:39:50 ggww 调用API成功，开始执行监控程序
2019-05-28 04:39:50 获取的v2ray服务器subid为 25021017
2019-05-28 04:39:50 获取的v2ray服务器DCID为 25
2019-05-28 04:39:50 获取的v2ray服务器label为gslavew
2019-05-28 04:39:52 获取v2ray服务器宽带使用率为 31171981297 字节
2019-05-28 04:39:52 获取的宽带使用率为29 G
2019-05-28 04:39:52 触发重新搭建服务器条件,同时将keepalived服务停用
2019-05-28 04:39:52 正在停用keepalived服务
10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | UNREACHABLE! => {
    "changed": false, 
    "msg": "Failed to connect to the host via ssh: ssh: connect to host 192.168.1.252 port 22: No route to host", 
    "unreachable": true
}
2019-05-28 04:39:55 ggww 的keepalived服务停用成功
2019-05-28 04:39:55 正在销毁v2ray服务器
2019-05-28 04:39:56 等待删除gslavew
2019-05-28 04:40:26 删除gslavew 成功
2019-05-28 04:40:26 获取ggww 使用的v2ray服务器的label	gslavew
2019-05-28 04:40:26 重新安装v2ray服务器
2019-05-28 04:40:29 installing server......
2019-05-28 04:40:29 正在安装的v2ray服务器的subid为25037841
2019-05-28 04:40:50 新建的v2ray服务器IP地址为45.76.219.250
2019-05-28 04:40:51 获取的v2ray服务器的密码为p6R)j_7p42aqTWCg
2019-05-28 04:40:51 sleep 60
2019-05-28 04:41:54 连接超时，重新安装服务器
Unable to reinstall server: Server is currently locked2019-05-28 04:43:26 检查v2ray服务器ip地址存在！
2019-05-28 04:43:26 ------------------------
2019-05-28 04:43:26 清理本地已经存在45.76.219.250 的密钥
# Host 45.76.219.250 found: line 16
/root/.ssh/known_hosts updated.
Original contents retained as /root/.ssh/known_hosts.old
2019-05-28 04:43:26 重新添加45.76.219.250 的密钥，正在添加密钥！
2019-05-28 04:44:17 v2ray_server安装ssh密钥
2019-05-28 04:44:19 ------------
2019-05-28 04:44:19 正在配置ansible主控端
2019-05-28 04:44:19 gslavew 已存在
2019-05-28 04:44:19 主控端配置完毕！
2019-05-28 04:44:19 ------------
2019-05-28 04:44:19 测试ansible被控端
45.76.219.250 | SUCCESS => {
    "changed": false, 
    "ping": "pong"
}
2019-05-28 04:44:29 主控端配置成功！
2019-05-28 04:44:29 -------------------
2019-05-28 04:44:29 开始安装v2ray服务端,并且进行配置，使用ansible的script模块拷贝配置文件
45.76.219.250 | CHANGED => {
    "changed": true, 
    "rc": 0, 
    "stderr": "Shared connection to 45.76.219.250 closed.\r\n", 
    "stderr_lines": [
        "Shared connection to 45.76.219.250 closed."
    ], 
    "stdout": "安装v2ray服务端\r\nbash <(curl -L -s https://install.direct/go.sh)\r\n\u001b[36mInstalling V2Ray v4.18.2 on x86_64\u001b[0m\r\n\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.2/v2ray-linux-64.zip\u001b[0m\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r100   608    0   608    0     0    778      0 --:--:-- --:--:-- --:--:--   778\r\n\r  0     0    0     0    0     0      0      0 --:--:--  0:00:01 --:--:--     0\r  4 11.2M    4  525k    0     0   211k      0  0:00:54  0:00:02  0:00:52  461k\r 90 11.2M   90 10.1M    0     0  3034k      0  0:00:03  0:00:03 --:--:-- 5011k\r100 11.2M  100 11.2M    0     0  3364k      0  0:00:03  0:00:03 --:--:-- 5550k\r\n\u001b[36mUpdating software repo\u001b[0m\r\n\u001b[36mInstalling unzip\u001b[0m\r\ndebconf: unable to initialize frontend: Dialog\r\ndebconf: (TERM is not set, so the dialog frontend is not usable.)\r\ndebconf: falling back to frontend: Readline\r\ndebconf: unable to initialize frontend: Readline\r\ndebconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)\r\ndebconf: falling back to frontend: Teletype\r\nSelecting previously unselected package unzip.\r\n(Reading database ... \r(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r(Reading database ... 70%\r(Reading database ... 75%\r(Reading database ... 80%\r(Reading database ... 85%\r(Reading database ... 90%\r(Reading database ... 95%\r(Reading database ... 100%\r(Reading database ... 21827 files and directories currently installed.)\r\nPreparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...\r\nUnpacking unzip (6.0-16+deb8u3) ...\r\nProcessing triggers for mime-support (3.58) ...\r\nProcessing triggers for man-db (2.7.0.2-5) ...\r\nSetting up unzip (6.0-16+deb8u3) ...\r\n\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m\r\nArchive:  /tmp/v2ray/v2ray.zip\r\n  inflating: /tmp/v2ray/config.json  \r\n   creating: /tmp/v2ray/doc/\r\n  inflating: /tmp/v2ray/doc/readme.md  \r\n  inflating: /tmp/v2ray/geoip.dat    \r\n  inflating: /tmp/v2ray/geosite.dat  \r\n   creating: /tmp/v2ray/systemd/\r\n  inflating: /tmp/v2ray/systemd/v2ray.service  \r\n   creating: /tmp/v2ray/systemv/\r\n  inflating: /tmp/v2ray/systemv/v2ray  \r\n  inflating: /tmp/v2ray/v2ctl        \r\n extracting: /tmp/v2ray/v2ctl.sig    \r\n  inflating: /tmp/v2ray/v2ray        \r\n extracting: /tmp/v2ray/v2ray.sig    \r\n  inflating: /tmp/v2ray/vpoint_socks_vmess.json  \r\n  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  \r\n\u001b[36mShutting down V2Ray service.\u001b[0m\r\nFailed to stop v2ray.service: Unit v2ray.service not loaded.\r\n\u001b[33mFailed to shutdown V2Ray service.\u001b[0m\r\n\u001b[36mPORT:35925\u001b[0m\r\n\u001b[36mUUID:cb3aaafb-44de-4622-9c12-4af46973e4d7\u001b[0m\r\nCreated symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.\r\n\u001b[36mRestarting V2Ray service.\u001b[0m\r\n\u001b[32mV2Ray v4.18.2 is installed.\u001b[0m\r\nv2ray服务端安装成功\r\ncp /etc/v2ray/config.json /root/\r\nconfig文件备份成功\r\n", 
    "stdout_lines": [
        "安装v2ray服务端", 
        "bash <(curl -L -s https://install.direct/go.sh)", 
        "\u001b[36mInstalling V2Ray v4.18.2 on x86_64\u001b[0m", 
        "\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.2/v2ray-linux-64.zip\u001b[0m", 
        "  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current", 
        "                                 Dload  Upload   Total   Spent    Left  Speed", 
        "", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "100   608    0   608    0     0    778      0 --:--:-- --:--:-- --:--:--   778", 
        "", 
        "  0     0    0     0    0     0      0      0 --:--:--  0:00:01 --:--:--     0", 
        "  4 11.2M    4  525k    0     0   211k      0  0:00:54  0:00:02  0:00:52  461k", 
        " 90 11.2M   90 10.1M    0     0  3034k      0  0:00:03  0:00:03 --:--:-- 5011k", 
        "100 11.2M  100 11.2M    0     0  3364k      0  0:00:03  0:00:03 --:--:-- 5550k", 
        "\u001b[36mUpdating software repo\u001b[0m", 
        "\u001b[36mInstalling unzip\u001b[0m", 
        "debconf: unable to initialize frontend: Dialog", 
        "debconf: (TERM is not set, so the dialog frontend is not usable.)", 
        "debconf: falling back to frontend: Readline", 
        "debconf: unable to initialize frontend: Readline", 
        "debconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)", 
        "debconf: falling back to frontend: Teletype", 
        "Selecting previously unselected package unzip.", 
        "(Reading database ... ", 
        "(Reading database ... 5%", 
        "(Reading database ... 10%", 
        "(Reading database ... 15%", 
        "(Reading database ... 20%", 
        "(Reading database ... 25%", 
        "(Reading database ... 30%", 
        "(Reading database ... 35%", 
        "(Reading database ... 40%", 
        "(Reading database ... 45%", 
        "(Reading database ... 50%", 
        "(Reading database ... 55%", 
        "(Reading database ... 60%", 
        "(Reading database ... 65%", 
        "(Reading database ... 70%", 
        "(Reading database ... 75%", 
        "(Reading database ... 80%", 
        "(Reading database ... 85%", 
        "(Reading database ... 90%", 
        "(Reading database ... 95%", 
        "(Reading database ... 100%", 
        "(Reading database ... 21827 files and directories currently installed.)", 
        "Preparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...", 
        "Unpacking unzip (6.0-16+deb8u3) ...", 
        "Processing triggers for mime-support (3.58) ...", 
        "Processing triggers for man-db (2.7.0.2-5) ...", 
        "Setting up unzip (6.0-16+deb8u3) ...", 
        "\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m", 
        "Archive:  /tmp/v2ray/v2ray.zip", 
        "  inflating: /tmp/v2ray/config.json  ", 
        "   creating: /tmp/v2ray/doc/", 
        "  inflating: /tmp/v2ray/doc/readme.md  ", 
        "  inflating: /tmp/v2ray/geoip.dat    ", 
        "  inflating: /tmp/v2ray/geosite.dat  ", 
        "   creating: /tmp/v2ray/systemd/", 
        "  inflating: /tmp/v2ray/systemd/v2ray.service  ", 
        "   creating: /tmp/v2ray/systemv/", 
        "  inflating: /tmp/v2ray/systemv/v2ray  ", 
        "  inflating: /tmp/v2ray/v2ctl        ", 
        " extracting: /tmp/v2ray/v2ctl.sig    ", 
        "  inflating: /tmp/v2ray/v2ray        ", 
        " extracting: /tmp/v2ray/v2ray.sig    ", 
        "  inflating: /tmp/v2ray/vpoint_socks_vmess.json  ", 
        "  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  ", 
        "\u001b[36mShutting down V2Ray service.\u001b[0m", 
        "Failed to stop v2ray.service: Unit v2ray.service not loaded.", 
        "\u001b[33mFailed to shutdown V2Ray service.\u001b[0m", 
        "\u001b[36mPORT:35925\u001b[0m", 
        "\u001b[36mUUID:cb3aaafb-44de-4622-9c12-4af46973e4d7\u001b[0m", 
        "Created symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.", 
        "\u001b[36mRestarting V2Ray service.\u001b[0m", 
        "\u001b[32mV2Ray v4.18.2 is installed.\u001b[0m", 
        "v2ray服务端安装成功", 
        "cp /etc/v2ray/config.json /root/", 
        "config文件备份成功"
    ]
}
45.76.219.250 | CHANGED => {
    "changed": true, 
    "checksum": "642c4f754bbfa22a465305bf9f28f0be6b8d51d3", 
    "dest": "/etc/v2ray/config.json", 
    "gid": 0, 
    "group": "root", 
    "md5sum": "e1c9ae8913976ca140c692152b5ade95", 
    "mode": "0644", 
    "owner": "root", 
    "size": 1448, 
    "src": "/root/.ansible/tmp/ansible-tmp-1558989890.08-52089400602166/source", 
    "state": "file", 
    "uid": 0
}
2019-05-28 04:44:57 v2ray服务端安装完毕！
2019-05-28 04:44:57 获取v2ray服务器的IP\PORT\ID
45.76.219.250 | CHANGED | rc=0 >>
{
  "inbounds": [{
    "port": 35925,
    "protocol": "vmess",
    "settings": {
      "clients": [
        {
          "id": "cb3aaafb-44de-4622-9c12-4af46973e4d7",
          "level": 1,
          "alterId": 64
        }
      ]
    }
  }],
  "outbounds": [{
    "protocol": "freedom",
    "settings": {}
  },{
    "protocol": "blackhole",
    "settings": {},
    "tag": "blocked"
  }],
  "routing": {
    "rules": [
      {
        "type": "field",
        "ip": ["geoip:private"],
        "outboundTag": "blocked"
      }
    ]
  }
}
45.76.219.250 | CHANGED | rc=0 >>
{
  "log" : {
    "access": "/var/log/v2ray/access.log",
    "error": "/var/log/v2ray/error.log",
    "loglevel": "warning"
  },
  "inbound": {
    "port": 31139,
    "protocol": "vmess", 
    "settings": {
      "clients": [
        {
          "id": "805ed8a8-7967-49c0-9f5d-057e86920c49",
          "level": 1,
          "alterId": 64
        }
      ],
      "detour":{
        "to":"dynamicPort"
      }
    },
    "streamSettings":{
      "network":"kcp"
    }
  },
  "inboundDetour":[
    {
      "protocol": "vmess",
      "port": "10000-20000",
      "tag": "dynamicPort",       
      "settings": {
        "default": {
          "level": 1,
          "alterId": 32
        }
      },
      "allocate": {            
        "strategy": "random",  
        "concurrency": 2,      
        "refresh": 3           
      },
      "streamSettings": {
        "network": "kcp"
      }
    }
  ],
  "outbound": {
    "protocol": "freedom",
    "settings": {}
  },
  "outboundDetour": [
    {
      "protocol": "blackhole",
      "settings": {},
      "tag": "blocked"
    }
  ],
 "transport":{
      "tcpSettings":{
         "connectionReuse":true
      },
      "kcpSettings":{ 
         "mtu":1350,
         "tti":20,
         "uplinkCapacity":100,
         "downlinkCapacity":100,
         "congestion":false,
         "readBufferSize":5,
         "writeBufferSize":5,
         "header":{
            "type":"utp"
         }
      }
   }
}
2019-05-28 04:45:14 45.76.219.250     "port": 35925,           "id": "cb3aaafb-44de-4622-9c12-4af46973e4d7",
2019-05-28 04:45:14 正在修改-----------------
45.76.219.250 | CHANGED | rc=0 >>

45.76.219.250 | CHANGED | rc=0 >>

45.76.219.250 | CHANGED | rc=0 >>

45.76.219.250 | CHANGED | rc=0 >>

2019-05-28 04:45:28 修改完毕，v2ray服务端配置成功!重启v2ray服务器
45.76.219.250 | CHANGED | rc=0 >>

2019-05-28 04:45:31 v2ray服务重启成功！
2019-05-28 04:45:31 -------------------
2019-05-28 04:46:31 更新局域网的网关服务
2019-05-28 04:46:31 正在验证ggww 分组是否存在,请稍后...
2019-05-28 04:46:35 验证成功gw分组存在！分组名为ggww
2019-05-28 04:47:35 正在验证gslavew 分组是否存在,请稍后...
2019-05-28 04:47:40 验证成功gslavew 分组存在！分组名为gslavew
2019-05-28 04:47:44 v2ray_server的IP是45.76.219.250
2019-05-28 04:47:47     "port": 35925,
2019-05-28 04:47:51           "id": "cb3aaafb-44de-4622-9c12-4af46973e4d7",
2019-05-28 04:47:51 下一步需要修改ggww 组的配置文件，现在正在形成参数
2019-05-28 04:47:51 修改gw的配置文件/etc/v2ray/config.json,/opt/v2ray-firewall
2019-05-28 04:47:51 1.拼接ip地址
2019-05-28 04:47:51 "address":"45.76.219.250",
2019-05-28 04:47:51 2.拼接端口号
2019-05-28 04:47:51 "port": 35925,
2019-05-28 04:47:51 3.拼接id
2019-05-28 04:47:51 "id": "cb3aaafb-44de-4622-9c12-4af46973e4d7",
2019-05-28 04:47:51 执行修改局域网GW的配置文件
2019-05-28 04:47:51 配置ip地址
10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | UNREACHABLE! => {
    "changed": false, 
    "msg": "Failed to connect to the host via ssh: ssh: connect to host 192.168.1.252 port 22: No route to host", 
    "unreachable": true
}
10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | UNREACHABLE! => {
    "changed": false, 
    "msg": "Failed to connect to the host via ssh: ssh: connect to host 192.168.1.252 port 22: No route to host", 
    "unreachable": true
}
2019-05-28 04:47:57 配置端口
10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | UNREACHABLE! => {
    "changed": false, 
    "msg": "Failed to connect to the host via ssh: ssh: connect to host 192.168.1.252 port 22: No route to host", 
    "unreachable": true
}
10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | UNREACHABLE! => {
    "changed": false, 
    "msg": "Failed to connect to the host via ssh: ssh: connect to host 192.168.1.252 port 22: No route to host", 
    "unreachable": true
}
2019-05-28 04:48:04 配置id
10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | UNREACHABLE! => {
    "changed": false, 
    "msg": "Failed to connect to the host via ssh: ssh: connect to host 192.168.1.252 port 22: No route to host", 
    "unreachable": true
}
10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | UNREACHABLE! => {
    "changed": false, 
    "msg": "Failed to connect to the host via ssh: ssh: connect to host 192.168.1.252 port 22: No route to host", 
    "unreachable": true
}
2019-05-28 04:48:10 配置防火墙
2019-05-28 04:48:10 1.拼接防火墙
2019-05-28 04:48:10 iptables -t nat -A V2RAY -d 45.76.219.250 -j RETURN
10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | UNREACHABLE! => {
    "changed": false, 
    "msg": "Failed to connect to the host via ssh: ssh: connect to host 192.168.1.252 port 22: No route to host", 
    "unreachable": true
}
10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | UNREACHABLE! => {
    "changed": false, 
    "msg": "Failed to connect to the host via ssh: ssh: connect to host 192.168.1.252 port 22: No route to host", 
    "unreachable": true
}
2019-05-28 04:48:16 重启gw的v2ray服务
10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | UNREACHABLE! => {
    "changed": false, 
    "msg": "Failed to connect to the host via ssh: ssh: connect to host 192.168.1.252 port 22: No route to host", 
    "unreachable": true
}
10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | UNREACHABLE! => {
    "changed": false, 
    "msg": "Failed to connect to the host via ssh: ssh: connect to host 192.168.1.252 port 22: No route to host", 
    "unreachable": true
}
10.24.1.253 | CHANGED | rc=0 >>

192.168.1.252 | UNREACHABLE! => {
    "changed": false, 
    "msg": "Failed to connect to the host via ssh: ssh: connect to host 192.168.1.252 port 22: No route to host", 
    "unreachable": true
}
2019-05-28 04:48:25 服务重启成功！
2019-05-28 04:48:25 配置完毕！
                                                                              
2019-05-28 04:48:25 检测的网关名为dns
2019-05-28 04:48:29 获取的v2ray服务器IP地址为108.160.133.156
2019-05-28 04:48:29 收集vultr的服务器列表
2019-05-28 04:48:30 dns 调用API成功，开始执行监控程序
2019-05-28 04:48:30 获取的v2ray服务器subid为 25021030
2019-05-28 04:48:30 获取的v2ray服务器DCID为 25
2019-05-28 04:48:30 获取的v2ray服务器label为ddnnss
2019-05-28 04:48:32 获取v2ray服务器宽带使用率为 48045389 字节
2019-05-28 04:48:32 获取的宽带使用率为0 G
2019-05-28 04:48:32 流量小于10G，监控结束！
                                                                              
2019-05-28 04:48:32 检测的网关名为wifigw
2019-05-28 04:48:35 获取的v2ray服务器IP地址为
2019-05-28 04:48:35 收集vultr的服务器列表
2019-05-28 04:48:36 wifigw 调用API成功，开始执行监控程序
2019-05-28 04:48:36 获取的v2ray服务器subid为 
2019-05-28 04:48:36 获取的v2ray服务器DCID为 
2019-05-28 04:48:36 获取的v2ray服务器label为
2019-05-28 04:48:38 获取v2ray服务器宽带使用率为  字节
2019-05-28 04:48:38 获取的宽带使用率为 G
2019-05-28 04:48:38 流量小于10G，监控结束！
                                                                              
2019-05-28 04:48:38 检测的网关名为wifiggww
2019-05-28 04:48:41 获取的v2ray服务器IP地址为
2019-05-28 04:48:41 收集vultr的服务器列表
2019-05-28 04:48:42 wifiggww 调用API成功，开始执行监控程序
2019-05-28 04:48:42 获取的v2ray服务器subid为 
2019-05-28 04:48:42 获取的v2ray服务器DCID为 
2019-05-28 04:48:42 获取的v2ray服务器label为
2019-05-28 04:48:43 获取v2ray服务器宽带使用率为  字节
2019-05-28 04:48:43 获取的宽带使用率为 G
2019-05-28 04:48:43 流量小于10G，监控结束！
                                                                              
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                                                              
                                                                              
2019-05-29 04:30:01 检测的网关名为gw
2019-05-29 04:30:03 获取的v2ray服务器IP地址为45.32.42.33
2019-05-29 04:30:03 收集vultr的服务器列表
2019-05-29 04:30:05 gw 调用API成功，开始执行监控程序
2019-05-29 04:30:05 获取的v2ray服务器subid为 25049109
2019-05-29 04:30:05 获取的v2ray服务器DCID为 25
2019-05-29 04:30:05 获取的v2ray服务器label为gmasterw
2019-05-29 04:30:06 获取v2ray服务器宽带使用率为 18372203860 字节
2019-05-29 04:30:06 获取的宽带使用率为17 G
2019-05-29 04:30:06 触发重新搭建服务器条件,同时将keepalived服务停用
2019-05-29 04:30:06 正在停用keepalived服务
10.24.1.254 | CHANGED | rc=0 >>

2019-05-29 04:30:07 gw 的keepalived服务停用成功
2019-05-29 04:30:07 正在销毁v2ray服务器
2019-05-29 04:30:09 等待删除gmasterw
2019-05-29 04:30:39 删除gmasterw 成功
2019-05-29 04:30:39 获取gw 使用的v2ray服务器的label	gmasterw
2019-05-29 04:30:39 重新安装v2ray服务器
2019-05-29 04:30:41 installing server......
2019-05-29 04:30:41 正在安装的v2ray服务器的subid为25061686
2019-05-29 04:31:02 新建的v2ray服务器IP地址为45.32.42.33
2019-05-29 04:31:04 getting pwd......
2019-05-29 04:31:25 获取的v2ray服务器的密码为Ww4}T7AtBrRgzbao
2019-05-29 04:31:25 sleep 60
2019-05-29 04:32:26 检查v2ray服务器ip地址存在！
2019-05-29 04:32:26 ------------------------
2019-05-29 04:32:26 清理本地已经存在45.32.42.33 的密钥
# Host 45.32.42.33 found: line 18
/root/.ssh/known_hosts updated.
Original contents retained as /root/.ssh/known_hosts.old
2019-05-29 04:32:26 重新添加45.32.42.33 的密钥，正在添加密钥！
2019-05-29 04:32:26 v2ray_server安装ssh密钥
2019-05-29 04:32:31 ------------
2019-05-29 04:32:31 正在配置ansible主控端
2019-05-29 04:32:31 gmasterw 已存在
2019-05-29 04:32:31 主控端配置完毕！
2019-05-29 04:32:31 ------------
2019-05-29 04:32:31 测试ansible被控端
45.32.42.33 | SUCCESS => {
    "changed": false, 
    "ping": "pong"
}
2019-05-29 04:32:40 主控端配置成功！
2019-05-29 04:32:40 -------------------
2019-05-29 04:32:40 开始安装v2ray服务端,并且进行配置，使用ansible的script模块拷贝配置文件
45.32.42.33 | CHANGED => {
    "changed": true, 
    "rc": 0, 
    "stderr": "Shared connection to 45.32.42.33 closed.\r\n", 
    "stderr_lines": [
        "Shared connection to 45.32.42.33 closed."
    ], 
    "stdout": "安装v2ray服务端\r\nbash <(curl -L -s https://install.direct/go.sh)\r\n\u001b[36mInstalling V2Ray v4.18.2 on x86_64\u001b[0m\r\n\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.2/v2ray-linux-64.zip\u001b[0m\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r100   608    0   608    0     0   2336      0 --:--:-- --:--:-- --:--:--  2338\r\n\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r  4 11.2M    4  560k    0     0   313k      0  0:00:36  0:00:01  0:00:35  551k\r100 11.2M  100 11.2M    0     0  4376k      0  0:00:02  0:00:02 --:--:-- 6191k\r\n\u001b[36mUpdating software repo\u001b[0m\r\n\u001b[36mInstalling unzip\u001b[0m\r\ndebconf: unable to initialize frontend: Dialog\r\ndebconf: (TERM is not set, so the dialog frontend is not usable.)\r\ndebconf: falling back to frontend: Readline\r\ndebconf: unable to initialize frontend: Readline\r\ndebconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)\r\ndebconf: falling back to frontend: Teletype\r\nSelecting previously unselected package unzip.\r\n(Reading database ... \r(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r(Reading database ... 70%\r(Reading database ... 75%\r(Reading database ... 80%\r(Reading database ... 85%\r(Reading database ... 90%\r(Reading database ... 95%\r(Reading database ... 100%\r(Reading database ... 21827 files and directories currently installed.)\r\nPreparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...\r\nUnpacking unzip (6.0-16+deb8u3) ...\r\nProcessing triggers for mime-support (3.58) ...\r\nProcessing triggers for man-db (2.7.0.2-5) ...\r\nSetting up unzip (6.0-16+deb8u3) ...\r\n\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m\r\nArchive:  /tmp/v2ray/v2ray.zip\r\n  inflating: /tmp/v2ray/config.json  \r\n   creating: /tmp/v2ray/doc/\r\n  inflating: /tmp/v2ray/doc/readme.md  \r\n  inflating: /tmp/v2ray/geoip.dat    \r\n  inflating: /tmp/v2ray/geosite.dat  \r\n   creating: /tmp/v2ray/systemd/\r\n  inflating: /tmp/v2ray/systemd/v2ray.service  \r\n   creating: /tmp/v2ray/systemv/\r\n  inflating: /tmp/v2ray/systemv/v2ray  \r\n  inflating: /tmp/v2ray/v2ctl        \r\n extracting: /tmp/v2ray/v2ctl.sig    \r\n  inflating: /tmp/v2ray/v2ray        \r\n extracting: /tmp/v2ray/v2ray.sig    \r\n  inflating: /tmp/v2ray/vpoint_socks_vmess.json  \r\n  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  \r\n\u001b[36mShutting down V2Ray service.\u001b[0m\r\nFailed to stop v2ray.service: Unit v2ray.service not loaded.\r\n\u001b[33mFailed to shutdown V2Ray service.\u001b[0m\r\n\u001b[36mPORT:34892\u001b[0m\r\n\u001b[36mUUID:a239135d-63a3-4742-b064-e07191cb3c7d\u001b[0m\r\nCreated symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.\r\n\u001b[36mRestarting V2Ray service.\u001b[0m\r\n\u001b[32mV2Ray v4.18.2 is installed.\u001b[0m\r\nv2ray服务端安装成功\r\ncp /etc/v2ray/config.json /root/\r\nconfig文件备份成功\r\n", 
    "stdout_lines": [
        "安装v2ray服务端", 
        "bash <(curl -L -s https://install.direct/go.sh)", 
        "\u001b[36mInstalling V2Ray v4.18.2 on x86_64\u001b[0m", 
        "\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.2/v2ray-linux-64.zip\u001b[0m", 
        "  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current", 
        "                                 Dload  Upload   Total   Spent    Left  Speed", 
        "", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "100   608    0   608    0     0   2336      0 --:--:-- --:--:-- --:--:--  2338", 
        "", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "  4 11.2M    4  560k    0     0   313k      0  0:00:36  0:00:01  0:00:35  551k", 
        "100 11.2M  100 11.2M    0     0  4376k      0  0:00:02  0:00:02 --:--:-- 6191k", 
        "\u001b[36mUpdating software repo\u001b[0m", 
        "\u001b[36mInstalling unzip\u001b[0m", 
        "debconf: unable to initialize frontend: Dialog", 
        "debconf: (TERM is not set, so the dialog frontend is not usable.)", 
        "debconf: falling back to frontend: Readline", 
        "debconf: unable to initialize frontend: Readline", 
        "debconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)", 
        "debconf: falling back to frontend: Teletype", 
        "Selecting previously unselected package unzip.", 
        "(Reading database ... ", 
        "(Reading database ... 5%", 
        "(Reading database ... 10%", 
        "(Reading database ... 15%", 
        "(Reading database ... 20%", 
        "(Reading database ... 25%", 
        "(Reading database ... 30%", 
        "(Reading database ... 35%", 
        "(Reading database ... 40%", 
        "(Reading database ... 45%", 
        "(Reading database ... 50%", 
        "(Reading database ... 55%", 
        "(Reading database ... 60%", 
        "(Reading database ... 65%", 
        "(Reading database ... 70%", 
        "(Reading database ... 75%", 
        "(Reading database ... 80%", 
        "(Reading database ... 85%", 
        "(Reading database ... 90%", 
        "(Reading database ... 95%", 
        "(Reading database ... 100%", 
        "(Reading database ... 21827 files and directories currently installed.)", 
        "Preparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...", 
        "Unpacking unzip (6.0-16+deb8u3) ...", 
        "Processing triggers for mime-support (3.58) ...", 
        "Processing triggers for man-db (2.7.0.2-5) ...", 
        "Setting up unzip (6.0-16+deb8u3) ...", 
        "\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m", 
        "Archive:  /tmp/v2ray/v2ray.zip", 
        "  inflating: /tmp/v2ray/config.json  ", 
        "   creating: /tmp/v2ray/doc/", 
        "  inflating: /tmp/v2ray/doc/readme.md  ", 
        "  inflating: /tmp/v2ray/geoip.dat    ", 
        "  inflating: /tmp/v2ray/geosite.dat  ", 
        "   creating: /tmp/v2ray/systemd/", 
        "  inflating: /tmp/v2ray/systemd/v2ray.service  ", 
        "   creating: /tmp/v2ray/systemv/", 
        "  inflating: /tmp/v2ray/systemv/v2ray  ", 
        "  inflating: /tmp/v2ray/v2ctl        ", 
        " extracting: /tmp/v2ray/v2ctl.sig    ", 
        "  inflating: /tmp/v2ray/v2ray        ", 
        " extracting: /tmp/v2ray/v2ray.sig    ", 
        "  inflating: /tmp/v2ray/vpoint_socks_vmess.json  ", 
        "  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  ", 
        "\u001b[36mShutting down V2Ray service.\u001b[0m", 
        "Failed to stop v2ray.service: Unit v2ray.service not loaded.", 
        "\u001b[33mFailed to shutdown V2Ray service.\u001b[0m", 
        "\u001b[36mPORT:34892\u001b[0m", 
        "\u001b[36mUUID:a239135d-63a3-4742-b064-e07191cb3c7d\u001b[0m", 
        "Created symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.", 
        "\u001b[36mRestarting V2Ray service.\u001b[0m", 
        "\u001b[32mV2Ray v4.18.2 is installed.\u001b[0m", 
        "v2ray服务端安装成功", 
        "cp /etc/v2ray/config.json /root/", 
        "config文件备份成功"
    ]
}
45.32.42.33 | CHANGED => {
    "changed": true, 
    "checksum": "642c4f754bbfa22a465305bf9f28f0be6b8d51d3", 
    "dest": "/etc/v2ray/config.json", 
    "gid": 0, 
    "group": "root", 
    "md5sum": "e1c9ae8913976ca140c692152b5ade95", 
    "mode": "0644", 
    "owner": "root", 
    "size": 1448, 
    "src": "/root/.ansible/tmp/ansible-tmp-1559075576.27-169020480780298/source", 
    "state": "file", 
    "uid": 0
}
2019-05-29 04:33:03 v2ray服务端安装完毕！
2019-05-29 04:33:03 获取v2ray服务器的IP\PORT\ID
45.32.42.33 | CHANGED | rc=0 >>
{
  "inbounds": [{
    "port": 34892,
    "protocol": "vmess",
    "settings": {
      "clients": [
        {
          "id": "a239135d-63a3-4742-b064-e07191cb3c7d",
          "level": 1,
          "alterId": 64
        }
      ]
    }
  }],
  "outbounds": [{
    "protocol": "freedom",
    "settings": {}
  },{
    "protocol": "blackhole",
    "settings": {},
    "tag": "blocked"
  }],
  "routing": {
    "rules": [
      {
        "type": "field",
        "ip": ["geoip:private"],
        "outboundTag": "blocked"
      }
    ]
  }
}
45.32.42.33 | CHANGED | rc=0 >>
{
  "log" : {
    "access": "/var/log/v2ray/access.log",
    "error": "/var/log/v2ray/error.log",
    "loglevel": "warning"
  },
  "inbound": {
    "port": 31139,
    "protocol": "vmess", 
    "settings": {
      "clients": [
        {
          "id": "805ed8a8-7967-49c0-9f5d-057e86920c49",
          "level": 1,
          "alterId": 64
        }
      ],
      "detour":{
        "to":"dynamicPort"
      }
    },
    "streamSettings":{
      "network":"kcp"
    }
  },
  "inboundDetour":[
    {
      "protocol": "vmess",
      "port": "10000-20000",
      "tag": "dynamicPort",       
      "settings": {
        "default": {
          "level": 1,
          "alterId": 32
        }
      },
      "allocate": {            
        "strategy": "random",  
        "concurrency": 2,      
        "refresh": 3           
      },
      "streamSettings": {
        "network": "kcp"
      }
    }
  ],
  "outbound": {
    "protocol": "freedom",
    "settings": {}
  },
  "outboundDetour": [
    {
      "protocol": "blackhole",
      "settings": {},
      "tag": "blocked"
    }
  ],
 "transport":{
      "tcpSettings":{
         "connectionReuse":true
      },
      "kcpSettings":{ 
         "mtu":1350,
         "tti":20,
         "uplinkCapacity":100,
         "downlinkCapacity":100,
         "congestion":false,
         "readBufferSize":5,
         "writeBufferSize":5,
         "header":{
            "type":"utp"
         }
      }
   }
}
2019-05-29 04:33:20 45.32.42.33     "port": 34892,           "id": "a239135d-63a3-4742-b064-e07191cb3c7d",
2019-05-29 04:33:20 正在修改-----------------
45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

2019-05-29 04:33:33 修改完毕，v2ray服务端配置成功!重启v2ray服务器
45.32.42.33 | CHANGED | rc=0 >>

2019-05-29 04:33:37 v2ray服务重启成功！
2019-05-29 04:33:37 -------------------
2019-05-29 04:34:37 更新局域网的网关服务
2019-05-29 04:34:37 正在验证gw 分组是否存在,请稍后...
2019-05-29 04:34:39 验证成功gw分组存在！分组名为gw
2019-05-29 04:35:39 正在验证gmasterw 分组是否存在,请稍后...
2019-05-29 04:35:45 验证成功gmasterw 分组存在！分组名为gmasterw
2019-05-29 04:35:48 v2ray_server的IP是45.32.42.33
2019-05-29 04:35:51     "port": 34892,
2019-05-29 04:35:55           "id": "a239135d-63a3-4742-b064-e07191cb3c7d",
2019-05-29 04:35:55 下一步需要修改gw 组的配置文件，现在正在形成参数
2019-05-29 04:35:55 修改gw的配置文件/etc/v2ray/config.json,/opt/v2ray-firewall
2019-05-29 04:35:55 1.拼接ip地址
2019-05-29 04:35:55 "address":"45.32.42.33",
2019-05-29 04:35:55 2.拼接端口号
2019-05-29 04:35:55 "port": 34892,
2019-05-29 04:35:55 3.拼接id
2019-05-29 04:35:55 "id": "a239135d-63a3-4742-b064-e07191cb3c7d",
2019-05-29 04:35:55 执行修改局域网GW的配置文件
2019-05-29 04:35:55 配置ip地址
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-29 04:35:57 配置端口
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-29 04:35:59 配置id
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-29 04:36:00 配置防火墙
2019-05-29 04:36:00 1.拼接防火墙
2019-05-29 04:36:00 iptables -t nat -A V2RAY -d 45.32.42.33 -j RETURN
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-29 04:36:01 重启gw的v2ray服务
10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-29 04:36:05 服务重启成功！
2019-05-29 04:36:05 配置完毕！
                                                                              
2019-05-29 04:36:05 检测的网关名为ggww
2019-05-29 04:36:07 获取的v2ray服务器IP地址为45.76.219.250
2019-05-29 04:36:07 收集vultr的服务器列表
2019-05-29 04:36:08 ggww 调用API成功，开始执行监控程序
2019-05-29 04:36:08 获取的v2ray服务器subid为 25037841
2019-05-29 04:36:08 获取的v2ray服务器DCID为 25
2019-05-29 04:36:08 获取的v2ray服务器label为gslavew
2019-05-29 04:36:09 获取v2ray服务器宽带使用率为 8696880593 字节
2019-05-29 04:36:09 获取的宽带使用率为8 G
2019-05-29 04:36:09 流量小于10G，监控结束！
                                                                              
2019-05-29 04:36:09 检测的网关名为dns
2019-05-29 04:36:11 获取的v2ray服务器IP地址为108.160.133.156
2019-05-29 04:36:11 收集vultr的服务器列表
2019-05-29 04:36:13 dns 调用API成功，开始执行监控程序
2019-05-29 04:36:13 获取的v2ray服务器subid为 25021030
2019-05-29 04:36:13 获取的v2ray服务器DCID为 25
2019-05-29 04:36:13 获取的v2ray服务器label为ddnnss
2019-05-29 04:36:14 获取v2ray服务器宽带使用率为 93415615 字节
2019-05-29 04:36:14 获取的宽带使用率为0 G
2019-05-29 04:36:14 流量小于10G，监控结束！
                                                                              
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                                                              
                                                                              
2019-05-30 04:30:01 检测的网关名为gw
2019-05-30 04:30:03 获取的v2ray服务器IP地址为45.32.42.33
2019-05-30 04:30:03 收集vultr的服务器列表
2019-05-30 04:30:04 gw 调用API成功，开始执行监控程序
2019-05-30 04:30:04 获取的v2ray服务器subid为 25075646
2019-05-30 04:30:04 获取的v2ray服务器DCID为 25
2019-05-30 04:30:04 获取的v2ray服务器label为gmasterw
2019-05-30 04:30:06 获取v2ray服务器宽带使用率为 51815318881 字节
2019-05-30 04:30:06 获取的宽带使用率为48 G
2019-05-30 04:30:06 触发重新搭建服务器条件,同时将keepalived服务停用
2019-05-30 04:30:06 正在停用keepalived服务
10.24.1.254 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

2019-05-30 04:30:08 gw 的keepalived服务停用成功
2019-05-30 04:30:08 正在销毁v2ray服务器
2019-05-30 04:30:09 等待删除gmasterw
2019-05-30 04:30:39 删除gmasterw 成功
2019-05-30 04:30:39 获取gw 使用的v2ray服务器的label	gmasterw
2019-05-30 04:30:39 重新安装v2ray服务器
2019-05-30 04:30:41 installing server......
2019-05-30 04:30:41 正在安装的v2ray服务器的subid为25085371
2019-05-30 04:31:03 新建的v2ray服务器IP地址为45.32.42.33
2019-05-30 04:31:04 getting pwd......
2019-05-30 04:31:25 获取的v2ray服务器的密码为.U7f=TNn*N?}#V-X
2019-05-30 04:31:25 sleep 60
2019-05-30 04:32:26 检查v2ray服务器ip地址存在！
2019-05-30 04:32:26 ------------------------
2019-05-30 04:32:26 清理本地已经存在45.32.42.33 的密钥
# Host 45.32.42.33 found: line 18
/root/.ssh/known_hosts updated.
Original contents retained as /root/.ssh/known_hosts.old
2019-05-30 04:32:26 重新添加45.32.42.33 的密钥，正在添加密钥！
2019-05-30 04:32:27 v2ray_server安装ssh密钥
2019-05-30 04:32:29 ------------
2019-05-30 04:32:29 正在配置ansible主控端
2019-05-30 04:32:29 gmasterw 已存在
2019-05-30 04:32:29 主控端配置完毕！
2019-05-30 04:32:29 ------------
2019-05-30 04:32:29 测试ansible被控端
45.32.42.33 | SUCCESS => {
    "changed": false, 
    "ping": "pong"
}
2019-05-30 04:32:38 主控端配置成功！
2019-05-30 04:32:38 -------------------
2019-05-30 04:32:38 开始安装v2ray服务端,并且进行配置，使用ansible的script模块拷贝配置文件
45.32.42.33 | CHANGED => {
    "changed": true, 
    "rc": 0, 
    "stderr": "Shared connection to 45.32.42.33 closed.\r\n", 
    "stderr_lines": [
        "Shared connection to 45.32.42.33 closed."
    ], 
    "stdout": "安装v2ray服务端\r\nbash <(curl -L -s https://install.direct/go.sh)\r\n\u001b[36mInstalling V2Ray v4.18.2 on x86_64\u001b[0m\r\n\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.2/v2ray-linux-64.zip\u001b[0m\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r100   608    0   608    0     0   1877      0 --:--:-- --:--:-- --:--:--  1876\r\n\r  0 11.2M    0 50738    0     0  35750      0  0:05:30  0:00:01  0:05:29 35750\r 18 11.2M   18 2137k    0     0   922k      0  0:00:12  0:00:02  0:00:10 2325k\r100 11.2M  100 11.2M    0     0  4027k      0  0:00:02  0:00:02 --:--:-- 7954k\r\n\u001b[36mUpdating software repo\u001b[0m\r\n\u001b[36mInstalling unzip\u001b[0m\r\ndebconf: unable to initialize frontend: Dialog\r\ndebconf: (TERM is not set, so the dialog frontend is not usable.)\r\ndebconf: falling back to frontend: Readline\r\ndebconf: unable to initialize frontend: Readline\r\ndebconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)\r\ndebconf: falling back to frontend: Teletype\r\nSelecting previously unselected package unzip.\r\n(Reading database ... \r(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r(Reading database ... 70%\r(Reading database ... 75%\r(Reading database ... 80%\r(Reading database ... 85%\r(Reading database ... 90%\r(Reading database ... 95%\r(Reading database ... 100%\r(Reading database ... 21827 files and directories currently installed.)\r\nPreparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...\r\nUnpacking unzip (6.0-16+deb8u3) ...\r\nProcessing triggers for mime-support (3.58) ...\r\nProcessing triggers for man-db (2.7.0.2-5) ...\r\nSetting up unzip (6.0-16+deb8u3) ...\r\n\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m\r\nArchive:  /tmp/v2ray/v2ray.zip\r\n  inflating: /tmp/v2ray/config.json  \r\n   creating: /tmp/v2ray/doc/\r\n  inflating: /tmp/v2ray/doc/readme.md  \r\n  inflating: /tmp/v2ray/geoip.dat    \r\n  inflating: /tmp/v2ray/geosite.dat  \r\n   creating: /tmp/v2ray/systemd/\r\n  inflating: /tmp/v2ray/systemd/v2ray.service  \r\n   creating: /tmp/v2ray/systemv/\r\n  inflating: /tmp/v2ray/systemv/v2ray  \r\n  inflating: /tmp/v2ray/v2ctl        \r\n extracting: /tmp/v2ray/v2ctl.sig    \r\n  inflating: /tmp/v2ray/v2ray        \r\n extracting: /tmp/v2ray/v2ray.sig    \r\n  inflating: /tmp/v2ray/vpoint_socks_vmess.json  \r\n  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  \r\n\u001b[36mShutting down V2Ray service.\u001b[0m\r\nFailed to stop v2ray.service: Unit v2ray.service not loaded.\r\n\u001b[33mFailed to shutdown V2Ray service.\u001b[0m\r\n\u001b[36mPORT:14097\u001b[0m\r\n\u001b[36mUUID:c971b268-7c44-4ec2-8001-84e433c4da8a\u001b[0m\r\nCreated symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.\r\n\u001b[36mRestarting V2Ray service.\u001b[0m\r\n\u001b[32mV2Ray v4.18.2 is installed.\u001b[0m\r\nv2ray服务端安装成功\r\ncp /etc/v2ray/config.json /root/\r\nconfig文件备份成功\r\n", 
    "stdout_lines": [
        "安装v2ray服务端", 
        "bash <(curl -L -s https://install.direct/go.sh)", 
        "\u001b[36mInstalling V2Ray v4.18.2 on x86_64\u001b[0m", 
        "\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.2/v2ray-linux-64.zip\u001b[0m", 
        "  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current", 
        "                                 Dload  Upload   Total   Spent    Left  Speed", 
        "", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "100   608    0   608    0     0   1877      0 --:--:-- --:--:-- --:--:--  1876", 
        "", 
        "  0 11.2M    0 50738    0     0  35750      0  0:05:30  0:00:01  0:05:29 35750", 
        " 18 11.2M   18 2137k    0     0   922k      0  0:00:12  0:00:02  0:00:10 2325k", 
        "100 11.2M  100 11.2M    0     0  4027k      0  0:00:02  0:00:02 --:--:-- 7954k", 
        "\u001b[36mUpdating software repo\u001b[0m", 
        "\u001b[36mInstalling unzip\u001b[0m", 
        "debconf: unable to initialize frontend: Dialog", 
        "debconf: (TERM is not set, so the dialog frontend is not usable.)", 
        "debconf: falling back to frontend: Readline", 
        "debconf: unable to initialize frontend: Readline", 
        "debconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)", 
        "debconf: falling back to frontend: Teletype", 
        "Selecting previously unselected package unzip.", 
        "(Reading database ... ", 
        "(Reading database ... 5%", 
        "(Reading database ... 10%", 
        "(Reading database ... 15%", 
        "(Reading database ... 20%", 
        "(Reading database ... 25%", 
        "(Reading database ... 30%", 
        "(Reading database ... 35%", 
        "(Reading database ... 40%", 
        "(Reading database ... 45%", 
        "(Reading database ... 50%", 
        "(Reading database ... 55%", 
        "(Reading database ... 60%", 
        "(Reading database ... 65%", 
        "(Reading database ... 70%", 
        "(Reading database ... 75%", 
        "(Reading database ... 80%", 
        "(Reading database ... 85%", 
        "(Reading database ... 90%", 
        "(Reading database ... 95%", 
        "(Reading database ... 100%", 
        "(Reading database ... 21827 files and directories currently installed.)", 
        "Preparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...", 
        "Unpacking unzip (6.0-16+deb8u3) ...", 
        "Processing triggers for mime-support (3.58) ...", 
        "Processing triggers for man-db (2.7.0.2-5) ...", 
        "Setting up unzip (6.0-16+deb8u3) ...", 
        "\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m", 
        "Archive:  /tmp/v2ray/v2ray.zip", 
        "  inflating: /tmp/v2ray/config.json  ", 
        "   creating: /tmp/v2ray/doc/", 
        "  inflating: /tmp/v2ray/doc/readme.md  ", 
        "  inflating: /tmp/v2ray/geoip.dat    ", 
        "  inflating: /tmp/v2ray/geosite.dat  ", 
        "   creating: /tmp/v2ray/systemd/", 
        "  inflating: /tmp/v2ray/systemd/v2ray.service  ", 
        "   creating: /tmp/v2ray/systemv/", 
        "  inflating: /tmp/v2ray/systemv/v2ray  ", 
        "  inflating: /tmp/v2ray/v2ctl        ", 
        " extracting: /tmp/v2ray/v2ctl.sig    ", 
        "  inflating: /tmp/v2ray/v2ray        ", 
        " extracting: /tmp/v2ray/v2ray.sig    ", 
        "  inflating: /tmp/v2ray/vpoint_socks_vmess.json  ", 
        "  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  ", 
        "\u001b[36mShutting down V2Ray service.\u001b[0m", 
        "Failed to stop v2ray.service: Unit v2ray.service not loaded.", 
        "\u001b[33mFailed to shutdown V2Ray service.\u001b[0m", 
        "\u001b[36mPORT:14097\u001b[0m", 
        "\u001b[36mUUID:c971b268-7c44-4ec2-8001-84e433c4da8a\u001b[0m", 
        "Created symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.", 
        "\u001b[36mRestarting V2Ray service.\u001b[0m", 
        "\u001b[32mV2Ray v4.18.2 is installed.\u001b[0m", 
        "v2ray服务端安装成功", 
        "cp /etc/v2ray/config.json /root/", 
        "config文件备份成功"
    ]
}
45.32.42.33 | CHANGED => {
    "changed": true, 
    "checksum": "642c4f754bbfa22a465305bf9f28f0be6b8d51d3", 
    "dest": "/etc/v2ray/config.json", 
    "gid": 0, 
    "group": "root", 
    "md5sum": "e1c9ae8913976ca140c692152b5ade95", 
    "mode": "0644", 
    "owner": "root", 
    "size": 1448, 
    "src": "/root/.ansible/tmp/ansible-tmp-1559161978.77-172983913790393/source", 
    "state": "file", 
    "uid": 0
}
2019-05-30 04:33:05 v2ray服务端安装完毕！
2019-05-30 04:33:05 获取v2ray服务器的IP\PORT\ID
45.32.42.33 | CHANGED | rc=0 >>
{
  "inbounds": [{
    "port": 14097,
    "protocol": "vmess",
    "settings": {
      "clients": [
        {
          "id": "c971b268-7c44-4ec2-8001-84e433c4da8a",
          "level": 1,
          "alterId": 64
        }
      ]
    }
  }],
  "outbounds": [{
    "protocol": "freedom",
    "settings": {}
  },{
    "protocol": "blackhole",
    "settings": {},
    "tag": "blocked"
  }],
  "routing": {
    "rules": [
      {
        "type": "field",
        "ip": ["geoip:private"],
        "outboundTag": "blocked"
      }
    ]
  }
}
45.32.42.33 | CHANGED | rc=0 >>
{
  "log" : {
    "access": "/var/log/v2ray/access.log",
    "error": "/var/log/v2ray/error.log",
    "loglevel": "warning"
  },
  "inbound": {
    "port": 31139,
    "protocol": "vmess", 
    "settings": {
      "clients": [
        {
          "id": "805ed8a8-7967-49c0-9f5d-057e86920c49",
          "level": 1,
          "alterId": 64
        }
      ],
      "detour":{
        "to":"dynamicPort"
      }
    },
    "streamSettings":{
      "network":"kcp"
    }
  },
  "inboundDetour":[
    {
      "protocol": "vmess",
      "port": "10000-20000",
      "tag": "dynamicPort",       
      "settings": {
        "default": {
          "level": 1,
          "alterId": 32
        }
      },
      "allocate": {            
        "strategy": "random",  
        "concurrency": 2,      
        "refresh": 3           
      },
      "streamSettings": {
        "network": "kcp"
      }
    }
  ],
  "outbound": {
    "protocol": "freedom",
    "settings": {}
  },
  "outboundDetour": [
    {
      "protocol": "blackhole",
      "settings": {},
      "tag": "blocked"
    }
  ],
 "transport":{
      "tcpSettings":{
         "connectionReuse":true
      },
      "kcpSettings":{ 
         "mtu":1350,
         "tti":20,
         "uplinkCapacity":100,
         "downlinkCapacity":100,
         "congestion":false,
         "readBufferSize":5,
         "writeBufferSize":5,
         "header":{
            "type":"utp"
         }
      }
   }
}
2019-05-30 04:33:22 45.32.42.33     "port": 14097,           "id": "c971b268-7c44-4ec2-8001-84e433c4da8a",
2019-05-30 04:33:22 正在修改-----------------
45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

2019-05-30 04:33:36 修改完毕，v2ray服务端配置成功!重启v2ray服务器
45.32.42.33 | CHANGED | rc=0 >>

2019-05-30 04:33:39 v2ray服务重启成功！
2019-05-30 04:33:39 -------------------
2019-05-30 04:34:39 更新局域网的网关服务
2019-05-30 04:34:39 正在验证gw 分组是否存在,请稍后...
2019-05-30 04:34:41 验证成功gw分组存在！分组名为gw
2019-05-30 04:35:41 正在验证gmasterw 分组是否存在,请稍后...
2019-05-30 04:35:47 验证成功gmasterw 分组存在！分组名为gmasterw
2019-05-30 04:35:51 v2ray_server的IP是45.32.42.33
2019-05-30 04:35:54     "port": 14097,
2019-05-30 04:35:57           "id": "c971b268-7c44-4ec2-8001-84e433c4da8a",
2019-05-30 04:35:57 下一步需要修改gw 组的配置文件，现在正在形成参数
2019-05-30 04:35:57 修改gw的配置文件/etc/v2ray/config.json,/opt/v2ray-firewall
2019-05-30 04:35:57 1.拼接ip地址
2019-05-30 04:35:57 "address":"45.32.42.33",
2019-05-30 04:35:57 2.拼接端口号
2019-05-30 04:35:57 "port": 14097,
2019-05-30 04:35:57 3.拼接id
2019-05-30 04:35:57 "id": "c971b268-7c44-4ec2-8001-84e433c4da8a",
2019-05-30 04:35:57 执行修改局域网GW的配置文件
2019-05-30 04:35:57 配置ip地址
10.24.1.254 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

2019-05-30 04:36:00 配置端口
10.24.1.254 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

2019-05-30 04:36:02 配置id
10.24.1.254 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

2019-05-30 04:36:03 配置防火墙
2019-05-30 04:36:03 1.拼接防火墙
2019-05-30 04:36:03 iptables -t nat -A V2RAY -d 45.32.42.33 -j RETURN
10.24.1.254 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

2019-05-30 04:36:04 重启gw的v2ray服务
10.24.1.254 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

2019-05-30 04:36:09 服务重启成功！
2019-05-30 04:36:09 配置完毕！
                                                                              
2019-05-30 04:36:09 检测的网关名为ggww
2019-05-30 04:36:11 获取的v2ray服务器IP地址为45.76.219.250
2019-05-30 04:36:11 收集vultr的服务器列表
2019-05-30 04:36:18 ggww 调用API成功，开始执行监控程序
2019-05-30 04:36:18 获取的v2ray服务器subid为 25037841
2019-05-30 04:36:18 获取的v2ray服务器DCID为 25
2019-05-30 04:36:18 获取的v2ray服务器label为gslavew
2019-05-30 04:36:19 获取v2ray服务器宽带使用率为 29339387286 字节
2019-05-30 04:36:19 获取的宽带使用率为27 G
2019-05-30 04:36:19 触发重新搭建服务器条件,同时将keepalived服务停用
2019-05-30 04:36:19 正在停用keepalived服务
10.24.1.253 | CHANGED | rc=0 >>

192.168.1.251 | CHANGED | rc=0 >>

2019-05-30 04:36:21 ggww 的keepalived服务停用成功
2019-05-30 04:36:21 正在销毁v2ray服务器
2019-05-30 04:36:22 等待删除gslavew
2019-05-30 04:36:52 删除gslavew 成功
2019-05-30 04:36:52 获取ggww 使用的v2ray服务器的label	gslavew
2019-05-30 04:36:52 重新安装v2ray服务器
2019-05-30 04:36:54 installing server......
2019-05-30 04:36:54 正在安装的v2ray服务器的subid为25085435
2019-05-30 04:37:16 新建的v2ray服务器IP地址为45.76.219.250
2019-05-30 04:37:17 getting pwd......
2019-05-30 04:37:38 获取的v2ray服务器的密码为dY5$Y{])q=2y!BgG
2019-05-30 04:37:38 sleep 60
2019-05-30 04:38:41 连接超时，重新安装服务器
2019-05-30 04:40:18 连接超时，重新安装服务器
重试2次无效，退出
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                                                              
                                                                              
2019-05-31 04:30:01 检测的网关名为gw
2019-05-31 04:30:03 获取的v2ray服务器IP地址为45.32.42.33
2019-05-31 04:30:03 收集vultr的服务器列表
2019-05-31 04:30:05 gw 调用API成功，开始执行监控程序
2019-05-31 04:30:05 获取的v2ray服务器subid为 25099522
2019-05-31 04:30:05 获取的v2ray服务器DCID为 25
2019-05-31 04:30:05 获取的v2ray服务器label为gmasterw
2019-05-31 04:30:06 获取v2ray服务器宽带使用率为 22578129800 字节
2019-05-31 04:30:06 获取的宽带使用率为21 G
2019-05-31 04:30:06 触发重新搭建服务器条件,同时将keepalived服务停用
2019-05-31 04:30:06 正在停用keepalived服务
10.24.1.254 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

2019-05-31 04:30:08 gw 的keepalived服务停用成功
2019-05-31 04:30:08 正在销毁v2ray服务器
2019-05-31 04:30:09 等待删除gmasterw
2019-05-31 04:30:39 删除gmasterw 成功
2019-05-31 04:30:39 获取gw 使用的v2ray服务器的label	gmasterw
2019-05-31 04:30:39 重新安装v2ray服务器
2019-05-31 04:30:41 installing server......
2019-05-31 04:30:41 正在安装的v2ray服务器的subid为25109750
2019-05-31 04:31:03 新建的v2ray服务器IP地址为45.32.42.33
2019-05-31 04:31:04 getting pwd......
2019-05-31 04:31:25 获取的v2ray服务器的密码为f,8A#H@S{pBpQ6$F
2019-05-31 04:31:25 sleep 60
2019-05-31 04:32:26 检查v2ray服务器ip地址存在！
2019-05-31 04:32:26 ------------------------
2019-05-31 04:32:26 清理本地已经存在45.32.42.33 的密钥
# Host 45.32.42.33 found: line 18
/root/.ssh/known_hosts updated.
Original contents retained as /root/.ssh/known_hosts.old
2019-05-31 04:32:26 重新添加45.32.42.33 的密钥，正在添加密钥！
2019-05-31 04:32:27 v2ray_server安装ssh密钥
2019-05-31 04:32:31 ------------
2019-05-31 04:32:31 正在配置ansible主控端
2019-05-31 04:32:31 gmasterw 已存在
2019-05-31 04:32:31 主控端配置完毕！
2019-05-31 04:32:31 ------------
2019-05-31 04:32:31 测试ansible被控端
45.32.42.33 | SUCCESS => {
    "changed": false, 
    "ping": "pong"
}
2019-05-31 04:32:41 主控端配置成功！
2019-05-31 04:32:41 -------------------
2019-05-31 04:32:41 开始安装v2ray服务端,并且进行配置，使用ansible的script模块拷贝配置文件
45.32.42.33 | CHANGED => {
    "changed": true, 
    "rc": 0, 
    "stderr": "Shared connection to 45.32.42.33 closed.\r\n", 
    "stderr_lines": [
        "Shared connection to 45.32.42.33 closed."
    ], 
    "stdout": "安装v2ray服务端\r\nbash <(curl -L -s https://install.direct/go.sh)\r\n\u001b[36mInstalling V2Ray v4.18.2 on x86_64\u001b[0m\r\n\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.2/v2ray-linux-64.zip\u001b[0m\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r100   608    0   608    0     0   1842      0 --:--:-- --:--:-- --:--:--  1848\r\n\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r  0 11.2M    0 51786    0     0  35678      0  0:05:30  0:00:01  0:05:29 55208\r 20 11.2M   20 2367k    0     0  1012k      0  0:00:11  0:00:02  0:00:09 1296k\r 33 11.2M   33 3903k    0     0  1121k      0  0:00:10  0:00:03  0:00:07 1315k\r 56 11.2M   56 6527k    0     0  1493k      0  0:00:07  0:00:04  0:00:03 1692k\r 63 11.2M   63 7359k    0     0  1354k      0  0:00:08  0:00:05  0:00:03 1495k\r 73 11.2M   73 8511k    0     0  1321k      0  0:00:08  0:00:06  0:00:02 1695k\r 82 11.2M   82 9519k    0     0  1288k      0  0:00:08  0:00:07  0:00:01 1416k\r 91 11.2M   91 10.2M    0     0  1242k      0  0:00:09  0:00:08  0:00:01 1327k\r 96 11.2M   96 10.8M    0     0  1188k      0  0:00:09  0:00:09 --:--:--  919k\r100 11.2M  100 11.2M    0     0  1166k      0  0:00:09  0:00:09 --:--:--  937k\r\n\u001b[36mUpdating software repo\u001b[0m\r\n\u001b[36mInstalling unzip\u001b[0m\r\ndebconf: unable to initialize frontend: Dialog\r\ndebconf: (TERM is not set, so the dialog frontend is not usable.)\r\ndebconf: falling back to frontend: Readline\r\ndebconf: unable to initialize frontend: Readline\r\ndebconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)\r\ndebconf: falling back to frontend: Teletype\r\nSelecting previously unselected package unzip.\r\n(Reading database ... \r(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r(Reading database ... 70%\r(Reading database ... 75%\r(Reading database ... 80%\r(Reading database ... 85%\r(Reading database ... 90%\r(Reading database ... 95%\r(Reading database ... 100%\r(Reading database ... 21827 files and directories currently installed.)\r\nPreparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...\r\nUnpacking unzip (6.0-16+deb8u3) ...\r\nProcessing triggers for mime-support (3.58) ...\r\nProcessing triggers for man-db (2.7.0.2-5) ...\r\nSetting up unzip (6.0-16+deb8u3) ...\r\n\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m\r\nArchive:  /tmp/v2ray/v2ray.zip\r\n  inflating: /tmp/v2ray/config.json  \r\n   creating: /tmp/v2ray/doc/\r\n  inflating: /tmp/v2ray/doc/readme.md  \r\n  inflating: /tmp/v2ray/geoip.dat    \r\n  inflating: /tmp/v2ray/geosite.dat  \r\n   creating: /tmp/v2ray/systemd/\r\n  inflating: /tmp/v2ray/systemd/v2ray.service  \r\n   creating: /tmp/v2ray/systemv/\r\n  inflating: /tmp/v2ray/systemv/v2ray  \r\n  inflating: /tmp/v2ray/v2ctl        \r\n extracting: /tmp/v2ray/v2ctl.sig    \r\n  inflating: /tmp/v2ray/v2ray        \r\n extracting: /tmp/v2ray/v2ray.sig    \r\n  inflating: /tmp/v2ray/vpoint_socks_vmess.json  \r\n  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  \r\n\u001b[36mShutting down V2Ray service.\u001b[0m\r\nFailed to stop v2ray.service: Unit v2ray.service not loaded.\r\n\u001b[33mFailed to shutdown V2Ray service.\u001b[0m\r\n\u001b[36mPORT:16493\u001b[0m\r\n\u001b[36mUUID:5c344d85-6f9d-4650-9413-4b92ed185a51\u001b[0m\r\nCreated symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.\r\n\u001b[36mRestarting V2Ray service.\u001b[0m\r\n\u001b[32mV2Ray v4.18.2 is installed.\u001b[0m\r\nv2ray服务端安装成功\r\ncp /etc/v2ray/config.json /root/\r\nconfig文件备份成功\r\n", 
    "stdout_lines": [
        "安装v2ray服务端", 
        "bash <(curl -L -s https://install.direct/go.sh)", 
        "\u001b[36mInstalling V2Ray v4.18.2 on x86_64\u001b[0m", 
        "\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.2/v2ray-linux-64.zip\u001b[0m", 
        "  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current", 
        "                                 Dload  Upload   Total   Spent    Left  Speed", 
        "", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "100   608    0   608    0     0   1842      0 --:--:-- --:--:-- --:--:--  1848", 
        "", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "  0 11.2M    0 51786    0     0  35678      0  0:05:30  0:00:01  0:05:29 55208", 
        " 20 11.2M   20 2367k    0     0  1012k      0  0:00:11  0:00:02  0:00:09 1296k", 
        " 33 11.2M   33 3903k    0     0  1121k      0  0:00:10  0:00:03  0:00:07 1315k", 
        " 56 11.2M   56 6527k    0     0  1493k      0  0:00:07  0:00:04  0:00:03 1692k", 
        " 63 11.2M   63 7359k    0     0  1354k      0  0:00:08  0:00:05  0:00:03 1495k", 
        " 73 11.2M   73 8511k    0     0  1321k      0  0:00:08  0:00:06  0:00:02 1695k", 
        " 82 11.2M   82 9519k    0     0  1288k      0  0:00:08  0:00:07  0:00:01 1416k", 
        " 91 11.2M   91 10.2M    0     0  1242k      0  0:00:09  0:00:08  0:00:01 1327k", 
        " 96 11.2M   96 10.8M    0     0  1188k      0  0:00:09  0:00:09 --:--:--  919k", 
        "100 11.2M  100 11.2M    0     0  1166k      0  0:00:09  0:00:09 --:--:--  937k", 
        "\u001b[36mUpdating software repo\u001b[0m", 
        "\u001b[36mInstalling unzip\u001b[0m", 
        "debconf: unable to initialize frontend: Dialog", 
        "debconf: (TERM is not set, so the dialog frontend is not usable.)", 
        "debconf: falling back to frontend: Readline", 
        "debconf: unable to initialize frontend: Readline", 
        "debconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)", 
        "debconf: falling back to frontend: Teletype", 
        "Selecting previously unselected package unzip.", 
        "(Reading database ... ", 
        "(Reading database ... 5%", 
        "(Reading database ... 10%", 
        "(Reading database ... 15%", 
        "(Reading database ... 20%", 
        "(Reading database ... 25%", 
        "(Reading database ... 30%", 
        "(Reading database ... 35%", 
        "(Reading database ... 40%", 
        "(Reading database ... 45%", 
        "(Reading database ... 50%", 
        "(Reading database ... 55%", 
        "(Reading database ... 60%", 
        "(Reading database ... 65%", 
        "(Reading database ... 70%", 
        "(Reading database ... 75%", 
        "(Reading database ... 80%", 
        "(Reading database ... 85%", 
        "(Reading database ... 90%", 
        "(Reading database ... 95%", 
        "(Reading database ... 100%", 
        "(Reading database ... 21827 files and directories currently installed.)", 
        "Preparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...", 
        "Unpacking unzip (6.0-16+deb8u3) ...", 
        "Processing triggers for mime-support (3.58) ...", 
        "Processing triggers for man-db (2.7.0.2-5) ...", 
        "Setting up unzip (6.0-16+deb8u3) ...", 
        "\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m", 
        "Archive:  /tmp/v2ray/v2ray.zip", 
        "  inflating: /tmp/v2ray/config.json  ", 
        "   creating: /tmp/v2ray/doc/", 
        "  inflating: /tmp/v2ray/doc/readme.md  ", 
        "  inflating: /tmp/v2ray/geoip.dat    ", 
        "  inflating: /tmp/v2ray/geosite.dat  ", 
        "   creating: /tmp/v2ray/systemd/", 
        "  inflating: /tmp/v2ray/systemd/v2ray.service  ", 
        "   creating: /tmp/v2ray/systemv/", 
        "  inflating: /tmp/v2ray/systemv/v2ray  ", 
        "  inflating: /tmp/v2ray/v2ctl        ", 
        " extracting: /tmp/v2ray/v2ctl.sig    ", 
        "  inflating: /tmp/v2ray/v2ray        ", 
        " extracting: /tmp/v2ray/v2ray.sig    ", 
        "  inflating: /tmp/v2ray/vpoint_socks_vmess.json  ", 
        "  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  ", 
        "\u001b[36mShutting down V2Ray service.\u001b[0m", 
        "Failed to stop v2ray.service: Unit v2ray.service not loaded.", 
        "\u001b[33mFailed to shutdown V2Ray service.\u001b[0m", 
        "\u001b[36mPORT:16493\u001b[0m", 
        "\u001b[36mUUID:5c344d85-6f9d-4650-9413-4b92ed185a51\u001b[0m", 
        "Created symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.", 
        "\u001b[36mRestarting V2Ray service.\u001b[0m", 
        "\u001b[32mV2Ray v4.18.2 is installed.\u001b[0m", 
        "v2ray服务端安装成功", 
        "cp /etc/v2ray/config.json /root/", 
        "config文件备份成功"
    ]
}
45.32.42.33 | CHANGED => {
    "changed": true, 
    "checksum": "642c4f754bbfa22a465305bf9f28f0be6b8d51d3", 
    "dest": "/etc/v2ray/config.json", 
    "gid": 0, 
    "group": "root", 
    "md5sum": "e1c9ae8913976ca140c692152b5ade95", 
    "mode": "0644", 
    "owner": "root", 
    "size": 1448, 
    "src": "/root/.ansible/tmp/ansible-tmp-1559248383.94-61523903237538/source", 
    "state": "file", 
    "uid": 0
}
2019-05-31 04:33:11 v2ray服务端安装完毕！
2019-05-31 04:33:11 获取v2ray服务器的IP\PORT\ID
45.32.42.33 | CHANGED | rc=0 >>
{
  "inbounds": [{
    "port": 16493,
    "protocol": "vmess",
    "settings": {
      "clients": [
        {
          "id": "5c344d85-6f9d-4650-9413-4b92ed185a51",
          "level": 1,
          "alterId": 64
        }
      ]
    }
  }],
  "outbounds": [{
    "protocol": "freedom",
    "settings": {}
  },{
    "protocol": "blackhole",
    "settings": {},
    "tag": "blocked"
  }],
  "routing": {
    "rules": [
      {
        "type": "field",
        "ip": ["geoip:private"],
        "outboundTag": "blocked"
      }
    ]
  }
}
45.32.42.33 | CHANGED | rc=0 >>
{
  "log" : {
    "access": "/var/log/v2ray/access.log",
    "error": "/var/log/v2ray/error.log",
    "loglevel": "warning"
  },
  "inbound": {
    "port": 31139,
    "protocol": "vmess", 
    "settings": {
      "clients": [
        {
          "id": "805ed8a8-7967-49c0-9f5d-057e86920c49",
          "level": 1,
          "alterId": 64
        }
      ],
      "detour":{
        "to":"dynamicPort"
      }
    },
    "streamSettings":{
      "network":"kcp"
    }
  },
  "inboundDetour":[
    {
      "protocol": "vmess",
      "port": "10000-20000",
      "tag": "dynamicPort",       
      "settings": {
        "default": {
          "level": 1,
          "alterId": 32
        }
      },
      "allocate": {            
        "strategy": "random",  
        "concurrency": 2,      
        "refresh": 3           
      },
      "streamSettings": {
        "network": "kcp"
      }
    }
  ],
  "outbound": {
    "protocol": "freedom",
    "settings": {}
  },
  "outboundDetour": [
    {
      "protocol": "blackhole",
      "settings": {},
      "tag": "blocked"
    }
  ],
 "transport":{
      "tcpSettings":{
         "connectionReuse":true
      },
      "kcpSettings":{ 
         "mtu":1350,
         "tti":20,
         "uplinkCapacity":100,
         "downlinkCapacity":100,
         "congestion":false,
         "readBufferSize":5,
         "writeBufferSize":5,
         "header":{
            "type":"utp"
         }
      }
   }
}
2019-05-31 04:33:28 45.32.42.33     "port": 16493,           "id": "5c344d85-6f9d-4650-9413-4b92ed185a51",
2019-05-31 04:33:28 正在修改-----------------
45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

45.32.42.33 | CHANGED | rc=0 >>

2019-05-31 04:33:43 修改完毕，v2ray服务端配置成功!重启v2ray服务器
45.32.42.33 | CHANGED | rc=0 >>

2019-05-31 04:33:46 v2ray服务重启成功！
2019-05-31 04:33:46 -------------------
2019-05-31 04:34:46 更新局域网的网关服务
2019-05-31 04:34:46 正在验证gw 分组是否存在,请稍后...
2019-05-31 04:34:48 验证成功gw分组存在！分组名为gw
2019-05-31 04:35:48 正在验证gmasterw 分组是否存在,请稍后...
2019-05-31 04:35:54 验证成功gmasterw 分组存在！分组名为gmasterw
2019-05-31 04:35:57 v2ray_server的IP是45.32.42.33
2019-05-31 04:36:01     "port": 16493,
2019-05-31 04:36:04           "id": "5c344d85-6f9d-4650-9413-4b92ed185a51",
2019-05-31 04:36:04 下一步需要修改gw 组的配置文件，现在正在形成参数
2019-05-31 04:36:04 修改gw的配置文件/etc/v2ray/config.json,/opt/v2ray-firewall
2019-05-31 04:36:04 1.拼接ip地址
2019-05-31 04:36:04 "address":"45.32.42.33",
2019-05-31 04:36:04 2.拼接端口号
2019-05-31 04:36:04 "port": 16493,
2019-05-31 04:36:04 3.拼接id
2019-05-31 04:36:04 "id": "5c344d85-6f9d-4650-9413-4b92ed185a51",
2019-05-31 04:36:04 执行修改局域网GW的配置文件
2019-05-31 04:36:04 配置ip地址
10.24.1.254 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

2019-05-31 04:36:07 配置端口
10.24.1.254 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

2019-05-31 04:36:08 配置id
10.24.1.254 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

2019-05-31 04:36:10 配置防火墙
2019-05-31 04:36:10 1.拼接防火墙
2019-05-31 04:36:10 iptables -t nat -A V2RAY -d 45.32.42.33 -j RETURN
10.24.1.254 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

2019-05-31 04:36:11 重启gw的v2ray服务
10.24.1.254 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

10.24.1.254 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

2019-05-31 04:36:15 服务重启成功！
2019-05-31 04:36:15 配置完毕！
                                                                              
2019-05-31 04:36:15 检测的网关名为ggww
2019-05-31 04:36:17 获取的v2ray服务器IP地址为45.76.219.250
2019-05-31 04:36:17 收集vultr的服务器列表
2019-05-31 04:36:18 ggww 调用API成功，开始执行监控程序
2019-05-31 04:36:18 获取的v2ray服务器subid为 25088520
2019-05-31 04:36:18 获取的v2ray服务器DCID为 25
2019-05-31 04:36:18 获取的v2ray服务器label为gslavew
2019-05-31 04:36:19 获取v2ray服务器宽带使用率为 8756885678 字节
2019-05-31 04:36:19 获取的宽带使用率为8 G
2019-05-31 04:36:19 流量小于10G，监控结束！
                                                                              
2019-05-31 04:36:19 检测的网关名为dns
2019-05-31 04:36:21 获取的v2ray服务器IP地址为108.160.133.156
2019-05-31 04:36:21 收集vultr的服务器列表
2019-05-31 04:36:22 dns 调用API成功，开始执行监控程序
2019-05-31 04:36:22 获取的v2ray服务器subid为 25021030
2019-05-31 04:36:22 获取的v2ray服务器DCID为 25
2019-05-31 04:36:22 获取的v2ray服务器label为ddnnss
2019-05-31 04:36:24 获取v2ray服务器宽带使用率为 161574518 字节
2019-05-31 04:36:24 获取的宽带使用率为0 G
2019-05-31 04:36:24 流量小于10G，监控结束！
                                                                              
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                                                              
                                                                              
2019-06-01 04:30:01 检测的网关名为gw
2019-06-01 04:30:03 获取的v2ray服务器IP地址为45.32.42.33
2019-06-01 04:30:03 收集vultr的服务器列表
2019-06-01 04:30:05 gw 调用API成功，开始执行监控程序
2019-06-01 04:30:05 获取的v2ray服务器subid为 25126300
2019-06-01 04:30:05 获取的v2ray服务器DCID为 25
2019-06-01 04:30:05 获取的v2ray服务器label为gmasterw
2019-06-01 04:30:06 获取v2ray服务器宽带使用率为 667517142 字节
2019-06-01 04:30:06 获取的宽带使用率为0 G
2019-06-01 04:30:06 流量小于10G，监控结束！
                                                                              
2019-06-01 04:30:06 检测的网关名为ggww
2019-06-01 04:30:08 获取的v2ray服务器IP地址为45.76.219.250
2019-06-01 04:30:08 收集vultr的服务器列表
2019-06-01 04:30:09 ggww 调用API成功，开始执行监控程序
2019-06-01 04:30:09 获取的v2ray服务器subid为 25088520
2019-06-01 04:30:09 获取的v2ray服务器DCID为 25
2019-06-01 04:30:09 获取的v2ray服务器label为gslavew
2019-06-01 04:30:11 获取v2ray服务器宽带使用率为 18295166684 字节
2019-06-01 04:30:11 获取的宽带使用率为17 G
2019-06-01 04:30:11 触发重新搭建服务器条件,同时将keepalived服务停用
2019-06-01 04:30:11 正在停用keepalived服务
10.24.1.253 | CHANGED | rc=0 >>

192.168.1.251 | CHANGED | rc=0 >>

2019-06-01 04:30:13 ggww 的keepalived服务停用成功
2019-06-01 04:30:13 正在销毁v2ray服务器
2019-06-01 04:30:14 等待删除gslavew
2019-06-01 04:30:44 删除gslavew 成功
2019-06-01 04:30:44 获取ggww 使用的v2ray服务器的label	gslavew
2019-06-01 04:30:44 重新安装v2ray服务器
2019-06-01 04:30:46 installing server......
2019-06-01 04:30:46 正在安装的v2ray服务器的subid为25134038
2019-06-01 04:31:08 新建的v2ray服务器IP地址为45.76.219.250
2019-06-01 04:31:09 getting pwd......
2019-06-01 04:31:30 获取的v2ray服务器的密码为6_Du-%-hzLk*U22L
2019-06-01 04:31:30 sleep 60
2019-06-01 04:32:33 连接超时，重新安装服务器
Unable to reinstall server: Server is currently locked2019-06-01 04:34:05 检查v2ray服务器ip地址存在！
2019-06-01 04:34:05 ------------------------
2019-06-01 04:34:05 清理本地已经存在45.76.219.250 的密钥
# Host 45.76.219.250 found: line 17
/root/.ssh/known_hosts updated.
Original contents retained as /root/.ssh/known_hosts.old
2019-06-01 04:34:05 重新添加45.76.219.250 的密钥，正在添加密钥！
2019-06-01 04:34:06 v2ray_server安装ssh密钥
2019-06-01 04:34:10 ------------
2019-06-01 04:34:10 正在配置ansible主控端
2019-06-01 04:34:10 gslavew 已存在
2019-06-01 04:34:10 主控端配置完毕！
2019-06-01 04:34:10 ------------
2019-06-01 04:34:10 测试ansible被控端
45.76.219.250 | SUCCESS => {
    "changed": false, 
    "ping": "pong"
}
2019-06-01 04:34:19 主控端配置成功！
2019-06-01 04:34:19 -------------------
2019-06-01 04:34:19 开始安装v2ray服务端,并且进行配置，使用ansible的script模块拷贝配置文件
45.76.219.250 | CHANGED => {
    "changed": true, 
    "rc": 0, 
    "stderr": "Shared connection to 45.76.219.250 closed.\r\n", 
    "stderr_lines": [
        "Shared connection to 45.76.219.250 closed."
    ], 
    "stdout": "安装v2ray服务端\r\nbash <(curl -L -s https://install.direct/go.sh)\r\n\u001b[36mInstalling V2Ray v4.18.2 on x86_64\u001b[0m\r\n\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.2/v2ray-linux-64.zip\u001b[0m\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r100   608    0   608    0     0   2107      0 --:--:-- --:--:-- --:--:--  2111\r\n\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r  1 11.2M    1  152k    0     0  87842      0  0:02:14  0:00:01  0:02:13  163k\r  4 11.2M    4  525k    0     0   183k      0  0:01:02  0:00:02  0:01:00  259k\r  7 11.2M    7  865k    0     0   228k      0  0:00:50  0:00:03  0:00:47  294k\r 11 11.2M   11 1291k    0     0   272k      0  0:00:42  0:00:04  0:00:38  332k\r 14 11.2M   14 1664k    0     0   287k      0  0:00:40  0:00:05  0:00:35  337k\r 17 11.2M   17 2073k    0     0   307k      0  0:00:37  0:00:06  0:00:31  387k\r 20 11.2M   20 2311k    0     0   296k      0  0:00:38  0:00:07  0:00:31  363k\r 23 11.2M   23 2651k    0     0   303k      0  0:00:38  0:00:08  0:00:30  359k\r 25 11.2M   25 2940k    0     0   300k      0  0:00:38  0:00:09  0:00:29  326k\r 28 11.2M   28 3263k    0     0   303k      0  0:00:37  0:00:10  0:00:27  322k\r 30 11.2M   30 3568k    0     0   302k      0  0:00:38  0:00:11  0:00:27  295k\r 33 11.2M   33 3874k    0     0   300k      0  0:00:38  0:00:12  0:00:26  306k\r 36 11.2M   36 4181k    0     0   303k      0  0:00:37  0:00:13  0:00:24  305k\r 39 11.2M   39 4521k    0     0   306k      0  0:00:37  0:00:14  0:00:23  318k\r 42 11.2M   42 4861k    0     0   307k      0  0:00:37  0:00:15  0:00:22  316k\r 45 11.2M   45 5235k    0     0   312k      0  0:00:36  0:00:16  0:00:20  336k\r 48 11.2M   48 5558k    0     0   312k      0  0:00:36  0:00:17  0:00:19  342k\r 51 11.2M   51 5966k    0     0   318k      0  0:00:36  0:00:18  0:00:18  357k\r 55 11.2M   55 6390k    0     0   322k      0  0:00:35  0:00:19  0:00:16  370k\r 59 11.2M   59 6883k    0     0   331k      0  0:00:34  0:00:20  0:00:14  407k\r 62 11.2M   62 7241k    0     0   332k      0  0:00:34  0:00:21  0:00:13  398k\r 66 11.2M   66 7632k    0     0   335k      0  0:00:34  0:00:22  0:00:12  417k\r 68 11.2M   68 7870k    0     0   330k      0  0:00:34  0:00:23  0:00:11  377k\r 69 11.2M   69 7971k    0     0   321k      0  0:00:35  0:00:24  0:00:11  316k\r 70 11.2M   70 8074k    0     0   312k      0  0:00:36  0:00:25  0:00:11  235k\r 70 11.2M   70 8175k    0     0   305k      0  0:00:37  0:00:26  0:00:11  186k\r 71 11.2M   71 8278k    0     0   298k      0  0:00:38  0:00:27  0:00:11  129k\r 72 11.2M   72 8414k    0     0   292k      0  0:00:39  0:00:28  0:00:11  109k\r 74 11.2M   74 8584k    0     0   288k      0  0:00:39  0:00:29  0:00:10  123k\r 76 11.2M   76 8788k    0     0   285k      0  0:00:40  0:00:30  0:00:10  144k\r 78 11.2M   78 9042k    0     0   284k      0  0:00:40  0:00:31  0:00:09  175k\r 80 11.2M   80 9314k    0     0   284k      0  0:00:40  0:00:32  0:00:08  208k\r 83 11.2M   83 9586k    0     0   284k      0  0:00:40  0:00:33  0:00:07  235k\r 85 11.2M   85 9841k    0     0   283k      0  0:00:40  0:00:34  0:00:06  252k\r 87 11.2M   87  9.8M    0     0   282k      0  0:00:40  0:00:35  0:00:05  262k\r 89 11.2M   89 10.1M    0     0   281k      0  0:00:40  0:00:36  0:00:04  263k\r 92 11.2M   92 10.3M    0     0   281k      0  0:00:40  0:00:37  0:00:03  263k\r 95 11.2M   95 10.7M    0     0   283k      0  0:00:40  0:00:38  0:00:02  276k\r 97 11.2M   97 10.9M    0     0   283k      0  0:00:40  0:00:39  0:00:01  280k\r100 11.2M  100 11.2M    0     0   284k      0  0:00:40  0:00:40 --:--:--  298k\r\n\u001b[36mUpdating software repo\u001b[0m\r\n\u001b[36mInstalling unzip\u001b[0m\r\ndebconf: unable to initialize frontend: Dialog\r\ndebconf: (TERM is not set, so the dialog frontend is not usable.)\r\ndebconf: falling back to frontend: Readline\r\ndebconf: unable to initialize frontend: Readline\r\ndebconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)\r\ndebconf: falling back to frontend: Teletype\r\nSelecting previously unselected package unzip.\r\n(Reading database ... \r(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r(Reading database ... 70%\r(Reading database ... 75%\r(Reading database ... 80%\r(Reading database ... 85%\r(Reading database ... 90%\r(Reading database ... 95%\r(Reading database ... 100%\r(Reading database ... 21827 files and directories currently installed.)\r\nPreparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...\r\nUnpacking unzip (6.0-16+deb8u3) ...\r\nProcessing triggers for mime-support (3.58) ...\r\nProcessing triggers for man-db (2.7.0.2-5) ...\r\nSetting up unzip (6.0-16+deb8u3) ...\r\n\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m\r\nArchive:  /tmp/v2ray/v2ray.zip\r\n  inflating: /tmp/v2ray/config.json  \r\n   creating: /tmp/v2ray/doc/\r\n  inflating: /tmp/v2ray/doc/readme.md  \r\n  inflating: /tmp/v2ray/geoip.dat    \r\n  inflating: /tmp/v2ray/geosite.dat  \r\n   creating: /tmp/v2ray/systemd/\r\n  inflating: /tmp/v2ray/systemd/v2ray.service  \r\n   creating: /tmp/v2ray/systemv/\r\n  inflating: /tmp/v2ray/systemv/v2ray  \r\n  inflating: /tmp/v2ray/v2ctl        \r\n extracting: /tmp/v2ray/v2ctl.sig    \r\n  inflating: /tmp/v2ray/v2ray        \r\n extracting: /tmp/v2ray/v2ray.sig    \r\n  inflating: /tmp/v2ray/vpoint_socks_vmess.json  \r\n  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  \r\n\u001b[36mShutting down V2Ray service.\u001b[0m\r\nFailed to stop v2ray.service: Unit v2ray.service not loaded.\r\n\u001b[33mFailed to shutdown V2Ray service.\u001b[0m\r\n\u001b[36mPORT:12323\u001b[0m\r\n\u001b[36mUUID:7c35dcf8-9319-4c11-9005-4aa561c2cd6c\u001b[0m\r\nCreated symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.\r\n\u001b[36mRestarting V2Ray service.\u001b[0m\r\n\u001b[32mV2Ray v4.18.2 is installed.\u001b[0m\r\nv2ray服务端安装成功\r\ncp /etc/v2ray/config.json /root/\r\nconfig文件备份成功\r\n", 
    "stdout_lines": [
        "安装v2ray服务端", 
        "bash <(curl -L -s https://install.direct/go.sh)", 
        "\u001b[36mInstalling V2Ray v4.18.2 on x86_64\u001b[0m", 
        "\u001b[36mDownloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.2/v2ray-linux-64.zip\u001b[0m", 
        "  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current", 
        "                                 Dload  Upload   Total   Spent    Left  Speed", 
        "", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "100   608    0   608    0     0   2107      0 --:--:-- --:--:-- --:--:--  2111", 
        "", 
        "  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0", 
        "  1 11.2M    1  152k    0     0  87842      0  0:02:14  0:00:01  0:02:13  163k", 
        "  4 11.2M    4  525k    0     0   183k      0  0:01:02  0:00:02  0:01:00  259k", 
        "  7 11.2M    7  865k    0     0   228k      0  0:00:50  0:00:03  0:00:47  294k", 
        " 11 11.2M   11 1291k    0     0   272k      0  0:00:42  0:00:04  0:00:38  332k", 
        " 14 11.2M   14 1664k    0     0   287k      0  0:00:40  0:00:05  0:00:35  337k", 
        " 17 11.2M   17 2073k    0     0   307k      0  0:00:37  0:00:06  0:00:31  387k", 
        " 20 11.2M   20 2311k    0     0   296k      0  0:00:38  0:00:07  0:00:31  363k", 
        " 23 11.2M   23 2651k    0     0   303k      0  0:00:38  0:00:08  0:00:30  359k", 
        " 25 11.2M   25 2940k    0     0   300k      0  0:00:38  0:00:09  0:00:29  326k", 
        " 28 11.2M   28 3263k    0     0   303k      0  0:00:37  0:00:10  0:00:27  322k", 
        " 30 11.2M   30 3568k    0     0   302k      0  0:00:38  0:00:11  0:00:27  295k", 
        " 33 11.2M   33 3874k    0     0   300k      0  0:00:38  0:00:12  0:00:26  306k", 
        " 36 11.2M   36 4181k    0     0   303k      0  0:00:37  0:00:13  0:00:24  305k", 
        " 39 11.2M   39 4521k    0     0   306k      0  0:00:37  0:00:14  0:00:23  318k", 
        " 42 11.2M   42 4861k    0     0   307k      0  0:00:37  0:00:15  0:00:22  316k", 
        " 45 11.2M   45 5235k    0     0   312k      0  0:00:36  0:00:16  0:00:20  336k", 
        " 48 11.2M   48 5558k    0     0   312k      0  0:00:36  0:00:17  0:00:19  342k", 
        " 51 11.2M   51 5966k    0     0   318k      0  0:00:36  0:00:18  0:00:18  357k", 
        " 55 11.2M   55 6390k    0     0   322k      0  0:00:35  0:00:19  0:00:16  370k", 
        " 59 11.2M   59 6883k    0     0   331k      0  0:00:34  0:00:20  0:00:14  407k", 
        " 62 11.2M   62 7241k    0     0   332k      0  0:00:34  0:00:21  0:00:13  398k", 
        " 66 11.2M   66 7632k    0     0   335k      0  0:00:34  0:00:22  0:00:12  417k", 
        " 68 11.2M   68 7870k    0     0   330k      0  0:00:34  0:00:23  0:00:11  377k", 
        " 69 11.2M   69 7971k    0     0   321k      0  0:00:35  0:00:24  0:00:11  316k", 
        " 70 11.2M   70 8074k    0     0   312k      0  0:00:36  0:00:25  0:00:11  235k", 
        " 70 11.2M   70 8175k    0     0   305k      0  0:00:37  0:00:26  0:00:11  186k", 
        " 71 11.2M   71 8278k    0     0   298k      0  0:00:38  0:00:27  0:00:11  129k", 
        " 72 11.2M   72 8414k    0     0   292k      0  0:00:39  0:00:28  0:00:11  109k", 
        " 74 11.2M   74 8584k    0     0   288k      0  0:00:39  0:00:29  0:00:10  123k", 
        " 76 11.2M   76 8788k    0     0   285k      0  0:00:40  0:00:30  0:00:10  144k", 
        " 78 11.2M   78 9042k    0     0   284k      0  0:00:40  0:00:31  0:00:09  175k", 
        " 80 11.2M   80 9314k    0     0   284k      0  0:00:40  0:00:32  0:00:08  208k", 
        " 83 11.2M   83 9586k    0     0   284k      0  0:00:40  0:00:33  0:00:07  235k", 
        " 85 11.2M   85 9841k    0     0   283k      0  0:00:40  0:00:34  0:00:06  252k", 
        " 87 11.2M   87  9.8M    0     0   282k      0  0:00:40  0:00:35  0:00:05  262k", 
        " 89 11.2M   89 10.1M    0     0   281k      0  0:00:40  0:00:36  0:00:04  263k", 
        " 92 11.2M   92 10.3M    0     0   281k      0  0:00:40  0:00:37  0:00:03  263k", 
        " 95 11.2M   95 10.7M    0     0   283k      0  0:00:40  0:00:38  0:00:02  276k", 
        " 97 11.2M   97 10.9M    0     0   283k      0  0:00:40  0:00:39  0:00:01  280k", 
        "100 11.2M  100 11.2M    0     0   284k      0  0:00:40  0:00:40 --:--:--  298k", 
        "\u001b[36mUpdating software repo\u001b[0m", 
        "\u001b[36mInstalling unzip\u001b[0m", 
        "debconf: unable to initialize frontend: Dialog", 
        "debconf: (TERM is not set, so the dialog frontend is not usable.)", 
        "debconf: falling back to frontend: Readline", 
        "debconf: unable to initialize frontend: Readline", 
        "debconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.20.2 /usr/local/share/perl/5.20.2 /usr/lib/x86_64-linux-gnu/perl5/5.20 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.20 /usr/share/perl/5.20 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, <> line 1.)", 
        "debconf: falling back to frontend: Teletype", 
        "Selecting previously unselected package unzip.", 
        "(Reading database ... ", 
        "(Reading database ... 5%", 
        "(Reading database ... 10%", 
        "(Reading database ... 15%", 
        "(Reading database ... 20%", 
        "(Reading database ... 25%", 
        "(Reading database ... 30%", 
        "(Reading database ... 35%", 
        "(Reading database ... 40%", 
        "(Reading database ... 45%", 
        "(Reading database ... 50%", 
        "(Reading database ... 55%", 
        "(Reading database ... 60%", 
        "(Reading database ... 65%", 
        "(Reading database ... 70%", 
        "(Reading database ... 75%", 
        "(Reading database ... 80%", 
        "(Reading database ... 85%", 
        "(Reading database ... 90%", 
        "(Reading database ... 95%", 
        "(Reading database ... 100%", 
        "(Reading database ... 21827 files and directories currently installed.)", 
        "Preparing to unpack .../unzip_6.0-16+deb8u3_amd64.deb ...", 
        "Unpacking unzip (6.0-16+deb8u3) ...", 
        "Processing triggers for mime-support (3.58) ...", 
        "Processing triggers for man-db (2.7.0.2-5) ...", 
        "Setting up unzip (6.0-16+deb8u3) ...", 
        "\u001b[36mExtracting V2Ray package to /tmp/v2ray.\u001b[0m", 
        "Archive:  /tmp/v2ray/v2ray.zip", 
        "  inflating: /tmp/v2ray/config.json  ", 
        "   creating: /tmp/v2ray/doc/", 
        "  inflating: /tmp/v2ray/doc/readme.md  ", 
        "  inflating: /tmp/v2ray/geoip.dat    ", 
        "  inflating: /tmp/v2ray/geosite.dat  ", 
        "   creating: /tmp/v2ray/systemd/", 
        "  inflating: /tmp/v2ray/systemd/v2ray.service  ", 
        "   creating: /tmp/v2ray/systemv/", 
        "  inflating: /tmp/v2ray/systemv/v2ray  ", 
        "  inflating: /tmp/v2ray/v2ctl        ", 
        " extracting: /tmp/v2ray/v2ctl.sig    ", 
        "  inflating: /tmp/v2ray/v2ray        ", 
        " extracting: /tmp/v2ray/v2ray.sig    ", 
        "  inflating: /tmp/v2ray/vpoint_socks_vmess.json  ", 
        "  inflating: /tmp/v2ray/vpoint_vmess_freedom.json  ", 
        "\u001b[36mShutting down V2Ray service.\u001b[0m", 
        "Failed to stop v2ray.service: Unit v2ray.service not loaded.", 
        "\u001b[33mFailed to shutdown V2Ray service.\u001b[0m", 
        "\u001b[36mPORT:12323\u001b[0m", 
        "\u001b[36mUUID:7c35dcf8-9319-4c11-9005-4aa561c2cd6c\u001b[0m", 
        "Created symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.", 
        "\u001b[36mRestarting V2Ray service.\u001b[0m", 
        "\u001b[32mV2Ray v4.18.2 is installed.\u001b[0m", 
        "v2ray服务端安装成功", 
        "cp /etc/v2ray/config.json /root/", 
        "config文件备份成功"
    ]
}
45.76.219.250 | CHANGED => {
    "changed": true, 
    "checksum": "642c4f754bbfa22a465305bf9f28f0be6b8d51d3", 
    "dest": "/etc/v2ray/config.json", 
    "gid": 0, 
    "group": "root", 
    "md5sum": "e1c9ae8913976ca140c692152b5ade95", 
    "mode": "0644", 
    "owner": "root", 
    "size": 1448, 
    "src": "/root/.ansible/tmp/ansible-tmp-1559334914.19-126630923141755/source", 
    "state": "file", 
    "uid": 0
}
2019-06-01 04:35:20 v2ray服务端安装完毕！
2019-06-01 04:35:20 获取v2ray服务器的IP\PORT\ID
45.76.219.250 | CHANGED | rc=0 >>
{
  "inbounds": [{
    "port": 12323,
    "protocol": "vmess",
    "settings": {
      "clients": [
        {
          "id": "7c35dcf8-9319-4c11-9005-4aa561c2cd6c",
          "level": 1,
          "alterId": 64
        }
      ]
    }
  }],
  "outbounds": [{
    "protocol": "freedom",
    "settings": {}
  },{
    "protocol": "blackhole",
    "settings": {},
    "tag": "blocked"
  }],
  "routing": {
    "rules": [
      {
        "type": "field",
        "ip": ["geoip:private"],
        "outboundTag": "blocked"
      }
    ]
  }
}
45.76.219.250 | CHANGED | rc=0 >>
{
  "log" : {
    "access": "/var/log/v2ray/access.log",
    "error": "/var/log/v2ray/error.log",
    "loglevel": "warning"
  },
  "inbound": {
    "port": 31139,
    "protocol": "vmess", 
    "settings": {
      "clients": [
        {
          "id": "805ed8a8-7967-49c0-9f5d-057e86920c49",
          "level": 1,
          "alterId": 64
        }
      ],
      "detour":{
        "to":"dynamicPort"
      }
    },
    "streamSettings":{
      "network":"kcp"
    }
  },
  "inboundDetour":[
    {
      "protocol": "vmess",
      "port": "10000-20000",
      "tag": "dynamicPort",       
      "settings": {
        "default": {
          "level": 1,
          "alterId": 32
        }
      },
      "allocate": {            
        "strategy": "random",  
        "concurrency": 2,      
        "refresh": 3           
      },
      "streamSettings": {
        "network": "kcp"
      }
    }
  ],
  "outbound": {
    "protocol": "freedom",
    "settings": {}
  },
  "outboundDetour": [
    {
      "protocol": "blackhole",
      "settings": {},
      "tag": "blocked"
    }
  ],
 "transport":{
      "tcpSettings":{
         "connectionReuse":true
      },
      "kcpSettings":{ 
         "mtu":1350,
         "tti":20,
         "uplinkCapacity":100,
         "downlinkCapacity":100,
         "congestion":false,
         "readBufferSize":5,
         "writeBufferSize":5,
         "header":{
            "type":"utp"
         }
      }
   }
}
2019-06-01 04:35:37 45.76.219.250     "port": 12323,           "id": "7c35dcf8-9319-4c11-9005-4aa561c2cd6c",
2019-06-01 04:35:37 正在修改-----------------
45.76.219.250 | CHANGED | rc=0 >>

45.76.219.250 | CHANGED | rc=0 >>

45.76.219.250 | CHANGED | rc=0 >>

45.76.219.250 | CHANGED | rc=0 >>

2019-06-01 04:35:50 修改完毕，v2ray服务端配置成功!重启v2ray服务器
45.76.219.250 | CHANGED | rc=0 >>

2019-06-01 04:35:53 v2ray服务重启成功！
2019-06-01 04:35:53 -------------------
2019-06-01 04:36:53 更新局域网的网关服务
2019-06-01 04:36:53 正在验证ggww 分组是否存在,请稍后...
2019-06-01 04:36:55 验证成功gw分组存在！分组名为ggww
2019-06-01 04:37:55 正在验证gslavew 分组是否存在,请稍后...
2019-06-01 04:38:02 验证成功gslavew 分组存在！分组名为gslavew
2019-06-01 04:38:05 v2ray_server的IP是45.76.219.250
2019-06-01 04:38:09     "port": 12323,
2019-06-01 04:38:13           "id": "7c35dcf8-9319-4c11-9005-4aa561c2cd6c",
2019-06-01 04:38:13 下一步需要修改ggww 组的配置文件，现在正在形成参数
2019-06-01 04:38:13 修改gw的配置文件/etc/v2ray/config.json,/opt/v2ray-firewall
2019-06-01 04:38:13 1.拼接ip地址
2019-06-01 04:38:13 "address":"45.76.219.250",
2019-06-01 04:38:13 2.拼接端口号
2019-06-01 04:38:13 "port": 12323,
2019-06-01 04:38:13 3.拼接id
2019-06-01 04:38:13 "id": "7c35dcf8-9319-4c11-9005-4aa561c2cd6c",
2019-06-01 04:38:13 执行修改局域网GW的配置文件
2019-06-01 04:38:13 配置ip地址
10.24.1.253 | CHANGED | rc=0 >>

192.168.1.251 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

192.168.1.251 | CHANGED | rc=0 >>

2019-06-01 04:38:15 配置端口
10.24.1.253 | CHANGED | rc=0 >>

192.168.1.251 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

192.168.1.251 | CHANGED | rc=0 >>

2019-06-01 04:38:17 配置id
10.24.1.253 | CHANGED | rc=0 >>

192.168.1.251 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

192.168.1.251 | CHANGED | rc=0 >>

2019-06-01 04:38:18 配置防火墙
2019-06-01 04:38:18 1.拼接防火墙
2019-06-01 04:38:18 iptables -t nat -A V2RAY -d 45.76.219.250 -j RETURN
10.24.1.253 | CHANGED | rc=0 >>

192.168.1.251 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

192.168.1.251 | CHANGED | rc=0 >>

2019-06-01 04:38:19 重启gw的v2ray服务
10.24.1.253 | CHANGED | rc=0 >>

192.168.1.251 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

192.168.1.251 | CHANGED | rc=0 >>

10.24.1.253 | CHANGED | rc=0 >>

192.168.1.251 | CHANGED | rc=0 >>

2019-06-01 04:38:24 服务重启成功！
2019-06-01 04:38:24 配置完毕！
                                                                              
2019-06-01 04:38:24 检测的网关名为dns
2019-06-01 04:38:26 获取的v2ray服务器IP地址为108.160.133.156
2019-06-01 04:38:26 收集vultr的服务器列表
2019-06-01 04:38:27 dns 调用API成功，开始执行监控程序
2019-06-01 04:38:27 获取的v2ray服务器subid为 25021030
2019-06-01 04:38:27 获取的v2ray服务器DCID为 25
2019-06-01 04:38:27 获取的v2ray服务器label为ddnnss
2019-06-01 04:38:28 获取v2ray服务器宽带使用率为 187615964 字节
2019-06-01 04:38:28 获取的宽带使用率为0 G
2019-06-01 04:38:28 流量小于10G，监控结束！
                                                                              
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                                                              
                                                                              
2019-06-02 04:30:01 检测的网关名为gw
2019-06-02 04:30:03 获取的v2ray服务器IP地址为45.32.42.33
2019-06-02 04:30:03 收集vultr的服务器列表
2019-06-02 04:30:05 gw 调用API成功，开始执行监控程序
2019-06-02 04:30:05 获取的v2ray服务器subid为 25126300
2019-06-02 04:30:05 获取的v2ray服务器DCID为 25
2019-06-02 04:30:05 获取的v2ray服务器label为gmasterw
2019-06-02 04:30:06 获取v2ray服务器宽带使用率为 20200299068 字节
2019-06-02 04:30:06 获取的宽带使用率为18 G
2019-06-02 04:30:06 触发重新搭建服务器条件,同时将keepalived服务停用
2019-06-02 04:30:06 正在停用keepalived服务
10.24.1.254 | CHANGED | rc=0 >>

192.168.1.252 | CHANGED | rc=0 >>

2019-06-02 04:30:08 gw 的keepalived服务停用成功
2019-06-02 04:30:08 正在销毁v2ray服务器
2019-06-02 04:30:09 等待删除gmasterw
2019-06-02 04:30:39 删除gmasterw 成功
2019-06-02 04:30:39 获取gw 使用的v2ray服务器的label	gmasterw
2019-06-02 04:30:39 重新安装v2ray服务器
2019-06-02 04:30:42 installing server......
2019-06-02 04:30:42 正在安装的v2ray服务器的subid为25217075
2019-06-02 04:31:05 新建的v2ray服务器IP地址为45.32.42.33
2019-06-02 04:31:06 getting pwd......
2019-06-02 04:31:29 获取的v2ray服务器的密码为3C$o4zH+G1W9JpJ$
2019-06-02 04:31:29 sleep 60
2019-06-02 04:32:32 连接超时，重新安装服务器
Unable to reinstall server: Server is currently locked2019-06-02 04:34:06 连接超时，重新安装服务器
Unable to reinstall server: Server is currently locked重试2次无效，退出
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                                                              
                                                                              
2019-06-03 04:30:01 检测的网关名为gw
2019-06-03 04:30:03 获取的v2ray服务器IP地址为45.32.42.33
2019-06-03 04:30:03 收集vultr的服务器列表
2019-06-03 04:30:04 gw 调用API成功，开始执行监控程序
2019-06-03 04:30:04 获取的v2ray服务器subid为 25217075
2019-06-03 04:30:04 获取的v2ray服务器DCID为 25
2019-06-03 04:30:04 获取的v2ray服务器label为gmasterw
2019-06-03 04:30:05 获取v2ray服务器宽带使用率为 32621282 字节
2019-06-03 04:30:05 获取的宽带使用率为0 G
2019-06-03 04:30:05 流量小于10G，监控结束！
                                                                              
2019-06-03 04:30:05 检测的网关名为ggww
2019-06-03 04:30:07 获取的v2ray服务器IP地址为45.76.219.250
2019-06-03 04:30:07 收集vultr的服务器列表
2019-06-03 04:30:08 ggww 调用API成功，开始执行监控程序
2019-06-03 04:30:08 获取的v2ray服务器subid为 25134038
2019-06-03 04:30:08 获取的v2ray服务器DCID为 25
2019-06-03 04:30:08 获取的v2ray服务器label为gslavew
2019-06-03 04:30:09 获取v2ray服务器宽带使用率为 2435481811 字节
2019-06-03 04:30:09 获取的宽带使用率为2 G
2019-06-03 04:30:09 流量小于10G，监控结束！
                                                                              
2019-06-03 04:30:09 检测的网关名为dns
2019-06-03 04:30:11 获取的v2ray服务器IP地址为108.160.133.156
2019-06-03 04:30:11 收集vultr的服务器列表
2019-06-03 04:30:12 dns 调用API成功，开始执行监控程序
2019-06-03 04:30:12 获取的v2ray服务器subid为 25021030
2019-06-03 04:30:12 获取的v2ray服务器DCID为 25
2019-06-03 04:30:12 获取的v2ray服务器label为ddnnss
2019-06-03 04:30:14 获取v2ray服务器宽带使用率为 613328145 字节
2019-06-03 04:30:14 获取的宽带使用率为0 G
2019-06-03 04:30:14 流量小于10G，监控结束！
                                                                              
